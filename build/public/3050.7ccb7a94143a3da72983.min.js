"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3050,3034,4337],{81018:(v,R,d)=>{var A,h;A=[d(7927)],h=function(E){const m={};m.init=function(){Promise.all([d.e(2441),d.e(1006),d.e(4271),d.e(8596)]).then(function(){var p=[d(30524)];(function(f){$('[component="chat/recent"]').on("click",'[component="chat/recent/room"]',function(){f.switchChat($(this).attr("data-roomid"))}),$('[component="chat/recent"]').on("scroll",function(){const l=$(this),o=(l[0].scrollHeight-l.height())*.9;l.scrollTop()>o&&I()})}).apply(null,p)}).catch(d.oe)};function I(){const p=$('[component="chat/recent"]');p.attr("loading")||(p.attr("loading",1),socket.emit("modules.chats.getRecentChats",{uid:ajaxify.data.uid,after:p.attr("data-nextstart")},function(f,l){if(f)return E.error(f);l&&l.rooms.length?r(l,function(){p.removeAttr("loading"),p.attr("data-nextstart",l.nextStart)}):p.removeAttr("loading")}))}function r(p,f){if(!p.rooms.length)return f();app.parseAndTranslate("chats","rooms",p,function(l){$('[component="chat/recent"]').append(l),l.find(".timeago").timeago(),f()})}return m}.apply(R,A),h!==void 0&&(v.exports=h)},93216:(v,R,d)=>{var A,h;A=[d(7237),d(27145),d(32230),d(85233),d(31369),d(7927),d(74344)],h=function(E,m,I,r,p,f,l){const o={};let e=!1;o.openChat=function(t,n){if(!app.user.uid)return f.error("[[error:not-logged-in]]");function a(s){o.load(s.attr("data-uuid")),o.center(s),o.focusInput(s)}o.modalExists(t)?a(o.getModal(t)):l.get(`/chats/${t}`,{uid:n||app.user.uid}).then(s=>{s.users=s.users.filter(function(u){return u&&parseInt(u.uid,10)!==parseInt(app.user.uid,10)}),s.uid=n||app.user.uid,s.isSelf=!0,o.createModal(s,a)}).catch(f.error)},o.newChat=function(t,n){function a(){l.post("/chats",{uids:[t]}).then(({roomId:s})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+s):o.openChat(s),n(null,s)}).catch(f.error)}if(n=n||function(){},!app.user.uid)return f.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return f.error("[[error:cant-chat-with-yourself]]");socket.emit("modules.chats.isDnD",t,function(s,u){if(s)return f.error(s);if(!u)return a();p.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(g){g&&a()})})},o.loadChatsDropdown=function(t){socket.emit("modules.chats.getRecentChats",{uid:app.user.uid,after:0},function(n,a){if(n)return f.error(n);const s=a.rooms.filter(function(u){return u.teaser});I.toggleTimeagoShorthand(function(){for(let u=0;u<s.length;u+=1)s[u].teaser.timeago=$.timeago(new Date(parseInt(s[u].teaser.timestamp,10)));I.toggleTimeagoShorthand(),app.parseAndTranslate("partials/chats/dropdown",{rooms:s},function(u){t.find("*").not(".navigation-link").remove(),t.prepend(u),app.createUserTooltips(t,"right"),t.off("click").on("click","[data-roomid]",function(g){if($(g.target).parents(".user-link").length)return;const i=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+i):o.openChat(i)}),$('[component="chats/mark-all-read"]').off("click").on("click",function(){socket.emit("modules.chats.markAllRead",function(g){if(g)return f.error(g)})})})})})},o.onChatMessageReceived=function(t){const n=t.self===1;t.message.self=t.self,e=t.self===0,o.modalExists(t.roomId)?c(t):ajaxify.data.template.chats||l.get(`/chats/${t.roomId}`,{}).then(a=>{a.users=a.users.filter(function(s){return s&&parseInt(s.uid,10)!==parseInt(app.user.uid,10)}),a.silent=!0,a.uid=app.user.uid,a.isSelf=n,o.createModal(a)}).catch(f.error)};function c(t){const n=o.getModal(t.roomId),a=t.message.fromUser.username,s=t.self===1;d.e(6862).then(function(){var u=[d(46862)];(function(g){n.find('[data-mid="'+t.message.messageId+'"]').length||g.appendChatMessage(n.find(".chat-content"),t.message),n.is(":visible")?(m.updateActive(n.attr("data-uuid")),g.isAtBottom(n.find(".chat-content"))&&g.scrollToBottom(n.find(".chat-content"))):ajaxify.data.template.chats||o.toggleNew(n.attr("data-uuid"),!0,!0),!s&&(!n.is(":visible")||!app.isFocused)&&m.push("chat",n.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||a),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,u)}).catch(d.oe)}return o.onUserStatusChange=function(t){const n=o.getModal(t.uid);app.updateUserStatus(n.find('[component="user/status"]'),t.status)},o.onRoomRename=function(t){const n=$("<div></div>").html(t.newName).text(),a=o.getModal(t.roomId);a.find('[component="chat/room/name"]').text(n),m.update("chat",a.attr("data-uuid"),{title:n}),r.fire("action:chat.renamed",Object.assign(t,{modal:a}))},o.getModal=function(t){return $("#chat-modal-"+t)},o.modalExists=function(t){return $("#chat-modal-"+t).length!==0},o.createModal=function(t,n){n=n||function(){},Promise.all([d.e(2441),d.e(1006),d.e(4271),d.e(9789)]).then(function(){var a=[d(75203),d(30524),d(46862)];(function(s,u,g){app.parseAndTranslate("chat",t,function(i){if(o.modalExists(t.roomId))return n(o.getModal(t.roomId));const y=utils.generateUUID();let x=!1;i.attr("id","chat-modal-"+t.roomId),i.attr("data-roomid",t.roomId),i.attr("intervalId",0),i.attr("data-uuid",y),i.css("position","fixed"),i.appendTo($("body")),i.find(".timeago").timeago(),o.center(i),app.loadJQueryUI(function(){i.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),i.find(".modal-content").on("resize",function(C,N){N.originalSize.height!==N.size.height&&i.find(".modal-body").css("height",o.calculateChatListHeight(i))}),i.draggable({start:function(){m.updateActive(y)},stop:function(){o.focusInput(i)},distance:10,handle:".modal-header"})}),s.apply(i.find('[component="chat/messages"]')),i.find("#chat-close-btn").on("click",function(){o.close(i)});function B(){const C=E.get("chat/input").val();$(window).one("action:ajaxify.end",function(){E.get("chat/input").val(C)}),ajaxify.go("user/"+app.user.userslug+"/chats/"+i.attr("data-roomid")),o.close(i)}i.find(".modal-header").on("dblclick",B),i.find('button[data-action="maximize"]').on("click",B),i.find('button[data-action="minimize"]').on("click",function(){const C=i.attr("data-uuid");o.minimize(C)}),i.on("mouseup",function(){m.updateActive(i.attr("data-uuid")),x&&(x=!1)}),i.on("mousemove",function(C){C.which===1&&(x=!0)}),i.on("mousemove keypress click",function(){e&&(socket.emit("modules.chats.markRead",t.roomId),e=!1)}),u.addActionHandlers(i.find('[component="chat/messages"]'),t.roomId),u.addRenameHandler(i.attr("data-roomid"),i.find('[data-action="rename"]'),t.roomName),u.addLeaveHandler(i.attr("data-roomid"),i.find('[data-action="leave"]')),u.addSendHandlers(i.attr("data-roomid"),i.find(".chat-input"),i.find('[data-action="send"]')),u.addMemberHandler(i.attr("data-roomid"),i.find('[data-action="members"]')),u.createAutoComplete(i.find('[component="chat/input"]')),u.addScrollHandler(i.attr("data-roomid"),t.uid,i.find(".chat-content")),u.addScrollBottomHandler(i.find(".chat-content")),u.addCharactersLeftHandler(i),u.addIPHandler(i),u.addUploadHandler({dragDropAreaEl:i.find(".modal-content"),pasteEl:i,uploadFormEl:i.find('[component="chat/upload"]'),inputEl:i.find('[component="chat/input"]')}),g.addSocketListeners(),m.push("chat",i.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){m.toggleNew(i.attr("data-uuid"),!t.isSelf),r.fire("action:chat.loaded",i),typeof n=="function"&&n(i)})})}).apply(null,a)}).catch(d.oe)},o.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},o.close=function(t){const n=t.attr("data-uuid");clearInterval(t.attr("intervalId")),t.attr("intervalId",0),t.remove(),t.data("modal",null),m.discard("chat",n),t.attr("data-mobile")&&o.disableMobileBehaviour(t),r.fire("action:chat.closed",{uuid:n,modal:t})},o.closeByUUID=function(t){const n=$('.chat-modal[data-uuid="'+t+'"]');o.close(n)},o.center=function(t){let n=!1;return t.hasClass("hide")&&(t.removeClass("hide"),n=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),n&&t.addClass("hide"),t},o.load=function(t){d.e(6862).then(function(){var n=[d(46862)];(function(a){const s=$('.chat-modal[data-uuid="'+t+'"]');s.removeClass("hide"),m.updateActive(t),a.scrollToBottom(s.find(".chat-content")),o.focusInput(s),socket.emit("modules.chats.markRead",s.attr("data-roomid"));const u=utils.findBootstrapEnvironment();(u==="xs"||u==="sm")&&o.enableMobileBehaviour(s)}).apply(null,n)}).catch(d.oe)},o.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const n=t.find(".modal-body");n.css("height",o.calculateChatListHeight(t));function a(){n.css("height",o.calculateChatListHeight(t)),d.e(6862).then(function(){var s=[d(46862)];(function(u){u.scrollToBottom(t.find(".chat-content"))}).apply(null,s)}).catch(d.oe)}$(window).on("resize",a),$(window).one("action:ajaxify.start",function(){o.close(t),$(window).off("resize",a)})},o.disableMobileBehaviour=function(){app.toggleNavbar(!0)},o.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},o.minimize=function(t){const n=$('.chat-modal[data-uuid="'+t+'"]');n.addClass("hide"),m.minimize("chat",t),clearInterval(n.attr("intervalId")),n.attr("intervalId",0),r.fire("action:chat.minimized",{uuid:t,modal:n})},o.toggleNew=m.toggleNew,o}.apply(R,A),h!==void 0&&(v.exports=h)},27145:(v,R,d)=>{v=d.nmd(v);var A,h;A=[d(59006),d(32230),d(85233)],h=function(E,m,I){const r={};r.init=function(){const e=this;E.render("modules/taskbar",{}).then(function(c){e.taskbar=$(c),e.tasklist=e.taskbar.find("ul"),$(document.body).append(e.taskbar),e.taskbar.on("click","li",async function(){const t=$(this),n=t.attr("data-module"),a=t.attr("data-uuid"),s=await app.require(n);return t.hasClass("active")?s.minimize(a):(f(),s.load(a),r.toggleNew(a,!1),r.tasklist.removeClass("active"),t.addClass("active")),!1})}),$(window).on("action:app.loggedOut",function(){r.closeAll()})},r.close=async function(e,c){const t=r.tasklist.find('[data-module="'+v+'"][data-uuid="'+c+'"]');let n="close";if(e==="chat"&&(n="closeByUUID"),t.length){const a=await app.require(e);a&&typeof a[n]=="function"&&a[n](c)}},r.closeAll=function(e){let c="[data-uuid]";e&&(c='[data-module="'+e+'"]'+c),r.tasklist.find(c).each(function(t,n){r.close(e||n.getAttribute("data-module"),n.getAttribute("data-uuid"))})},r.discard=function(e,c){r.tasklist.find('[data-module="'+e+'"][data-uuid="'+c+'"]').remove(),p()},r.push=function(e,c,t,n){n=n||function(){};const a=r.tasklist.find('li[data-uuid="'+c+'"]'),s={module:e,uuid:c,options:t,element:a};I.fire("filter:taskbar.push",s),!a.length&&s.module?l(s,n):n(a)},r.get=function(e){return $('[data-module="'+e+'"]').map(function(t,n){return $(n).data()})},r.minimize=function(e,c){r.tasklist.find('[data-module="'+e+'"][data-uuid="'+c+'"]').toggleClass("active",!1)},r.toggleNew=function(e,c,t){r.tasklist.find('[data-uuid="'+e+'"]').toggleClass("new",c),t||I.fire("action:taskbar.toggleNew",e)},r.updateActive=function(e){const c=r.tasklist.find("li");c.removeClass("active"),c.filter('[data-uuid="'+e+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+e+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},r.isActive=function(e){return r.tasklist.find('li[data-uuid="'+e+'"]').hasClass("active")};function p(){r.tasklist.find("li").length>0?r.taskbar.attr("data-active","1"):r.taskbar.removeAttr("data-active")}function f(){r.tasklist.find(".active").removeClass("active")}function l(e,c){m.translate(e.options.title,function(t){const n=$("<div></div>").text(t||"NodeBB Task").html(),a=$("<li></li>").addClass(e.options.className).html('<a href="#"'+(e.options.image?` style="background-image: url('`+e.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(e.options.icon?'<i class="fa '+e.options.icon+'"></i> ':"")+'<span aria-label="'+n+'" component="taskbar/title">'+n+"</span></a>").attr({title:n,"data-module":e.module,"data-uuid":e.uuid}).addClass(e.options.state!==void 0?e.options.state:"active");(!e.options.state||e.options.state==="active")&&f(),r.tasklist.append(a),p(),e.element=a,a.data(e),I.fire("action:taskbar.pushed",e),c(a)})}const o=function(e,c,t){switch(c){case"title":e.find('[component="taskbar/title"]').text(t);break;case"icon":e.find("i").attr("class","fa fa-"+t);break;case"image":e.find("a").css("background-image",t?'url("'+t.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":e.find("a").css("background-color",t);break}};return r.update=function(e,c,t){const n=r.tasklist.find('[data-module="'+e+'"][data-uuid="'+c+'"]');if(!n.length)return;const a=n.data();Object.keys(t).forEach(function(s){a[s]=t[s],o(n,s,t[s])}),n.data(a)},r}.apply(R,A),h!==void 0&&(v.exports=h)}}]);
