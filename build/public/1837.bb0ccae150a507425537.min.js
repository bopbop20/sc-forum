"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1837,3014,3034,4337],{74344:(v,y,c)=>{var A,h;A=[c(85233)],h=(E=>{const m={},I=config.relative_path+"/api/v3";function r(l,f){l.url=l.url.startsWith("/api")?config.relative_path+l.url:I+l.url;async function p(i){({options:l}=await E.fire("filter:api.options",{options:l})),$.ajax(l).done(n=>{i(null,n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n||{})}).fail(n=>{let u;n.responseJSON&&(u=n.responseJSON.status&&n.responseJSON.status.message?n.responseJSON.status.message:n.responseJSON.error),i(new Error(u||n.statusText))})}if(typeof f=="function"){p(f);return}return new Promise((i,n)=>{p(function(u,t){u?n(u):i(t)})})}return m.get=(l,f,p)=>r({url:l+(f&&Object.keys(f).length?"?"+$.param(f):"")},p),m.head=(l,f,p)=>r({url:l+(f&&Object.keys(f).length?"?"+$.param(f):""),method:"head"},p),m.post=(l,f,p)=>r({url:l,method:"post",data:JSON.stringify(f||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.patch=(l,f,p)=>r({url:l,method:"patch",data:JSON.stringify(f||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.put=(l,f,p)=>r({url:l,method:"put",data:JSON.stringify(f||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.del=(l,f,p)=>r({url:l,method:"delete",data:JSON.stringify(f),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.delete=m.del,m}).apply(y,A),h!==void 0&&(v.exports=h)},93216:(v,y,c)=>{var A,h;A=[c(7237),c(27145),c(32230),c(85233),c(31369),c(7927),c(74344)],h=function(E,m,I,r,l,f,p){const i={};let n=!1;i.openChat=function(t,e){if(!app.user.uid)return f.error("[[error:not-logged-in]]");function a(s){i.load(s.attr("data-uuid")),i.center(s),i.focusInput(s)}i.modalExists(t)?a(i.getModal(t)):p.get(`/chats/${t}`,{uid:e||app.user.uid}).then(s=>{s.users=s.users.filter(function(d){return d&&parseInt(d.uid,10)!==parseInt(app.user.uid,10)}),s.uid=e||app.user.uid,s.isSelf=!0,i.createModal(s,a)}).catch(f.error)},i.newChat=function(t,e){function a(){p.post("/chats",{uids:[t]}).then(({roomId:s})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+s):i.openChat(s),e(null,s)}).catch(f.error)}if(e=e||function(){},!app.user.uid)return f.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return f.error("[[error:cant-chat-with-yourself]]");socket.emit("modules.chats.isDnD",t,function(s,d){if(s)return f.error(s);if(!d)return a();l.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(g){g&&a()})})},i.loadChatsDropdown=function(t){socket.emit("modules.chats.getRecentChats",{uid:app.user.uid,after:0},function(e,a){if(e)return f.error(e);const s=a.rooms.filter(function(d){return d.teaser});I.toggleTimeagoShorthand(function(){for(let d=0;d<s.length;d+=1)s[d].teaser.timeago=$.timeago(new Date(parseInt(s[d].teaser.timestamp,10)));I.toggleTimeagoShorthand(),app.parseAndTranslate("partials/chats/dropdown",{rooms:s},function(d){t.find("*").not(".navigation-link").remove(),t.prepend(d),app.createUserTooltips(t,"right"),t.off("click").on("click","[data-roomid]",function(g){if($(g.target).parents(".user-link").length)return;const o=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+o):i.openChat(o)}),$('[component="chats/mark-all-read"]').off("click").on("click",function(){socket.emit("modules.chats.markAllRead",function(g){if(g)return f.error(g)})})})})})},i.onChatMessageReceived=function(t){const e=t.self===1;t.message.self=t.self,n=t.self===0,i.modalExists(t.roomId)?u(t):ajaxify.data.template.chats||p.get(`/chats/${t.roomId}`,{}).then(a=>{a.users=a.users.filter(function(s){return s&&parseInt(s.uid,10)!==parseInt(app.user.uid,10)}),a.silent=!0,a.uid=app.user.uid,a.isSelf=e,i.createModal(a)}).catch(f.error)};function u(t){const e=i.getModal(t.roomId),a=t.message.fromUser.username,s=t.self===1;c.e(6862).then(function(){var d=[c(46862)];(function(g){e.find('[data-mid="'+t.message.messageId+'"]').length||g.appendChatMessage(e.find(".chat-content"),t.message),e.is(":visible")?(m.updateActive(e.attr("data-uuid")),g.isAtBottom(e.find(".chat-content"))&&g.scrollToBottom(e.find(".chat-content"))):ajaxify.data.template.chats||i.toggleNew(e.attr("data-uuid"),!0,!0),!s&&(!e.is(":visible")||!app.isFocused)&&m.push("chat",e.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||a),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,d)}).catch(c.oe)}return i.onUserStatusChange=function(t){const e=i.getModal(t.uid);app.updateUserStatus(e.find('[component="user/status"]'),t.status)},i.onRoomRename=function(t){const e=$("<div></div>").html(t.newName).text(),a=i.getModal(t.roomId);a.find('[component="chat/room/name"]').text(e),m.update("chat",a.attr("data-uuid"),{title:e}),r.fire("action:chat.renamed",Object.assign(t,{modal:a}))},i.getModal=function(t){return $("#chat-modal-"+t)},i.modalExists=function(t){return $("#chat-modal-"+t).length!==0},i.createModal=function(t,e){e=e||function(){},Promise.all([c.e(2441),c.e(1006),c.e(4271),c.e(9789)]).then(function(){var a=[c(75203),c(30524),c(46862)];(function(s,d,g){app.parseAndTranslate("chat",t,function(o){if(i.modalExists(t.roomId))return e(i.getModal(t.roomId));const R=utils.generateUUID();let C=!1;o.attr("id","chat-modal-"+t.roomId),o.attr("data-roomid",t.roomId),o.attr("intervalId",0),o.attr("data-uuid",R),o.css("position","fixed"),o.appendTo($("body")),o.find(".timeago").timeago(),i.center(o),app.loadJQueryUI(function(){o.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),o.find(".modal-content").on("resize",function(x,S){S.originalSize.height!==S.size.height&&o.find(".modal-body").css("height",i.calculateChatListHeight(o))}),o.draggable({start:function(){m.updateActive(R)},stop:function(){i.focusInput(o)},distance:10,handle:".modal-header"})}),s.apply(o.find('[component="chat/messages"]')),o.find("#chat-close-btn").on("click",function(){i.close(o)});function N(){const x=E.get("chat/input").val();$(window).one("action:ajaxify.end",function(){E.get("chat/input").val(x)}),ajaxify.go("user/"+app.user.userslug+"/chats/"+o.attr("data-roomid")),i.close(o)}o.find(".modal-header").on("dblclick",N),o.find('button[data-action="maximize"]').on("click",N),o.find('button[data-action="minimize"]').on("click",function(){const x=o.attr("data-uuid");i.minimize(x)}),o.on("mouseup",function(){m.updateActive(o.attr("data-uuid")),C&&(C=!1)}),o.on("mousemove",function(x){x.which===1&&(C=!0)}),o.on("mousemove keypress click",function(){n&&(socket.emit("modules.chats.markRead",t.roomId),n=!1)}),d.addActionHandlers(o.find('[component="chat/messages"]'),t.roomId),d.addRenameHandler(o.attr("data-roomid"),o.find('[data-action="rename"]'),t.roomName),d.addLeaveHandler(o.attr("data-roomid"),o.find('[data-action="leave"]')),d.addSendHandlers(o.attr("data-roomid"),o.find(".chat-input"),o.find('[data-action="send"]')),d.addMemberHandler(o.attr("data-roomid"),o.find('[data-action="members"]')),d.createAutoComplete(o.find('[component="chat/input"]')),d.addScrollHandler(o.attr("data-roomid"),t.uid,o.find(".chat-content")),d.addScrollBottomHandler(o.find(".chat-content")),d.addCharactersLeftHandler(o),d.addIPHandler(o),d.addUploadHandler({dragDropAreaEl:o.find(".modal-content"),pasteEl:o,uploadFormEl:o.find('[component="chat/upload"]'),inputEl:o.find('[component="chat/input"]')}),g.addSocketListeners(),m.push("chat",o.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){m.toggleNew(o.attr("data-uuid"),!t.isSelf),r.fire("action:chat.loaded",o),typeof e=="function"&&e(o)})})}).apply(null,a)}).catch(c.oe)},i.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},i.close=function(t){const e=t.attr("data-uuid");clearInterval(t.attr("intervalId")),t.attr("intervalId",0),t.remove(),t.data("modal",null),m.discard("chat",e),t.attr("data-mobile")&&i.disableMobileBehaviour(t),r.fire("action:chat.closed",{uuid:e,modal:t})},i.closeByUUID=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');i.close(e)},i.center=function(t){let e=!1;return t.hasClass("hide")&&(t.removeClass("hide"),e=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),e&&t.addClass("hide"),t},i.load=function(t){c.e(6862).then(function(){var e=[c(46862)];(function(a){const s=$('.chat-modal[data-uuid="'+t+'"]');s.removeClass("hide"),m.updateActive(t),a.scrollToBottom(s.find(".chat-content")),i.focusInput(s),socket.emit("modules.chats.markRead",s.attr("data-roomid"));const d=utils.findBootstrapEnvironment();(d==="xs"||d==="sm")&&i.enableMobileBehaviour(s)}).apply(null,e)}).catch(c.oe)},i.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const e=t.find(".modal-body");e.css("height",i.calculateChatListHeight(t));function a(){e.css("height",i.calculateChatListHeight(t)),c.e(6862).then(function(){var s=[c(46862)];(function(d){d.scrollToBottom(t.find(".chat-content"))}).apply(null,s)}).catch(c.oe)}$(window).on("resize",a),$(window).one("action:ajaxify.start",function(){i.close(t),$(window).off("resize",a)})},i.disableMobileBehaviour=function(){app.toggleNavbar(!0)},i.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},i.minimize=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');e.addClass("hide"),m.minimize("chat",t),clearInterval(e.attr("intervalId")),e.attr("intervalId",0),r.fire("action:chat.minimized",{uuid:t,modal:e})},i.toggleNew=m.toggleNew,i}.apply(y,A),h!==void 0&&(v.exports=h)},27145:(v,y,c)=>{v=c.nmd(v);var A,h;A=[c(59006),c(32230),c(85233)],h=function(E,m,I){const r={};r.init=function(){const n=this;E.render("modules/taskbar",{}).then(function(u){n.taskbar=$(u),n.tasklist=n.taskbar.find("ul"),$(document.body).append(n.taskbar),n.taskbar.on("click","li",async function(){const t=$(this),e=t.attr("data-module"),a=t.attr("data-uuid"),s=await app.require(e);return t.hasClass("active")?s.minimize(a):(f(),s.load(a),r.toggleNew(a,!1),r.tasklist.removeClass("active"),t.addClass("active")),!1})}),$(window).on("action:app.loggedOut",function(){r.closeAll()})},r.close=async function(n,u){const t=r.tasklist.find('[data-module="'+v+'"][data-uuid="'+u+'"]');let e="close";if(n==="chat"&&(e="closeByUUID"),t.length){const a=await app.require(n);a&&typeof a[e]=="function"&&a[e](u)}},r.closeAll=function(n){let u="[data-uuid]";n&&(u='[data-module="'+n+'"]'+u),r.tasklist.find(u).each(function(t,e){r.close(n||e.getAttribute("data-module"),e.getAttribute("data-uuid"))})},r.discard=function(n,u){r.tasklist.find('[data-module="'+n+'"][data-uuid="'+u+'"]').remove(),l()},r.push=function(n,u,t,e){e=e||function(){};const a=r.tasklist.find('li[data-uuid="'+u+'"]'),s={module:n,uuid:u,options:t,element:a};I.fire("filter:taskbar.push",s),!a.length&&s.module?p(s,e):e(a)},r.get=function(n){return $('[data-module="'+n+'"]').map(function(t,e){return $(e).data()})},r.minimize=function(n,u){r.tasklist.find('[data-module="'+n+'"][data-uuid="'+u+'"]').toggleClass("active",!1)},r.toggleNew=function(n,u,t){r.tasklist.find('[data-uuid="'+n+'"]').toggleClass("new",u),t||I.fire("action:taskbar.toggleNew",n)},r.updateActive=function(n){const u=r.tasklist.find("li");u.removeClass("active"),u.filter('[data-uuid="'+n+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+n+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},r.isActive=function(n){return r.tasklist.find('li[data-uuid="'+n+'"]').hasClass("active")};function l(){r.tasklist.find("li").length>0?r.taskbar.attr("data-active","1"):r.taskbar.removeAttr("data-active")}function f(){r.tasklist.find(".active").removeClass("active")}function p(n,u){m.translate(n.options.title,function(t){const e=$("<div></div>").text(t||"NodeBB Task").html(),a=$("<li></li>").addClass(n.options.className).html('<a href="#"'+(n.options.image?` style="background-image: url('`+n.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(n.options.icon?'<i class="fa '+n.options.icon+'"></i> ':"")+'<span aria-label="'+e+'" component="taskbar/title">'+e+"</span></a>").attr({title:e,"data-module":n.module,"data-uuid":n.uuid}).addClass(n.options.state!==void 0?n.options.state:"active");(!n.options.state||n.options.state==="active")&&f(),r.tasklist.append(a),l(),n.element=a,a.data(n),I.fire("action:taskbar.pushed",n),u(a)})}const i=function(n,u,t){switch(u){case"title":n.find('[component="taskbar/title"]').text(t);break;case"icon":n.find("i").attr("class","fa fa-"+t);break;case"image":n.find("a").css("background-image",t?'url("'+t.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":n.find("a").css("background-color",t);break}};return r.update=function(n,u,t){const e=r.tasklist.find('[data-module="'+n+'"][data-uuid="'+u+'"]');if(!e.length)return;const a=e.data();Object.keys(t).forEach(function(s){a[s]=t[s],i(e,s,t[s])}),e.data(a)},r}.apply(y,A),h!==void 0&&(v.exports=h)}}]);
