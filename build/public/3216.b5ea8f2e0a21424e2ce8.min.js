"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3216,3014,3034,7927,4337,1837],{7927:(I,y,c)=>{var A,g;A=[c(32230),c(7237),c(85233)],g=function(E,m,h){const a={};a.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:new Date().getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const i=$("#"+e.alert_id);i.length?d(i,e):l(e)},a.success=function(e,i){a.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:i||5e3})},a.error=function(e,i){if(e=e&&e.message||e,e==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}a.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:i||1e4})},a.remove=function(e){$("#alert_button_"+e).remove()};function l(e){app.parseAndTranslate("alert",e,function(i){let t=$("#"+e.alert_id);if(t.length)return d(t,e);t=i,t.fadeIn(200),m.get("toaster/tray").prepend(t),typeof e.closefn=="function"&&t.find("button").on("click",function(){return e.closefn(),p(t),!1}),e.timeout&&o(t,e),typeof e.clickfn=="function"&&t.addClass("pointer").on("click",function(n){$(n.target).is(".close")||e.clickfn(t,e),p(t)}),h.fire("action:alert.new",{alert:t,params:e})})}function d(e,i){e.find("strong").translateHtml(i.title),e.find("p").translateHtml(i.message),e.attr("class","alert alert-dismissable alert-"+i.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),i.timeout&&o(e,i),h.fire("action:alert.update",{alert:e,params:i}),e.off("click").removeClass("pointer"),typeof i.clickfn=="function"&&e.addClass("pointer").on("click",function(t){$(t.target).is(".close")||i.clickfn(),p(e)})}function p(e){e.fadeOut(500,function(){$(this).remove()})}function o(e,i){const t=i.timeout,n=setTimeout(function(){p(e),typeof i.timeoutfn=="function"&&i.timeoutfn(e,i)},t);e.attr("timeoutId",n),e.css("transition-property","none"),e.removeClass("animate"),setTimeout(function(){e.css("transition-property",""),e.css("transition","width "+(t+450)+"ms linear, background-color "+(t+450)+"ms ease-in"),e.addClass("animate"),h.fire("action:alert.animate",{alert:e,params:i})},50),e.on("mouseenter",function(){$(this).css("transition-duration",0)})}return a}.apply(y,A),g!==void 0&&(I.exports=g)},74344:(I,y,c)=>{var A,g;A=[c(85233)],g=(E=>{const m={},h=config.relative_path+"/api/v3";function a(l,d){l.url=l.url.startsWith("/api")?config.relative_path+l.url:h+l.url;async function p(o){({options:l}=await E.fire("filter:api.options",{options:l})),$.ajax(l).done(e=>{o(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})}).fail(e=>{let i;e.responseJSON&&(i=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),o(new Error(i||e.statusText))})}if(typeof d=="function"){p(d);return}return new Promise((o,e)=>{p(function(i,t){i?e(i):o(t)})})}return m.get=(l,d,p)=>a({url:l+(d&&Object.keys(d).length?"?"+$.param(d):"")},p),m.head=(l,d,p)=>a({url:l+(d&&Object.keys(d).length?"?"+$.param(d):""),method:"head"},p),m.post=(l,d,p)=>a({url:l,method:"post",data:JSON.stringify(d||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.patch=(l,d,p)=>a({url:l,method:"patch",data:JSON.stringify(d||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.put=(l,d,p)=>a({url:l,method:"put",data:JSON.stringify(d||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.del=(l,d,p)=>a({url:l,method:"delete",data:JSON.stringify(d),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.delete=m.del,m}).apply(y,A),g!==void 0&&(I.exports=g)},93216:(I,y,c)=>{var A,g;A=[c(7237),c(27145),c(32230),c(85233),c(31369),c(7927),c(74344)],g=function(E,m,h,a,l,d,p){const o={};let e=!1;o.openChat=function(t,n){if(!app.user.uid)return d.error("[[error:not-logged-in]]");function u(r){o.load(r.attr("data-uuid")),o.center(r),o.focusInput(r)}o.modalExists(t)?u(o.getModal(t)):p.get(`/chats/${t}`,{uid:n||app.user.uid}).then(r=>{r.users=r.users.filter(function(f){return f&&parseInt(f.uid,10)!==parseInt(app.user.uid,10)}),r.uid=n||app.user.uid,r.isSelf=!0,o.createModal(r,u)}).catch(d.error)},o.newChat=function(t,n){function u(){p.post("/chats",{uids:[t]}).then(({roomId:r})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+r):o.openChat(r),n(null,r)}).catch(d.error)}if(n=n||function(){},!app.user.uid)return d.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return d.error("[[error:cant-chat-with-yourself]]");socket.emit("modules.chats.isDnD",t,function(r,f){if(r)return d.error(r);if(!f)return u();l.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(v){v&&u()})})},o.loadChatsDropdown=function(t){socket.emit("modules.chats.getRecentChats",{uid:app.user.uid,after:0},function(n,u){if(n)return d.error(n);const r=u.rooms.filter(function(f){return f.teaser});h.toggleTimeagoShorthand(function(){for(let f=0;f<r.length;f+=1)r[f].teaser.timeago=$.timeago(new Date(parseInt(r[f].teaser.timestamp,10)));h.toggleTimeagoShorthand(),app.parseAndTranslate("partials/chats/dropdown",{rooms:r},function(f){t.find("*").not(".navigation-link").remove(),t.prepend(f),app.createUserTooltips(t,"right"),t.off("click").on("click","[data-roomid]",function(v){if($(v.target).parents(".user-link").length)return;const s=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+s):o.openChat(s)}),$('[component="chats/mark-all-read"]').off("click").on("click",function(){socket.emit("modules.chats.markAllRead",function(v){if(v)return d.error(v)})})})})})},o.onChatMessageReceived=function(t){const n=t.self===1;t.message.self=t.self,e=t.self===0,o.modalExists(t.roomId)?i(t):ajaxify.data.template.chats||p.get(`/chats/${t.roomId}`,{}).then(u=>{u.users=u.users.filter(function(r){return r&&parseInt(r.uid,10)!==parseInt(app.user.uid,10)}),u.silent=!0,u.uid=app.user.uid,u.isSelf=n,o.createModal(u)}).catch(d.error)};function i(t){const n=o.getModal(t.roomId),u=t.message.fromUser.username,r=t.self===1;c.e(6862).then(function(){var f=[c(46862)];(function(v){n.find('[data-mid="'+t.message.messageId+'"]').length||v.appendChatMessage(n.find(".chat-content"),t.message),n.is(":visible")?(m.updateActive(n.attr("data-uuid")),v.isAtBottom(n.find(".chat-content"))&&v.scrollToBottom(n.find(".chat-content"))):ajaxify.data.template.chats||o.toggleNew(n.attr("data-uuid"),!0,!0),!r&&(!n.is(":visible")||!app.isFocused)&&m.push("chat",n.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||u),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,f)}).catch(c.oe)}return o.onUserStatusChange=function(t){const n=o.getModal(t.uid);app.updateUserStatus(n.find('[component="user/status"]'),t.status)},o.onRoomRename=function(t){const n=$("<div></div>").html(t.newName).text(),u=o.getModal(t.roomId);u.find('[component="chat/room/name"]').text(n),m.update("chat",u.attr("data-uuid"),{title:n}),a.fire("action:chat.renamed",Object.assign(t,{modal:u}))},o.getModal=function(t){return $("#chat-modal-"+t)},o.modalExists=function(t){return $("#chat-modal-"+t).length!==0},o.createModal=function(t,n){n=n||function(){},Promise.all([c.e(2441),c.e(1006),c.e(4271),c.e(9789)]).then(function(){var u=[c(75203),c(30524),c(46862)];(function(r,f,v){app.parseAndTranslate("chat",t,function(s){if(o.modalExists(t.roomId))return n(o.getModal(t.roomId));const R=utils.generateUUID();let x=!1;s.attr("id","chat-modal-"+t.roomId),s.attr("data-roomid",t.roomId),s.attr("intervalId",0),s.attr("data-uuid",R),s.css("position","fixed"),s.appendTo($("body")),s.find(".timeago").timeago(),o.center(s),app.loadJQueryUI(function(){s.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),s.find(".modal-content").on("resize",function(C,N){N.originalSize.height!==N.size.height&&s.find(".modal-body").css("height",o.calculateChatListHeight(s))}),s.draggable({start:function(){m.updateActive(R)},stop:function(){o.focusInput(s)},distance:10,handle:".modal-header"})}),r.apply(s.find('[component="chat/messages"]')),s.find("#chat-close-btn").on("click",function(){o.close(s)});function k(){const C=E.get("chat/input").val();$(window).one("action:ajaxify.end",function(){E.get("chat/input").val(C)}),ajaxify.go("user/"+app.user.userslug+"/chats/"+s.attr("data-roomid")),o.close(s)}s.find(".modal-header").on("dblclick",k),s.find('button[data-action="maximize"]').on("click",k),s.find('button[data-action="minimize"]').on("click",function(){const C=s.attr("data-uuid");o.minimize(C)}),s.on("mouseup",function(){m.updateActive(s.attr("data-uuid")),x&&(x=!1)}),s.on("mousemove",function(C){C.which===1&&(x=!0)}),s.on("mousemove keypress click",function(){e&&(socket.emit("modules.chats.markRead",t.roomId),e=!1)}),f.addActionHandlers(s.find('[component="chat/messages"]'),t.roomId),f.addRenameHandler(s.attr("data-roomid"),s.find('[data-action="rename"]'),t.roomName),f.addLeaveHandler(s.attr("data-roomid"),s.find('[data-action="leave"]')),f.addSendHandlers(s.attr("data-roomid"),s.find(".chat-input"),s.find('[data-action="send"]')),f.addMemberHandler(s.attr("data-roomid"),s.find('[data-action="members"]')),f.createAutoComplete(s.find('[component="chat/input"]')),f.addScrollHandler(s.attr("data-roomid"),t.uid,s.find(".chat-content")),f.addScrollBottomHandler(s.find(".chat-content")),f.addCharactersLeftHandler(s),f.addIPHandler(s),f.addUploadHandler({dragDropAreaEl:s.find(".modal-content"),pasteEl:s,uploadFormEl:s.find('[component="chat/upload"]'),inputEl:s.find('[component="chat/input"]')}),v.addSocketListeners(),m.push("chat",s.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){m.toggleNew(s.attr("data-uuid"),!t.isSelf),a.fire("action:chat.loaded",s),typeof n=="function"&&n(s)})})}).apply(null,u)}).catch(c.oe)},o.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},o.close=function(t){const n=t.attr("data-uuid");clearInterval(t.attr("intervalId")),t.attr("intervalId",0),t.remove(),t.data("modal",null),m.discard("chat",n),t.attr("data-mobile")&&o.disableMobileBehaviour(t),a.fire("action:chat.closed",{uuid:n,modal:t})},o.closeByUUID=function(t){const n=$('.chat-modal[data-uuid="'+t+'"]');o.close(n)},o.center=function(t){let n=!1;return t.hasClass("hide")&&(t.removeClass("hide"),n=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),n&&t.addClass("hide"),t},o.load=function(t){c.e(6862).then(function(){var n=[c(46862)];(function(u){const r=$('.chat-modal[data-uuid="'+t+'"]');r.removeClass("hide"),m.updateActive(t),u.scrollToBottom(r.find(".chat-content")),o.focusInput(r),socket.emit("modules.chats.markRead",r.attr("data-roomid"));const f=utils.findBootstrapEnvironment();(f==="xs"||f==="sm")&&o.enableMobileBehaviour(r)}).apply(null,n)}).catch(c.oe)},o.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const n=t.find(".modal-body");n.css("height",o.calculateChatListHeight(t));function u(){n.css("height",o.calculateChatListHeight(t)),c.e(6862).then(function(){var r=[c(46862)];(function(f){f.scrollToBottom(t.find(".chat-content"))}).apply(null,r)}).catch(c.oe)}$(window).on("resize",u),$(window).one("action:ajaxify.start",function(){o.close(t),$(window).off("resize",u)})},o.disableMobileBehaviour=function(){app.toggleNavbar(!0)},o.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},o.minimize=function(t){const n=$('.chat-modal[data-uuid="'+t+'"]');n.addClass("hide"),m.minimize("chat",t),clearInterval(n.attr("intervalId")),n.attr("intervalId",0),a.fire("action:chat.minimized",{uuid:t,modal:n})},o.toggleNew=m.toggleNew,o}.apply(y,A),g!==void 0&&(I.exports=g)},27145:(I,y,c)=>{I=c.nmd(I);var A,g;A=[c(59006),c(32230),c(85233)],g=function(E,m,h){const a={};a.init=function(){const e=this;E.render("modules/taskbar",{}).then(function(i){e.taskbar=$(i),e.tasklist=e.taskbar.find("ul"),$(document.body).append(e.taskbar),e.taskbar.on("click","li",async function(){const t=$(this),n=t.attr("data-module"),u=t.attr("data-uuid"),r=await app.require(n);return t.hasClass("active")?r.minimize(u):(d(),r.load(u),a.toggleNew(u,!1),a.tasklist.removeClass("active"),t.addClass("active")),!1})}),$(window).on("action:app.loggedOut",function(){a.closeAll()})},a.close=async function(e,i){const t=a.tasklist.find('[data-module="'+I+'"][data-uuid="'+i+'"]');let n="close";if(e==="chat"&&(n="closeByUUID"),t.length){const u=await app.require(e);u&&typeof u[n]=="function"&&u[n](i)}},a.closeAll=function(e){let i="[data-uuid]";e&&(i='[data-module="'+e+'"]'+i),a.tasklist.find(i).each(function(t,n){a.close(e||n.getAttribute("data-module"),n.getAttribute("data-uuid"))})},a.discard=function(e,i){a.tasklist.find('[data-module="'+e+'"][data-uuid="'+i+'"]').remove(),l()},a.push=function(e,i,t,n){n=n||function(){};const u=a.tasklist.find('li[data-uuid="'+i+'"]'),r={module:e,uuid:i,options:t,element:u};h.fire("filter:taskbar.push",r),!u.length&&r.module?p(r,n):n(u)},a.get=function(e){return $('[data-module="'+e+'"]').map(function(t,n){return $(n).data()})},a.minimize=function(e,i){a.tasklist.find('[data-module="'+e+'"][data-uuid="'+i+'"]').toggleClass("active",!1)},a.toggleNew=function(e,i,t){a.tasklist.find('[data-uuid="'+e+'"]').toggleClass("new",i),t||h.fire("action:taskbar.toggleNew",e)},a.updateActive=function(e){const i=a.tasklist.find("li");i.removeClass("active"),i.filter('[data-uuid="'+e+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+e+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},a.isActive=function(e){return a.tasklist.find('li[data-uuid="'+e+'"]').hasClass("active")};function l(){a.tasklist.find("li").length>0?a.taskbar.attr("data-active","1"):a.taskbar.removeAttr("data-active")}function d(){a.tasklist.find(".active").removeClass("active")}function p(e,i){m.translate(e.options.title,function(t){const n=$("<div></div>").text(t||"NodeBB Task").html(),u=$("<li></li>").addClass(e.options.className).html('<a href="#"'+(e.options.image?` style="background-image: url('`+e.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(e.options.icon?'<i class="fa '+e.options.icon+'"></i> ':"")+'<span aria-label="'+n+'" component="taskbar/title">'+n+"</span></a>").attr({title:n,"data-module":e.module,"data-uuid":e.uuid}).addClass(e.options.state!==void 0?e.options.state:"active");(!e.options.state||e.options.state==="active")&&d(),a.tasklist.append(u),l(),e.element=u,u.data(e),h.fire("action:taskbar.pushed",e),i(u)})}const o=function(e,i,t){switch(i){case"title":e.find('[component="taskbar/title"]').text(t);break;case"icon":e.find("i").attr("class","fa fa-"+t);break;case"image":e.find("a").css("background-image",t?'url("'+t.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":e.find("a").css("background-color",t);break}};return a.update=function(e,i,t){const n=a.tasklist.find('[data-module="'+e+'"][data-uuid="'+i+'"]');if(!n.length)return;const u=n.data();Object.keys(t).forEach(function(r){u[r]=t[r],o(n,r,t[r])}),n.data(u)},a}.apply(y,A),g!==void 0&&(I.exports=g)}}]);
