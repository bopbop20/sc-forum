"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4422,8704],{7217:(b,v,f)=>{var w,p;w=[f(25142),f(78942),f(42840),f(14745),f(69241),f(50548),f(85233),f(7927)],p=function(A,S,u,l,s,c,e,t){const r={};$(window).on("action:ajaxify.start",function(g,C){String(C.url).startsWith("category/")||u.disable()}),r.init=function(){const g=ajaxify.data.cid;app.enterRoom("category_"+g),S.addShareHandlers(ajaxify.data.name),l.init("category",m),s.handleSort("categoryTopicSort","category/"+ajaxify.data.slug),config.usePagination?u.disable():u.init('[component="category/topic"]',ajaxify.data.topic_count,r.toTop,r.toBottom,r.navigatorCallback),n(),d(g),a(),c.init($('[component="category-selector"]'),{privilege:"find",parentCid:ajaxify.data.cid,onSelect:function(C){ajaxify.go("/category/"+C.cid)}}),e.fire("action:topics.loaded",{topics:ajaxify.data.topics}),e.fire("action:category.loaded",{cid:ajaxify.data.cid})};function n(){let g=ajaxify.data.topicIndex;g&&utils.isNumber(g)&&(g=Math.max(0,parseInt(g,10)),g&&window.location.search.indexOf("page=")===-1&&u.scrollToElement($('[component="category/topic"][data-index="'+g+'"]'),!0,0))}function d(g){$('[component="category/watching"], [component="category/ignoring"], [component="category/notwatching"]').on("click",function(){const h=$(this).attr("data-state");socket.emit("categories.setWatchState",{cid:g,state:h},function(T){if(T)return t.error(T);$('[component="category/watching/menu"]').toggleClass("hidden",h!=="watching"),$('[component="category/watching/check"]').toggleClass("fa-check",h==="watching"),$('[component="category/notwatching/menu"]').toggleClass("hidden",h!=="notwatching"),$('[component="category/notwatching/check"]').toggleClass("fa-check",h==="notwatching"),$('[component="category/ignoring/menu"]').toggleClass("hidden",h!=="ignoring"),$('[component="category/ignoring/check"]').toggleClass("fa-check",h==="ignoring"),t.success("[[category:"+h+".message]]")})})}function a(){$('[component="category/load-more-subcategories"]').on("click",function(){const g=$(this);return socket.emit("categories.loadMoreSubCategories",{cid:ajaxify.data.cid,start:ajaxify.data.nextSubCategoryStart},function(C,h){if(C)return t.error(C);g.toggleClass("hidden",!h.length||h.length<ajaxify.data.subCategoriesPerPage),h.length&&app.parseAndTranslate("category","children",{children:h},function(T){T.find(".timeago").timeago(),$('[component="category/subcategory/container"]').append(T),utils.makeNumbersHumanReadable(T.find(".human-readable-number")),app.createUserTooltips(T),ajaxify.data.nextSubCategoryStart+=ajaxify.data.subCategoriesPerPage,ajaxify.data.subCategoriesLeft-=h.length,g.toggleClass("hidden",ajaxify.data.subCategoriesLeft<=0).translateText("[[category:x-more-categories, "+ajaxify.data.subCategoriesLeft+"]]")})}),!1})}r.toTop=function(){u.scrollTop(0)},r.toBottom=function(){socket.emit("categories.getTopicCount",ajaxify.data.cid,function(g,C){if(g)return t.error(g);u.scrollBottom(C-1)})},r.navigatorCallback=function(g,C){return C};function m(g,C,h){h=h||function(){},e.fire("action:topics.loading");const T=utils.params();A.loadMore("categories.loadMore",{cid:ajaxify.data.cid,after:g,direction:C,query:T,categoryTopicSort:config.categoryTopicSort},function(D,M){e.fire("action:topics.loaded",{topics:D.topics}),h(D,M)})}return r}.apply(v,w),p!==void 0&&(b.exports=p)},39941:(b,v,f)=>{var w,p;w=[f(22905),f(74344),f(85233)],p=function(A,S,u){const l={};l.init=function(c,e){if(!c||!c.length)return;e=e||{},e.states=e.states||["watching","notwatching","ignoring"],e.template="partials/category-filter",u.fire("action:category.filter.options",{el:c,options:e}),A.init(c,e);let t=[],r=[];Array.isArray(e.selectedCids)?t=e.selectedCids.map(n=>parseInt(n,10)):Array.isArray(ajaxify.data.selectedCids)&&(t=ajaxify.data.selectedCids.map(n=>parseInt(n,10))),r=t.slice(),c.on("hidden.bs.dropdown",function(){let n=r.length!==t.length;if(r.forEach(function(d,a){d!==t[a]&&(n=!0)}),n&&s(c,t),e.onHidden){e.onHidden({changed:n,selectedCids:t.slice()});return}if(n){let d=window.location.pathname;const a=utils.params();t.length&&(a.cid=t,d+="?"+decodeURIComponent($.param(a))),ajaxify.go(d)}}),c.on("click",'[component="category/list"] [data-cid]',function(){const n=c.find('[component="category/list"]'),d=$(this),a=d.find("a").attr("href");if(a&&a!=="#"&&a.length)return;const m=parseInt(d.attr("data-cid"),10),g=d.find('[component="category/select/icon"]');return t.includes(m)?t.splice(t.indexOf(m),1):t.push(m),t.sort(function(C,h){return C-h}),e.selectedCids=t,g.toggleClass("invisible"),n.find('li[data-all="all"] i').toggleClass("invisible",!!t.length),e.onSelect&&e.onSelect({cid:m,selectedCids:t.slice()}),!1})};function s(c,e){e.length>1?t({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):e.length===1?S.get(`/categories/${e[0]}`,{}).then(t):t();function t(r){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:r},function(n){c.find("button").replaceWith($("<div/>").html(n).find("button"))})}}return l}.apply(v,w),p!==void 0&&(b.exports=p)},22905:(b,v,f)=>{var w,p;w=[f(7927)],p=function(A){const S={};return S.init=function(u,l){let s=null;l=l||{},l.privilege=l.privilege||"topics:read",l.states=l.states||["watching","notwatching","ignoring"];let c=[];Array.isArray(l.localCategories)&&(c=l.localCategories.map(d=>({...d}))),l.selectedCids=l.selectedCids||ajaxify.data.selectedCids||[];const e=u.find('[component="category-selector-search"]');if(!e.length)return;const t=e.parent('[component="category/dropdown"]').length>0||e.parent('[component="category-selector"]').length>0;u.on("show.bs.dropdown",function(){t&&(u.find(".dropdown-toggle").addClass("hidden"),e.removeClass("hidden"));function d(){const a=e.find("input").val();a.length>1||!a&&!s?r(a,function(m){s=s||m,n(m)}):!a&&s&&(s.forEach(function(m){m.selected=l.selectedCids.includes(m.cid)}),n(s))}e.on("click",function(a){a.preventDefault(),a.stopPropagation()}),e.find("input").val("").on("keyup",utils.debounce(d,300)),d()}),u.on("shown.bs.dropdown",function(){e.find("input").focus()}),u.on("hide.bs.dropdown",function(){t&&(u.find(".dropdown-toggle").removeClass("hidden"),e.addClass("hidden")),e.off("click"),e.find("input").off("keyup")});function r(d,a){socket.emit("categories.categorySearch",{search:d,query:utils.params(),parentCid:l.parentCid||0,selectedCids:l.selectedCids,privilege:l.privilege,states:l.states,showLinks:l.showLinks},function(m,g){if(m)return A.error(m);a(c.concat(g))})}function n(d){app.parseAndTranslate(l.template,{categoryItems:d.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(a){u.find('[component="category/list"]').replaceWith(a.find('[component="category/list"]')),u.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!d.length)})}},S}.apply(v,w),p!==void 0&&(b.exports=p)},50548:(b,v,f)=>{var w,p;w=[f(22905),f(31369),f(85233)],p=function(A,S,u){const l={};return l.init=function(s,c){if(!s||!s.length)return;c=c||{};const e=c.onSelect||function(){};c.states=c.states||["watching","notwatching","ignoring"],c.template="partials/category-selector",u.fire("action:category.selector.options",{el:s,options:c}),A.init(s,c);const t={el:s,selectedCategory:null};s.on("click","[data-cid]",function(){const n=$(this);if(n.hasClass("disabled"))return!1;t.selectCategory(n.attr("data-cid")),e(t.selectedCategory)});const r=t.el.find('[component="category-selector-selected"]').html();return t.selectCategory=function(n){const d=t.el.find('[data-cid="'+n+'"]');t.selectedCategory={cid:n,name:d.attr("data-name")},d.length?t.el.find('[component="category-selector-selected"]').html(d.find('[component="category-markup"]').html()):t.el.find('[component="category-selector-selected"]').html(r)},t.getSelectedCategory=function(){return t.selectedCategory},t.getSelectedCid=function(){return t.selectedCategory?t.selectedCategory.cid:0},t},l.modal=function(s){s=s||{},s.onSelect=s.onSelect||function(){},s.onSubmit=s.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:s.message},function(c){const e=S.dialog({title:s.title||"[[modules:composer.select_category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:r}}}),t=l.init(e.find('[component="category-selector"]'),s);function r(n){return n.preventDefault(),t.selectedCategory&&(s.onSubmit(t.selectedCategory),e.modal("hide")),!1}s.openOnLoad&&e.on("shown.bs.modal",function(){e.find(".dropdown-toggle").dropdown("toggle")}),e.find("form").on("submit",r)})},l}.apply(v,w),p!==void 0&&(b.exports=p)},69241:(b,v,f)=>{var w,p;w=[f(7237),f(74344)],p=function(A,S){const u={};return u.handleSort=function(l,s){const c=A.get("thread/sort");c.find("i").removeClass("fa-check"),c.find('a[data-sort="'+config[l]+'"]').find("i").addClass("fa-check"),$("body").off("click",'[component="thread/sort"] a').on("click",'[component="thread/sort"] a',function(){function t(n,d){config[l]=n;const a=decodeURIComponent($.param(d));ajaxify.go(s+(a?"?"+a:""))}const r=$(this).attr("data-sort");if(app.user.uid){const n={settings:{}};n.settings[l]=r,S.put(`/users/${app.user.uid}/settings`,n).then(()=>{t(r,utils.params())})}else{const n=utils.params();n.sort=r,t(r,n)}})},u}.apply(v,w),p!==void 0&&(b.exports=p)},14745:(b,v,f)=>{var w,p;w=[f(25142),f(66044),f(69941),f(39941),f(29412),f(85233)],p=function(A,S,u,l,s,c){const e={};let t="",r=0,n=0,d,a;const m=[];$(window).on("action:ajaxify.start",function(){e.removeListeners(),s.removeListeners()}),e.init=function(i,o){a=g(),t=i,d=o||M,s.init(),e.watchForNewPosts();const y=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?y.push("notwatching","ignoring"):i!=="unread"&&y.push("notwatching"),l.init($('[component="category/dropdown"]'),{states:y}),config.usePagination||A.init(e.loadMoreTopics),S.init(function(x,j){d(x,1,function(E,I){N(t,E.topics,ajaxify.data.showSelect,1,function(){j(),I()})})}),$("body").height()<=$(window).height()&&a.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){e.loadMoreTopics(1)}),c.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function g(){return $('[component="category"]').filter(function(i,o){return!$(o).parents("[widget-area],[data-widget-area]").length})}e.watchForNewPosts=function(){$("#new-topics-alert").on("click",function(){$(this).addClass("hide")}),n=0,r=0,e.removeListeners(),socket.on("event:new_topic",C),socket.on("event:new_post",h)},e.removeListeners=function(){socket.removeListener("event:new_topic",C),socket.removeListener("event:new_post",h)};function C(i){const o=ajaxify.data,y=o.selectedCids&&o.selectedCids.length&&o.selectedCids.indexOf(parseInt(i.cid,10))===-1,x=o.selectedFilter&&o.selectedFilter.filter==="watched",j=o.template.category&&parseInt(o.cid,10)!==parseInt(i.cid,10),E=!!(y||x||j||m.includes(i.tid));c.fire("filter:topicList.onNewTopic",{topic:i,preventAlert:E}).then(I=>{I.preventAlert||(i.scheduled&&i.tid&&m.push(i.tid),r+=1,T())})}function h(i){const o=i.posts[0];if(!o||!o.topic||o.topic.isFollowing)return;const y=ajaxify.data,x=parseInt(o.topic.mainPid,10)===parseInt(o.pid,10),j=y.selectedCids&&y.selectedCids.length&&y.selectedCids.indexOf(parseInt(o.topic.cid,10))===-1,E=y.selectedFilter&&y.selectedFilter.filter==="new",I=y.selectedFilter&&y.selectedFilter.filter==="watched"&&!o.topic.isFollowing,L=y.template.category&&parseInt(y.cid,10)!==parseInt(o.topic.cid,10),F=!!(x||j||E||I||L);c.fire("filter:topicList.onNewPost",{post:o,preventAlert:F}).then(P=>{P.preventAlert||(n+=1,T())})}function T(){let i="";r===0?n===1?i="[[recent:there-is-a-new-post]]":n>1&&(i="[[recent:there-are-new-posts, "+n+"]]"):r===1?n===0?i="[[recent:there-is-a-new-topic]]":n===1?i="[[recent:there-is-a-new-topic-and-a-new-post]]":n>1&&(i="[[recent:there-is-a-new-topic-and-new-posts, "+n+"]]"):r>1&&(n===0?i="[[recent:there-are-new-topics, "+r+"]]":n===1?i="[[recent:there-are-new-topics-and-a-new-post, "+r+"]]":n>1&&(i="[[recent:there-are-new-topics-and-new-posts, "+r+", "+n+"]]")),i+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(i).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}e.loadMoreTopics=function(i){if(!a.length||!a.children().length)return;const o=a.find('[component="category/topic"]'),y=i>0?o.last():o.first(),x=(parseInt(y.attr("data-index"),10)||0)+(i>0?1:0);!utils.isNumber(x)||x===0&&a.find('[component="category/topic"][data-index="0"]').length||d(x,i,function(j,E){N(t,j.topics,ajaxify.data.showSelect,i,E)})};function D(i,o){return Math.floor(i/config.topicsPerPage)+(o>0?1:0)}function M(i,o,y){y=y||function(){};const x=utils.params();x.page=D(i,o),A.loadMoreXhr(x,y)}function R(i){return i.filter(function(o){return!a.find('[component="category/topic"][data-tid="'+o.tid+'"]').length})}function N(i,o,y,x,j){if(!o||!o.length||(o=R(o),!o.length))return $("#load-more-btn").hide(),j();let E,I;const L=a.find('[component="category/topic"]');x>0&&o.length?E=L.last():x<0&&o.length&&(I=L.first());const F={topics:o,showSelect:y,template:{name:i}};F.template[i]=!0,c.fire("action:topics.loading",{topics:o,after:E,before:I}),app.parseAndTranslate(i,"topics",F,function(P){if(a.removeClass("hidden"),$("#category-no-topics").remove(),E&&E.length)P.insertAfter(E);else if(I&&I.length){const W=$(document).height(),B=$(window).scrollTop();P.insertBefore(I),$(window).scrollTop(B+($(document).height()-W))}else a.append(P);u.getSelectedTids().length||A.removeExtra(a.find('[component="category/topic"]'),x,Math.max(60,config.topicsPerPage*3)),P.find(".timeago").timeago(),app.createUserTooltips(P),utils.makeNumbersHumanReadable(P.find(".human-readable-number")),c.fire("action:topics.loaded",{topics:o,template:i}),j()})}return e}.apply(v,w),p!==void 0&&(b.exports=p)}}]);
