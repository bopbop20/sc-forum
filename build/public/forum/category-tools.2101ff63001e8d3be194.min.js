"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[613,1375,8306],{29412:(D,R,i)=>{var C,m;C=[i(69941),i(60392),i(7237),i(74344),i(31369),i(7927)],m=function(n,f,t,y,v,A){const T={};T.init=function(){n.init(g),K(),t.get("topic/delete").on("click",function(){return h("del","/state","delete",a),!1}),t.get("topic/restore").on("click",function(){return h("put","/state","restore",a),!1}),t.get("topic/purge").on("click",function(){return h("del","","purge",a),!1}),t.get("topic/lock").on("click",function(){return h("put","/lock","lock",r),!1}),t.get("topic/unlock").on("click",function(){return h("del","/lock","unlock",r),!1}),t.get("topic/pin").on("click",function(){return h("put","/pin","pin",r),!1}),t.get("topic/unpin").on("click",function(){return h("del","/pin","unpin",r),!1}),t.get("topic/mark-unread-for-all").on("click",function(){const o=n.getSelectedTids();return o.length?(socket.emit("topics.markAsUnreadForAll",o,function(d){if(d)return A.error(d);A.success("[[topic:markAsUnreadForAll.success]]"),o.forEach(function(u){$('[component="category/topic"][data-tid="'+u+'"]').addClass("unread")}),r()}),!1):A.error("[[error:no-topics-selected]]")}),t.get("topic/move").on("click",function(){return i.e(7378).then(function(){var o=[i(57378)];(function(d){const u=n.getSelectedTids();if(!u.length)return A.error("[[error:no-topics-selected]]");d.init(u,null,r)}).apply(null,o)}).catch(i.oe),!1}),t.get("topic/move-all").on("click",function(){const o=ajaxify.data.cid;if(!ajaxify.data.template.category)return A.error("[[error:invalid-data]]");i.e(7378).then(function(){var d=[i(57378)];(function(u){u.init(null,o,function(I){if(I)return A.error(I);ajaxify.refresh()})}).apply(null,d)}).catch(i.oe)}),t.get("topic/merge").on("click",function(){const o=n.getSelectedTids();i.e(28).then(function(){var d=[i(90028)];(function(u){u.init(function(){o.length&&o.forEach(function(I){u.addTopic(I)})})}).apply(null,d)}).catch(i.oe)}),T.removeListeners(),socket.on("event:topic_deleted",L),socket.on("event:topic_restored",L),socket.on("event:topic_purged",W),socket.on("event:topic_locked",w),socket.on("event:topic_unlocked",w),socket.on("event:topic_pinned",M),socket.on("event:topic_unpinned",M),socket.on("event:topic_moved",B)};function h(o,d,u,I){I||(I=function(){});const P=n.getSelectedTids(),S={},j=function(U){U&&Promise.all(P.map(F=>y[o](`/topics/${F}${d}`,S))).then(I).catch(A.error)};if(!P.length)return A.error("[[error:no-topics-selected]]");switch(u){case"delete":case"restore":case"purge":v.confirm(`[[topic:thread_tools.${u}_confirm]]`,j);break;case"pin":f.requestPinExpiry(S,j.bind(null,!0));break;default:j(!0);break}}T.removeListeners=function(){socket.removeListener("event:topic_deleted",L),socket.removeListener("event:topic_restored",L),socket.removeListener("event:topic_purged",W),socket.removeListener("event:topic_locked",w),socket.removeListener("event:topic_unlocked",w),socket.removeListener("event:topic_pinned",M),socket.removeListener("event:topic_unpinned",M),socket.removeListener("event:topic_moved",B)};function c(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function r(){c(),n.unselectAll()}function a(){c(),g()}function g(){const o=n.getSelectedTids(),d=e(p,o),u=l(p,o),I=e(k,o),P=e(s,o),S=e(x,o),j=l(x,o);t.get("topic/delete").toggleClass("hidden",d),t.get("topic/restore").toggleClass("hidden",S||!d),t.get("topic/purge").toggleClass("hidden",!u),t.get("topic/lock").toggleClass("hidden",P),t.get("topic/unlock").toggleClass("hidden",!P),t.get("topic/pin").toggleClass("hidden",j||I),t.get("topic/unpin").toggleClass("hidden",j||!I),t.get("topic/merge").toggleClass("hidden",S)}function e(o,d){for(let u=0;u<d.length;u+=1)if(o(d[u]))return!0;return!1}function l(o,d){for(let u=0;u<d.length;u+=1)if(!o(d[u]))return!1;return!0}function p(o){return E(o).hasClass("deleted")}function s(o){return E(o).hasClass("locked")}function k(o){return E(o).hasClass("pinned")}function x(o){return E(o).hasClass("scheduled")}function E(o){return t.get("category/topic","tid",o)}function L(o){const d=E(o.tid);d.toggleClass("deleted",o.isDeleted),d.find('[component="topic/locked"]').toggleClass("hide",!o.isDeleted)}function M(o){const d=E(o.tid);d.toggleClass("pinned",o.isPinned),d.find('[component="topic/pinned"]').toggleClass("hide",!o.isPinned),ajaxify.refresh()}function w(o){const d=E(o.tid);d.toggleClass("locked",o.isLocked),d.find('[component="topic/locked"]').toggleClass("hide",!o.isLocked)}function B(o){E(o.tid).remove()}function W(o){E(o.tid).remove()}function K(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const o=ajaxify.data.topics.filter(d=>d.pinned).length;!app.user.isAdmin&&!app.user.isMod||o<2||app.loadJQueryUI(function(){const d=$('[component="category"]').filter(function(I,P){return!$(P).parents("[widget-area],[data-widget-area]").length});let u=0;d.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){u=parseInt(d.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(I,P){socket.emit("topics.orderPinnedTopics",{tid:P.item.attr("data-tid"),order:u+P.item.index()},function(S){if(S)return A.error(S);d.find('[component="category/topic"].pinned').each((j,U)=>{$(U).attr("data-index",u+j)})})}})})}return T}.apply(R,C),m!==void 0&&(D.exports=m)},60392:(D,R,i)=>{var C,m;C=[i(7237),i(32230),i(66044),i(60447),i(74344),i(85233),i(31369),i(7927)],m=function(n,f,t,y,v,A,T,h){const c={};c.init=function(e,l){r(l),l.on("click",'[component="topic/delete"]',function(){return a("del","/state","delete"),!1}),l.on("click",'[component="topic/restore"]',function(){return a("put","/state","restore"),!1}),l.on("click",'[component="topic/purge"]',function(){return a("del","","purge"),!1}),l.on("click",'[component="topic/lock"]',function(){return a("put","/lock","lock"),!1}),l.on("click",'[component="topic/unlock"]',function(){return a("del","/lock","unlock"),!1}),l.on("click",'[component="topic/pin"]',function(){return a("put","/pin","pin"),!1}),l.on("click",'[component="topic/unpin"]',function(){return a("del","/pin","unpin"),!1}),l.on("click",'[component="topic/event/delete"]',function(){const s=$(this).attr("data-topic-event-id"),k=$(this).parents('[component="topic/event"]');T.confirm("[[topic:delete-event-confirm]]",x=>{x&&v.del(`/topics/${e}/events/${s}`,{}).then(function(){k.remove()}).catch(h.error)})}),l.on("click",'[component="topic/mark-unread"]',function(){return socket.emit("topics.markUnread",e,function(s){if(s)return h.error(s);app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,function(){t.onBackClicked(!0)}):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,t.onBackClicked),h.success("[[topic:mark_unread.success]]")}),!1}),l.on("click",'[component="topic/mark-unread-for-all"]',function(){const s=$(this);return socket.emit("topics.markAsUnreadForAll",[e],function(k){if(k)return h.error(k);h.success("[[topic:markAsUnreadForAll.success]]"),s.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")}),!1}),l.on("click",'[component="topic/move"]',function(){return i.e(7378).then(function(){var s=[i(57378)];(function(k){k.init([e],ajaxify.data.cid)}).apply(null,s)}).catch(i.oe),!1}),l.on("click",'[component="topic/delete/posts"]',function(){i.e(5253).then(function(){var s=[i(55253)];(function(k){k.init()}).apply(null,s)}).catch(i.oe)}),l.on("click",'[component="topic/fork"]',function(){i.e(5636).then(function(){var s=[i(25636)];(function(k){k.init()}).apply(null,s)}).catch(i.oe)}),l.on("click",'[component="topic/move-posts"]',function(){i.e(3094).then(function(){var s=[i(53094)];(function(k){k.init()}).apply(null,s)}).catch(i.oe)}),l.on("click",'[component="topic/following"]',function(){p("follow")}),l.on("click",'[component="topic/not-following"]',function(){p("follow",0)}),l.on("click",'[component="topic/ignoring"]',function(){p("ignore")});function p(s,k=1){return v[k?"put":"del"](`/topics/${e}/${s}`,{},()=>{let E="";s==="follow"?E=k?"[[topic:following_topic.message]]":"[[topic:not_following_topic.message]]":s==="ignore"&&(E=k?"[[topic:ignoring_topic.message]]":"[[topic:not_following_topic.message]]"),k||(s="unfollow"),g(s),h.alert({alert_id:"follow_thread",message:E,type:"success",timeout:5e3}),A.fire("action:topics.changeWatching",{tid:e,type:s})},()=>{h.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})}),!1}};function r(e){e.on("show.bs.dropdown",".thread-tools",function(){const p=$(this).find(".dropdown-menu");p.html()||(p.toggleClass("hidden",!0),socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},function(s,k){if(s)return h.error(s);app.parseAndTranslate("partials/topic/topic-menu-list",k,function(x){p.html(x),p.toggleClass("hidden",!1),A.fire("action:topic.tools.load",{element:p})})}))})}function a(e,l,p,s){s||(s=function(){});const k=ajaxify.data.tid,x={},E=function(L){L&&v[e](`/topics/${k}${l}`,x).then(s).catch(h.error)};switch(p){case"delete":case"restore":case"purge":T.confirm(`[[topic:thread_tools.${p}_confirm]]`,E);break;case"pin":c.requestPinExpiry(x,E.bind(null,!0));break;default:E(!0);break}}c.requestPinExpiry=function(e,l){app.parseAndTranslate("modals/set-pin-expiry",{},function(p){const s=T.dialog({title:"[[topic:thread_tools.pin]]",message:p,onEscape:!0,size:"small",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){let x=s.get(0).querySelector("#expiry").value;if(x==="")return l();x=new Date(x),x&&x.getTime()>Date.now()?(e.expiry=x.getTime(),l()):h.error("[[error:invalid-date]]")}}}})})},c.setLockedState=function(e){const l=n.get("topic");if(parseInt(e.tid,10)!==parseInt(l.attr("data-tid"),10))return;const p=e.isLocked&&!ajaxify.data.privileges.isAdminOrMod;n.get("topic/lock").toggleClass("hidden",e.isLocked).parent().attr("hidden",e.isLocked?"":null),n.get("topic/unlock").toggleClass("hidden",!e.isLocked).parent().attr("hidden",e.isLocked?null:"");const s=!!((e.isLocked||ajaxify.data.deleted)&&!ajaxify.data.privileges.isAdminOrMod);n.get("topic/reply/container").toggleClass("hidden",s),n.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!e.isLocked||ajaxify.data.deleted),l.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",s),l.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",p),l.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",p),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!e.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=e.isLocked,y.addTopicEvents(e.events)},c.setDeleteState=function(e){const l=n.get("topic");if(parseInt(e.tid,10)!==parseInt(l.attr("data-tid"),10))return;n.get("topic/delete").toggleClass("hidden",e.isDelete).parent().attr("hidden",e.isDelete?"":null),n.get("topic/restore").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),n.get("topic/purge").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),n.get("topic/deleted/message").toggleClass("hidden",!e.isDelete),e.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:e.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},function(s){n.get("topic/deleted/message").replaceWith(s),s.find(".timeago").timeago()});const p=e.isDelete&&!ajaxify.data.privileges.isAdminOrMod;n.get("topic/reply/container").toggleClass("hidden",p),n.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||e.isDelete),l.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",p),l.toggleClass("deleted",e.isDelete),ajaxify.data.deleted=e.isDelete?1:0,y.addTopicEvents(e.events)},c.setPinnedState=function(e){const l=n.get("topic");if(parseInt(e.tid,10)!==parseInt(l.attr("data-tid"),10))return;n.get("topic/pin").toggleClass("hidden",e.pinned).parent().attr("hidden",e.pinned?"":null),n.get("topic/unpin").toggleClass("hidden",!e.pinned).parent().attr("hidden",e.pinned?null:"");const p=$('[component="topic/labels"] [component="topic/pinned"]');p.toggleClass("hidden",!e.pinned),e.pinned&&p.translateAttr("title",e.pinExpiry&&e.pinExpiryISO?"[[topic:pinned-with-expiry, "+e.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=e.pinned,y.addTopicEvents(e.events)};function g(e){const l={follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"};f.translate(l[e],function(s){$('[component="topic/watch"] button').attr("title",s).tooltip("fixTitle")});let p=n.get("topic/following/menu");p.toggleClass("hidden",e!=="follow"),n.get("topic/following/check").toggleClass("fa-check",e==="follow"),p=n.get("topic/not-following/menu"),p.toggleClass("hidden",e!=="unfollow"),n.get("topic/not-following/check").toggleClass("fa-check",e==="unfollow"),p=n.get("topic/ignoring/menu"),p.toggleClass("hidden",e!=="ignore"),n.get("topic/ignoring/check").toggleClass("fa-check",e==="ignore")}return c}.apply(R,C),m!==void 0&&(D.exports=m)},66044:(D,R,i)=>{var C,m;C=[i(7237),i(66603),i(42840),i(78989)],m=function(n,f,t,y){const v={};let A;v.init=function(c){A=c,T(),$(window).off("action:popstate",h).on("action:popstate",h)},v.onBackClicked=h;function T(){$('[component="category"]').on("click",'[component="topic/header"]',function(){const c=$(this).parents("[data-index]").attr("data-index"),r=$(window).scrollTop();$('[component="category/topic"]').each(function(a,g){if($(g).offset().top-r>0)return f.setItem("category:bookmark",$(g).attr("data-index")),f.setItem("category:bookmark:clicked",c),f.setItem("category:bookmark:offset",$(g).offset().top-r),!1})})}function h(c){const r=c&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||r){let a=f.getItem("category:bookmark"),g=f.getItem("category:bookmark:clicked");if(f.removeItem("category:bookmark"),f.removeItem("category:bookmark:clicked"),!utils.isNumber(a))return;if(a=Math.max(0,parseInt(a,10)||0),g=Math.max(0,parseInt(g,10)||0),config.usePagination){const e=Math.ceil((parseInt(a,10)+1)/config.topicsPerPage);parseInt(e,10)!==ajaxify.data.pagination.currentPage?y.loadPage(e,function(){v.scrollToTopic(a,g)}):v.scrollToTopic(a,g)}else{if(a===0){v.scrollToTopic(a,g);return}$('[component="category"]').empty(),A(Math.max(0,a-1)+1,function(){v.scrollToTopic(a,g)})}}}return v.highlightTopic=function(c){const r=n.get("category/topic","index",c);r.length&&!r.hasClass("highlight")&&(r.addClass("highlight"),setTimeout(function(){r.removeClass("highlight")},5e3))},v.scrollToTopic=function(c,r){if(!utils.isNumber(c))return;const a=n.get("category/topic","index",c);if(a.length){const g=f.getItem("category:bookmark:offset");f.removeItem("category:bookmark:offset"),$(window).scrollTop(a.offset().top-g),v.highlightTopic(r),t.update()}},v}.apply(R,C),m!==void 0&&(D.exports=m)},66603:(D,R,i)=>{var C;C=function(){function m(){this._store={},this._keys=[]}m.prototype.isMock=!0,m.prototype.setItem=function(t,y){t=String(t),this._keys.indexOf(t)===-1&&this._keys.push(t),this._store[t]=y},m.prototype.getItem=function(t){return t=String(t),this._keys.indexOf(t)===-1?null:this._store[t]},m.prototype.removeItem=function(t){t=String(t),this._keys=this._keys.filter(function(y){return y!==t}),this._store[t]=null},m.prototype.clear=function(){this._keys=[],this._store={}},m.prototype.key=function(t){return t=parseInt(t,10)||0,this._keys[t]},Object.defineProperty&&Object.defineProperty(m.prototype,"length",{get:function(){return this._keys.length}});let n;const f=Date.now().toString();try{if(n=window.localStorage,n.setItem(f,f),n.getItem(f)!==f)throw Error("localStorage behaved unexpectedly");return n.removeItem(f),n}catch(t){console.warn(t),console.warn("localStorage failed, falling back on sessionStorage");try{if(n=window.sessionStorage,n.setItem(f,f),n.getItem(f)!==f)throw Error("sessionStorage behaved unexpectedly");return n.removeItem(f),n}catch(y){return console.warn(y),console.warn("sessionStorage failed, falling back on memory storage"),new m}}}.call(R,i,R,D),C!==void 0&&(D.exports=C)},69941:(D,R,i)=>{var C,m;C=[i(7237)],m=function(n){const f={};let t,y;f.init=function(c){y=$('[component="category"]'),y.on("selectstart",'[component="topic/select"]',function(r){r.preventDefault()}),y.on("click",'[component="topic/select"]',function(r){const a=$(this);if(r.shiftKey)return A($(this).parents('[component="category/topic"]').attr("data-tid")),t=a,!1;const g=a.parents("[data-tid]").hasClass("selected");v(a,!g),t=a,typeof c=="function"&&c()})};function v(c,r){c.toggleClass("fa-check-square-o",r),c.toggleClass("fa-square-o",!r),c.parents('[component="category/topic"]').toggleClass("selected",r)}f.getSelectedTids=function(){const c=[];return y&&y.find('[component="category/topic"].selected').each(function(){c.push($(this).attr("data-tid"))}),c},f.unselectAll=function(){y&&(y.find('[component="category/topic"].selected').removeClass("selected"),y.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0))};function A(c){t||(t=$('[component="category/topic"]').first().find('[component="topic/select"]'));const r=n.get("category/topic","tid",c).hasClass("selected"),a=h(c),g=h(t.parents('[component="category/topic"]').attr("data-tid"));T(a,g,!r)}function T(c,r,a){if(c>r){const g=c;c=r,r=g}for(let g=c;g<=r;g+=1){const e=$('[component="category/topic"]').eq(g);v(e.find('[component="topic/select"]'),a)}}function h(c){return n.get("category/topic","tid",c).index('[component="category/topic"]')}return f}.apply(R,C),m!==void 0&&(D.exports=m)}}]);
