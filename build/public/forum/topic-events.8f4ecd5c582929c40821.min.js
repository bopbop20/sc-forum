"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4781,1375,8306],{91748:(w,C,i)=>{var x,g;x=[i(54939),i(60392),i(60447),i(47720),i(7237),i(32230),i(59006),i(85233)],g=function(o,p,l,I,u,j,D,h){const f={},m={"event:user_status_change":r,"event:voted":y,"event:bookmarked":e,"event:topic_deleted":p.setDeleteState,"event:topic_restored":p.setDeleteState,"event:topic_purged":s,"event:topic_locked":p.setLockedState,"event:topic_unlocked":p.setLockedState,"event:topic_pinned":p.setPinnedState,"event:topic_unpinned":p.setPinnedState,"event:topic_moved":c,"event:post_edited":n,"event:post_purged":d,"event:post_deleted":k,"event:post_restored":k,"posts.bookmark":E,"posts.unbookmark":E,"posts.upvote":T,"posts.downvote":T,"posts.unvote":T,"event:new_notification":b,"event:new_post":l.onNewPost};f.init=function(){f.removeListeners();for(const t in m)m.hasOwnProperty(t)&&socket.on(t,m[t])},f.removeListeners=function(){for(const t in m)m.hasOwnProperty(t)&&socket.removeListener(t,m[t])};function r(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function y(t){const a=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(A,R){return parseInt($(R).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),v=$('.reputation[data-uid="'+t.post.uid+'"]');a.html(t.post.votes).attr("data-votes",t.post.votes),v.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function e(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(a,v){return parseInt($(v).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function s(t){ajaxify.data.category&&ajaxify.data.category.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function c(t){t&&t.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("topic/"+t.slug,null,!0)}function n(t){if(!t||!t.post||parseInt(t.post.tid,10)!==parseInt(ajaxify.data.tid,10))return;const a=u.get("post/content",t.post.pid).filter(function(P,S){return parseInt($(S).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),v=$('[data-pid="'+t.post.pid+'"] [component="post/editor"]').filter(function(P,S){return parseInt($(S).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),A=u.get("topic/title"),R=u.get("navbar/title").find("span"),M=u.get("breadcrumb/current");if(t.topic.rescheduled)return ajaxify.go("topic/"+t.topic.slug,null,!0);if(A.length&&t.topic.title&&t.topic.renamed){ajaxify.data.title=t.topic.title;const P="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:P},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+P),A.fadeOut(250,function(){A.html(t.topic.title).fadeIn(250)}),M.fadeOut(250,function(){M.html(t.topic.title).fadeIn(250)}),R.fadeOut(250,function(){R.html(t.topic.title).fadeIn(250)})}t.post.changed?a.fadeOut(250,function(){a.html(j.unescape(t.post.content)),a.find("img:not(.not-responsive)").addClass("img-responsive"),I.wrapImagesInLinks(a.parent()),l.addBlockquoteEllipses(a.parent()),a.fadeIn(250);const P={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};app.parseAndTranslate("partials/topic/post-editor",P,function(S){v.replaceWith(S),$('[data-pid="'+t.post.pid+'"] [component="post/editor"] .timeago').timeago(),h.fire("action:posts.edited",t)})}):h.fire("action:posts.edited",t),t.topic.tags&&t.topic.tagsupdated&&D.render("partials/topic/tags",{tags:t.topic.tags}).then(function(P){const S=$(".tags");S.fadeOut(250,function(){S.html(P).fadeIn(250)})}),o.removeMenu(u.get("post","pid",t.post.pid))}function d(t){!t||parseInt(t.tid,10)!==parseInt(ajaxify.data.tid,10)||(u.get("post","pid",t.pid).fadeOut(500,function(){$(this).remove(),l.showBottomPostBar()}),ajaxify.data.postcount-=1,o.updatePostCount(ajaxify.data.postcount),i.e(1352).then(function(){var a=[i(21352)];(function(v){v.onPostPurged(t)}).apply(null,a)}).catch(i.oe))}function k(t){const a=u.get("post","pid",t.pid);if(!a.length)return;a.toggleClass("deleted");const v=a.hasClass("deleted");o.toggle(t.pid,v),!ajaxify.data.privileges.isAdminOrMod&&parseInt(t.uid,10)!==parseInt(app.user.uid,10)&&(a.find('[component="post/tools"]').toggleClass("hidden",v),v?a.find('[component="post/content"]').translateHtml("[[topic:post_is_deleted]]"):a.find('[component="post/content"]').html(j.unescape(t.content)))}function E(t){const a=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(v,A){return parseInt($(A).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});a.length&&(a.attr("data-bookmarked",t.isBookmarked),a.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),a.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function T(t){const a=$('[data-pid="'+t.post.pid+'"]');a.find('[component="post/upvote"]').filter(function(v,A){return parseInt($(A).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("upvoted",t.upvote),a.find('[component="post/downvote"]').filter(function(v,A){return parseInt($(A).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("downvoted",t.downvote)}function b(t){const a=ajaxify.data.tid;t&&t.tid&&parseInt(t.tid,10)===parseInt(a,10)&&socket.emit("topics.markTopicNotificationsRead",[a])}return f}.apply(C,x),g!==void 0&&(w.exports=g)},60392:(w,C,i)=>{var x,g;x=[i(7237),i(32230),i(66044),i(60447),i(74344),i(85233),i(31369),i(7927)],g=function(o,p,l,I,u,j,D,h){const f={};f.init=function(e,s){m(s),s.on("click",'[component="topic/delete"]',function(){return r("del","/state","delete"),!1}),s.on("click",'[component="topic/restore"]',function(){return r("put","/state","restore"),!1}),s.on("click",'[component="topic/purge"]',function(){return r("del","","purge"),!1}),s.on("click",'[component="topic/lock"]',function(){return r("put","/lock","lock"),!1}),s.on("click",'[component="topic/unlock"]',function(){return r("del","/lock","unlock"),!1}),s.on("click",'[component="topic/pin"]',function(){return r("put","/pin","pin"),!1}),s.on("click",'[component="topic/unpin"]',function(){return r("del","/pin","unpin"),!1}),s.on("click",'[component="topic/event/delete"]',function(){const n=$(this).attr("data-topic-event-id"),d=$(this).parents('[component="topic/event"]');D.confirm("[[topic:delete-event-confirm]]",k=>{k&&u.del(`/topics/${e}/events/${n}`,{}).then(function(){d.remove()}).catch(h.error)})}),s.on("click",'[component="topic/mark-unread"]',function(){return socket.emit("topics.markUnread",e,function(n){if(n)return h.error(n);app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,function(){l.onBackClicked(!0)}):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,l.onBackClicked),h.success("[[topic:mark_unread.success]]")}),!1}),s.on("click",'[component="topic/mark-unread-for-all"]',function(){const n=$(this);return socket.emit("topics.markAsUnreadForAll",[e],function(d){if(d)return h.error(d);h.success("[[topic:markAsUnreadForAll.success]]"),n.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")}),!1}),s.on("click",'[component="topic/move"]',function(){return i.e(7378).then(function(){var n=[i(57378)];(function(d){d.init([e],ajaxify.data.cid)}).apply(null,n)}).catch(i.oe),!1}),s.on("click",'[component="topic/delete/posts"]',function(){i.e(5253).then(function(){var n=[i(55253)];(function(d){d.init()}).apply(null,n)}).catch(i.oe)}),s.on("click",'[component="topic/fork"]',function(){i.e(5636).then(function(){var n=[i(25636)];(function(d){d.init()}).apply(null,n)}).catch(i.oe)}),s.on("click",'[component="topic/move-posts"]',function(){i.e(3094).then(function(){var n=[i(53094)];(function(d){d.init()}).apply(null,n)}).catch(i.oe)}),s.on("click",'[component="topic/following"]',function(){c("follow")}),s.on("click",'[component="topic/not-following"]',function(){c("follow",0)}),s.on("click",'[component="topic/ignoring"]',function(){c("ignore")});function c(n,d=1){return u[d?"put":"del"](`/topics/${e}/${n}`,{},()=>{let E="";n==="follow"?E=d?"[[topic:following_topic.message]]":"[[topic:not_following_topic.message]]":n==="ignore"&&(E=d?"[[topic:ignoring_topic.message]]":"[[topic:not_following_topic.message]]"),d||(n="unfollow"),y(n),h.alert({alert_id:"follow_thread",message:E,type:"success",timeout:5e3}),j.fire("action:topics.changeWatching",{tid:e,type:n})},()=>{h.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})}),!1}};function m(e){e.on("show.bs.dropdown",".thread-tools",function(){const c=$(this).find(".dropdown-menu");c.html()||(c.toggleClass("hidden",!0),socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},function(n,d){if(n)return h.error(n);app.parseAndTranslate("partials/topic/topic-menu-list",d,function(k){c.html(k),c.toggleClass("hidden",!1),j.fire("action:topic.tools.load",{element:c})})}))})}function r(e,s,c,n){n||(n=function(){});const d=ajaxify.data.tid,k={},E=function(T){T&&u[e](`/topics/${d}${s}`,k).then(n).catch(h.error)};switch(c){case"delete":case"restore":case"purge":D.confirm(`[[topic:thread_tools.${c}_confirm]]`,E);break;case"pin":f.requestPinExpiry(k,E.bind(null,!0));break;default:E(!0);break}}f.requestPinExpiry=function(e,s){app.parseAndTranslate("modals/set-pin-expiry",{},function(c){const n=D.dialog({title:"[[topic:thread_tools.pin]]",message:c,onEscape:!0,size:"small",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){let k=n.get(0).querySelector("#expiry").value;if(k==="")return s();k=new Date(k),k&&k.getTime()>Date.now()?(e.expiry=k.getTime(),s()):h.error("[[error:invalid-date]]")}}}})})},f.setLockedState=function(e){const s=o.get("topic");if(parseInt(e.tid,10)!==parseInt(s.attr("data-tid"),10))return;const c=e.isLocked&&!ajaxify.data.privileges.isAdminOrMod;o.get("topic/lock").toggleClass("hidden",e.isLocked).parent().attr("hidden",e.isLocked?"":null),o.get("topic/unlock").toggleClass("hidden",!e.isLocked).parent().attr("hidden",e.isLocked?null:"");const n=!!((e.isLocked||ajaxify.data.deleted)&&!ajaxify.data.privileges.isAdminOrMod);o.get("topic/reply/container").toggleClass("hidden",n),o.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!e.isLocked||ajaxify.data.deleted),s.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",n),s.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",c),s.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",c),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!e.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=e.isLocked,I.addTopicEvents(e.events)},f.setDeleteState=function(e){const s=o.get("topic");if(parseInt(e.tid,10)!==parseInt(s.attr("data-tid"),10))return;o.get("topic/delete").toggleClass("hidden",e.isDelete).parent().attr("hidden",e.isDelete?"":null),o.get("topic/restore").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),o.get("topic/purge").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),o.get("topic/deleted/message").toggleClass("hidden",!e.isDelete),e.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:e.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},function(n){o.get("topic/deleted/message").replaceWith(n),n.find(".timeago").timeago()});const c=e.isDelete&&!ajaxify.data.privileges.isAdminOrMod;o.get("topic/reply/container").toggleClass("hidden",c),o.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||e.isDelete),s.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",c),s.toggleClass("deleted",e.isDelete),ajaxify.data.deleted=e.isDelete?1:0,I.addTopicEvents(e.events)},f.setPinnedState=function(e){const s=o.get("topic");if(parseInt(e.tid,10)!==parseInt(s.attr("data-tid"),10))return;o.get("topic/pin").toggleClass("hidden",e.pinned).parent().attr("hidden",e.pinned?"":null),o.get("topic/unpin").toggleClass("hidden",!e.pinned).parent().attr("hidden",e.pinned?null:"");const c=$('[component="topic/labels"] [component="topic/pinned"]');c.toggleClass("hidden",!e.pinned),e.pinned&&c.translateAttr("title",e.pinExpiry&&e.pinExpiryISO?"[[topic:pinned-with-expiry, "+e.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=e.pinned,I.addTopicEvents(e.events)};function y(e){const s={follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"};p.translate(s[e],function(n){$('[component="topic/watch"] button').attr("title",n).tooltip("fixTitle")});let c=o.get("topic/following/menu");c.toggleClass("hidden",e!=="follow"),o.get("topic/following/check").toggleClass("fa-check",e==="follow"),c=o.get("topic/not-following/menu"),c.toggleClass("hidden",e!=="unfollow"),o.get("topic/not-following/check").toggleClass("fa-check",e==="unfollow"),c=o.get("topic/ignoring/menu"),c.toggleClass("hidden",e!=="ignore"),o.get("topic/ignoring/check").toggleClass("fa-check",e==="ignore")}return f}.apply(C,x),g!==void 0&&(w.exports=g)},66044:(w,C,i)=>{var x,g;x=[i(7237),i(66603),i(42840),i(78989)],g=function(o,p,l,I){const u={};let j;u.init=function(f){j=f,D(),$(window).off("action:popstate",h).on("action:popstate",h)},u.onBackClicked=h;function D(){$('[component="category"]').on("click",'[component="topic/header"]',function(){const f=$(this).parents("[data-index]").attr("data-index"),m=$(window).scrollTop();$('[component="category/topic"]').each(function(r,y){if($(y).offset().top-m>0)return p.setItem("category:bookmark",$(y).attr("data-index")),p.setItem("category:bookmark:clicked",f),p.setItem("category:bookmark:offset",$(y).offset().top-m),!1})})}function h(f){const m=f&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||m){let r=p.getItem("category:bookmark"),y=p.getItem("category:bookmark:clicked");if(p.removeItem("category:bookmark"),p.removeItem("category:bookmark:clicked"),!utils.isNumber(r))return;if(r=Math.max(0,parseInt(r,10)||0),y=Math.max(0,parseInt(y,10)||0),config.usePagination){const e=Math.ceil((parseInt(r,10)+1)/config.topicsPerPage);parseInt(e,10)!==ajaxify.data.pagination.currentPage?I.loadPage(e,function(){u.scrollToTopic(r,y)}):u.scrollToTopic(r,y)}else{if(r===0){u.scrollToTopic(r,y);return}$('[component="category"]').empty(),j(Math.max(0,r-1)+1,function(){u.scrollToTopic(r,y)})}}}return u.highlightTopic=function(f){const m=o.get("category/topic","index",f);m.length&&!m.hasClass("highlight")&&(m.addClass("highlight"),setTimeout(function(){m.removeClass("highlight")},5e3))},u.scrollToTopic=function(f,m){if(!utils.isNumber(f))return;const r=o.get("category/topic","index",f);if(r.length){const y=p.getItem("category:bookmark:offset");p.removeItem("category:bookmark:offset"),$(window).scrollTop(r.offset().top-y),u.highlightTopic(m),l.update()}},u}.apply(C,x),g!==void 0&&(w.exports=g)},66603:(w,C,i)=>{var x;x=function(){function g(){this._store={},this._keys=[]}g.prototype.isMock=!0,g.prototype.setItem=function(l,I){l=String(l),this._keys.indexOf(l)===-1&&this._keys.push(l),this._store[l]=I},g.prototype.getItem=function(l){return l=String(l),this._keys.indexOf(l)===-1?null:this._store[l]},g.prototype.removeItem=function(l){l=String(l),this._keys=this._keys.filter(function(I){return I!==l}),this._store[l]=null},g.prototype.clear=function(){this._keys=[],this._store={}},g.prototype.key=function(l){return l=parseInt(l,10)||0,this._keys[l]},Object.defineProperty&&Object.defineProperty(g.prototype,"length",{get:function(){return this._keys.length}});let o;const p=Date.now().toString();try{if(o=window.localStorage,o.setItem(p,p),o.getItem(p)!==p)throw Error("localStorage behaved unexpectedly");return o.removeItem(p),o}catch(l){console.warn(l),console.warn("localStorage failed, falling back on sessionStorage");try{if(o=window.sessionStorage,o.setItem(p,p),o.getItem(p)!==p)throw Error("sessionStorage behaved unexpectedly");return o.removeItem(p),o}catch(I){return console.warn(I),console.warn("sessionStorage failed, falling back on memory storage"),new g}}}.call(C,i,C,w),x!==void 0&&(w.exports=x)}}]);
