"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8798,7214,9617,6503,6027,232,498,3014,71,3034,831,7927,3216,4337,8596,3050,1837],{81018:(v,y,s)=>{var A,h;A=[s(7927)],h=function(d){const p={};p.init=function(){Promise.all([s.e(2441),s.e(1006),s.e(4271),s.e(8596)]).then(function(){var l=[s(30524)];(function(f){$('[component="chat/recent"]').on("click",'[component="chat/recent/room"]',function(){f.switchChat($(this).attr("data-roomid"))}),$('[component="chat/recent"]').on("scroll",function(){const m=$(this),i=(m[0].scrollHeight-m.height())*.9;m.scrollTop()>i&&E()})}).apply(null,l)}).catch(s.oe)};function E(){const l=$('[component="chat/recent"]');l.attr("loading")||(l.attr("loading",1),socket.emit("modules.chats.getRecentChats",{uid:ajaxify.data.uid,after:l.attr("data-nextstart")},function(f,m){if(f)return d.error(f);m&&m.rooms.length?a(m,function(){l.removeAttr("loading"),l.attr("data-nextstart",m.nextStart)}):l.removeAttr("loading")}))}function a(l,f){if(!l.rooms.length)return f();app.parseAndTranslate("chats","rooms",l,function(m){$('[component="chat/recent"]').append(m),m.find(".timeago").timeago(),f()})}return p}.apply(y,A),h!==void 0&&(v.exports=h)},18596:(v,y,s)=>{var A,h;A=[s(7237),s(74344),s(7927)],h=function(d,p,E){const a={};a.init=function(){d.get("chat/search").on("keyup",utils.debounce(l,250))};function l(){const n=d.get("chat/search").val();if(!n)return $('[component="chat/search/list"]').empty();p.get("/api/users",{query:n,searchBy:"username",paginate:!1}).then(f).catch(E.error)}function f(n){const o=$('[component="chat/search/list"]');if(o.empty(),n.users=n.users.filter(function(t){return parseInt(t.uid,10)!==parseInt(app.user.uid,10)}),!n.users.length)return o.translateHtml("<li><div><span>[[users:no-users-found]]</span></div></li>");n.users.forEach(function(t){const e=m(o,t);i(e,t)}),o.parent().toggleClass("open",!0)}function m(n,o){function t(){return(o.picture?'<img src="'+o.picture+'" title="'+o.username+'" />':'<div class="user-icon" style="background-color: '+o["icon:bgColor"]+'">'+o["icon:text"]+"</div>")+'<i class="fa fa-circle status '+o.status+'"></i> '+o.username}const e=$('<li component="chat/search/user"></li>').attr("data-uid",o.uid).appendTo(n);return e.append(t()),e}function i(n,o){n.on("click",function(){socket.emit("modules.chats.hasPrivateChat",o.uid,function(t,e){if(t)return E.error(t);e?Promise.all([s.e(2441),s.e(1006),s.e(4271),s.e(3050)]).then(function(){var u=[s(30524)];(function(r){r.switchChat(e)}).apply(null,u)}).catch(s.oe):s.e(4337).then(function(){var u=[s(93216)];(function(r){r.newChat(o.uid)}).apply(null,u)}).catch(s.oe)})})}return a}.apply(y,A),h!==void 0&&(v.exports=h)},7927:(v,y,s)=>{var A,h;A=[s(32230),s(7237),s(85233)],h=function(d,p,E){const a={};a.alert=function(n){n.alert_id="alert_button_"+(n.alert_id?n.alert_id:new Date().getTime()),n.title=n.title&&n.title.trim()||"",n.message=n.message?n.message.trim():"",n.type=n.type||"info";const o=$("#"+n.alert_id);o.length?f(o,n):l(n)},a.success=function(n,o){a.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:n,type:"success",timeout:o||5e3})},a.error=function(n,o){if(n=n&&n.message||n,n==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}a.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:n,type:"danger",timeout:o||1e4})},a.remove=function(n){$("#alert_button_"+n).remove()};function l(n){app.parseAndTranslate("alert",n,function(o){let t=$("#"+n.alert_id);if(t.length)return f(t,n);t=o,t.fadeIn(200),p.get("toaster/tray").prepend(t),typeof n.closefn=="function"&&t.find("button").on("click",function(){return n.closefn(),m(t),!1}),n.timeout&&i(t,n),typeof n.clickfn=="function"&&t.addClass("pointer").on("click",function(e){$(e.target).is(".close")||n.clickfn(t,n),m(t)}),E.fire("action:alert.new",{alert:t,params:n})})}function f(n,o){n.find("strong").translateHtml(o.title),n.find("p").translateHtml(o.message),n.attr("class","alert alert-dismissable alert-"+o.type+" clearfix"),clearTimeout(parseInt(n.attr("timeoutId"),10)),o.timeout&&i(n,o),E.fire("action:alert.update",{alert:n,params:o}),n.off("click").removeClass("pointer"),typeof o.clickfn=="function"&&n.addClass("pointer").on("click",function(t){$(t.target).is(".close")||o.clickfn(),m(n)})}function m(n){n.fadeOut(500,function(){$(this).remove()})}function i(n,o){const t=o.timeout,e=setTimeout(function(){m(n),typeof o.timeoutfn=="function"&&o.timeoutfn(n,o)},t);n.attr("timeoutId",e),n.css("transition-property","none"),n.removeClass("animate"),setTimeout(function(){n.css("transition-property",""),n.css("transition","width "+(t+450)+"ms linear, background-color "+(t+450)+"ms ease-in"),n.addClass("animate"),E.fire("action:alert.animate",{alert:n,params:o})},50),n.on("mouseenter",function(){$(this).css("transition-duration",0)})}return a}.apply(y,A),h!==void 0&&(v.exports=h)},74344:(v,y,s)=>{var A,h;A=[s(85233)],h=(d=>{const p={},E=config.relative_path+"/api/v3";function a(l,f){l.url=l.url.startsWith("/api")?config.relative_path+l.url:E+l.url;async function m(i){({options:l}=await d.fire("filter:api.options",{options:l})),$.ajax(l).done(n=>{i(null,n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n||{})}).fail(n=>{let o;n.responseJSON&&(o=n.responseJSON.status&&n.responseJSON.status.message?n.responseJSON.status.message:n.responseJSON.error),i(new Error(o||n.statusText))})}if(typeof f=="function"){m(f);return}return new Promise((i,n)=>{m(function(o,t){o?n(o):i(t)})})}return p.get=(l,f,m)=>a({url:l+(f&&Object.keys(f).length?"?"+$.param(f):"")},m),p.head=(l,f,m)=>a({url:l+(f&&Object.keys(f).length?"?"+$.param(f):""),method:"head"},m),p.post=(l,f,m)=>a({url:l,method:"post",data:JSON.stringify(f||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},m),p.patch=(l,f,m)=>a({url:l,method:"patch",data:JSON.stringify(f||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},m),p.put=(l,f,m)=>a({url:l,method:"put",data:JSON.stringify(f||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},m),p.del=(l,f,m)=>a({url:l,method:"delete",data:JSON.stringify(f),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},m),p.delete=p.del,p}).apply(y,A),h!==void 0&&(v.exports=h)},93216:(v,y,s)=>{var A,h;A=[s(7237),s(27145),s(32230),s(85233),s(31369),s(7927),s(74344)],h=function(d,p,E,a,l,f,m){const i={};let n=!1;i.openChat=function(t,e){if(!app.user.uid)return f.error("[[error:not-logged-in]]");function u(r){i.load(r.attr("data-uuid")),i.center(r),i.focusInput(r)}i.modalExists(t)?u(i.getModal(t)):m.get(`/chats/${t}`,{uid:e||app.user.uid}).then(r=>{r.users=r.users.filter(function(g){return g&&parseInt(g.uid,10)!==parseInt(app.user.uid,10)}),r.uid=e||app.user.uid,r.isSelf=!0,i.createModal(r,u)}).catch(f.error)},i.newChat=function(t,e){function u(){m.post("/chats",{uids:[t]}).then(({roomId:r})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+r):i.openChat(r),e(null,r)}).catch(f.error)}if(e=e||function(){},!app.user.uid)return f.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return f.error("[[error:cant-chat-with-yourself]]");socket.emit("modules.chats.isDnD",t,function(r,g){if(r)return f.error(r);if(!g)return u();l.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(I){I&&u()})})},i.loadChatsDropdown=function(t){socket.emit("modules.chats.getRecentChats",{uid:app.user.uid,after:0},function(e,u){if(e)return f.error(e);const r=u.rooms.filter(function(g){return g.teaser});E.toggleTimeagoShorthand(function(){for(let g=0;g<r.length;g+=1)r[g].teaser.timeago=$.timeago(new Date(parseInt(r[g].teaser.timestamp,10)));E.toggleTimeagoShorthand(),app.parseAndTranslate("partials/chats/dropdown",{rooms:r},function(g){t.find("*").not(".navigation-link").remove(),t.prepend(g),app.createUserTooltips(t,"right"),t.off("click").on("click","[data-roomid]",function(I){if($(I.target).parents(".user-link").length)return;const c=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+c):i.openChat(c)}),$('[component="chats/mark-all-read"]').off("click").on("click",function(){socket.emit("modules.chats.markAllRead",function(I){if(I)return f.error(I)})})})})})},i.onChatMessageReceived=function(t){const e=t.self===1;t.message.self=t.self,n=t.self===0,i.modalExists(t.roomId)?o(t):ajaxify.data.template.chats||m.get(`/chats/${t.roomId}`,{}).then(u=>{u.users=u.users.filter(function(r){return r&&parseInt(r.uid,10)!==parseInt(app.user.uid,10)}),u.silent=!0,u.uid=app.user.uid,u.isSelf=e,i.createModal(u)}).catch(f.error)};function o(t){const e=i.getModal(t.roomId),u=t.message.fromUser.username,r=t.self===1;s.e(6862).then(function(){var g=[s(46862)];(function(I){e.find('[data-mid="'+t.message.messageId+'"]').length||I.appendChatMessage(e.find(".chat-content"),t.message),e.is(":visible")?(p.updateActive(e.attr("data-uuid")),I.isAtBottom(e.find(".chat-content"))&&I.scrollToBottom(e.find(".chat-content"))):ajaxify.data.template.chats||i.toggleNew(e.attr("data-uuid"),!0,!0),!r&&(!e.is(":visible")||!app.isFocused)&&p.push("chat",e.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||u),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,g)}).catch(s.oe)}return i.onUserStatusChange=function(t){const e=i.getModal(t.uid);app.updateUserStatus(e.find('[component="user/status"]'),t.status)},i.onRoomRename=function(t){const e=$("<div></div>").html(t.newName).text(),u=i.getModal(t.roomId);u.find('[component="chat/room/name"]').text(e),p.update("chat",u.attr("data-uuid"),{title:e}),a.fire("action:chat.renamed",Object.assign(t,{modal:u}))},i.getModal=function(t){return $("#chat-modal-"+t)},i.modalExists=function(t){return $("#chat-modal-"+t).length!==0},i.createModal=function(t,e){e=e||function(){},Promise.all([s.e(2441),s.e(1006),s.e(4271),s.e(9789)]).then(function(){var u=[s(75203),s(30524),s(46862)];(function(r,g,I){app.parseAndTranslate("chat",t,function(c){if(i.modalExists(t.roomId))return e(i.getModal(t.roomId));const x=utils.generateUUID();let R=!1;c.attr("id","chat-modal-"+t.roomId),c.attr("data-roomid",t.roomId),c.attr("intervalId",0),c.attr("data-uuid",x),c.css("position","fixed"),c.appendTo($("body")),c.find(".timeago").timeago(),i.center(c),app.loadJQueryUI(function(){c.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),c.find(".modal-content").on("resize",function(C,B){B.originalSize.height!==B.size.height&&c.find(".modal-body").css("height",i.calculateChatListHeight(c))}),c.draggable({start:function(){p.updateActive(x)},stop:function(){i.focusInput(c)},distance:10,handle:".modal-header"})}),r.apply(c.find('[component="chat/messages"]')),c.find("#chat-close-btn").on("click",function(){i.close(c)});function N(){const C=d.get("chat/input").val();$(window).one("action:ajaxify.end",function(){d.get("chat/input").val(C)}),ajaxify.go("user/"+app.user.userslug+"/chats/"+c.attr("data-roomid")),i.close(c)}c.find(".modal-header").on("dblclick",N),c.find('button[data-action="maximize"]').on("click",N),c.find('button[data-action="minimize"]').on("click",function(){const C=c.attr("data-uuid");i.minimize(C)}),c.on("mouseup",function(){p.updateActive(c.attr("data-uuid")),R&&(R=!1)}),c.on("mousemove",function(C){C.which===1&&(R=!0)}),c.on("mousemove keypress click",function(){n&&(socket.emit("modules.chats.markRead",t.roomId),n=!1)}),g.addActionHandlers(c.find('[component="chat/messages"]'),t.roomId),g.addRenameHandler(c.attr("data-roomid"),c.find('[data-action="rename"]'),t.roomName),g.addLeaveHandler(c.attr("data-roomid"),c.find('[data-action="leave"]')),g.addSendHandlers(c.attr("data-roomid"),c.find(".chat-input"),c.find('[data-action="send"]')),g.addMemberHandler(c.attr("data-roomid"),c.find('[data-action="members"]')),g.createAutoComplete(c.find('[component="chat/input"]')),g.addScrollHandler(c.attr("data-roomid"),t.uid,c.find(".chat-content")),g.addScrollBottomHandler(c.find(".chat-content")),g.addCharactersLeftHandler(c),g.addIPHandler(c),g.addUploadHandler({dragDropAreaEl:c.find(".modal-content"),pasteEl:c,uploadFormEl:c.find('[component="chat/upload"]'),inputEl:c.find('[component="chat/input"]')}),I.addSocketListeners(),p.push("chat",c.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){p.toggleNew(c.attr("data-uuid"),!t.isSelf),a.fire("action:chat.loaded",c),typeof e=="function"&&e(c)})})}).apply(null,u)}).catch(s.oe)},i.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},i.close=function(t){const e=t.attr("data-uuid");clearInterval(t.attr("intervalId")),t.attr("intervalId",0),t.remove(),t.data("modal",null),p.discard("chat",e),t.attr("data-mobile")&&i.disableMobileBehaviour(t),a.fire("action:chat.closed",{uuid:e,modal:t})},i.closeByUUID=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');i.close(e)},i.center=function(t){let e=!1;return t.hasClass("hide")&&(t.removeClass("hide"),e=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),e&&t.addClass("hide"),t},i.load=function(t){s.e(6862).then(function(){var e=[s(46862)];(function(u){const r=$('.chat-modal[data-uuid="'+t+'"]');r.removeClass("hide"),p.updateActive(t),u.scrollToBottom(r.find(".chat-content")),i.focusInput(r),socket.emit("modules.chats.markRead",r.attr("data-roomid"));const g=utils.findBootstrapEnvironment();(g==="xs"||g==="sm")&&i.enableMobileBehaviour(r)}).apply(null,e)}).catch(s.oe)},i.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const e=t.find(".modal-body");e.css("height",i.calculateChatListHeight(t));function u(){e.css("height",i.calculateChatListHeight(t)),s.e(6862).then(function(){var r=[s(46862)];(function(g){g.scrollToBottom(t.find(".chat-content"))}).apply(null,r)}).catch(s.oe)}$(window).on("resize",u),$(window).one("action:ajaxify.start",function(){i.close(t),$(window).off("resize",u)})},i.disableMobileBehaviour=function(){app.toggleNavbar(!0)},i.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},i.minimize=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');e.addClass("hide"),p.minimize("chat",t),clearInterval(e.attr("intervalId")),e.attr("intervalId",0),a.fire("action:chat.minimized",{uuid:t,modal:e})},i.toggleNew=p.toggleNew,i}.apply(y,A),h!==void 0&&(v.exports=h)},7237:(v,y,s)=>{var A;A=function(){const h={};return h.core={"topic/teaser":function(d){return d?$('[component="category/topic"][data-tid="'+d+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(d,p){return $('[component="topic"][data-'+d+'="'+p+'"]')},post:function(d,p){return $('[component="post"][data-'+d+'="'+p+'"]')},"post/content":function(d){return $('[component="post"][data-pid="'+d+'"] [component="post/content"]')},"post/header":function(d){return $('[component="post"][data-pid="'+d+'"] [component="post/header"]')},"post/anchor":function(d){return $('[component="post"][data-index="'+d+'"] [component="post/anchor"]')},"post/vote-count":function(d){return $('[component="post"][data-pid="'+d+'"] [component="post/vote-count"]')},"post/bookmark-count":function(d){return $('[component="post"][data-pid="'+d+'"] [component="post/bookmark-count"]')},"user/postcount":function(d){return $('[component="user/postcount"][data-uid="'+d+'"]')},"user/reputation":function(d){return $('[component="user/reputation"][data-uid="'+d+'"]')},"category/topic":function(d,p){return $('[component="category/topic"][data-'+d+'="'+p+'"]')},"categories/category":function(d,p){return $('[component="categories/category"][data-'+d+'="'+p+'"]')},"chat/message":function(d){return $('[component="chat/message"][data-mid="'+d+'"]')},"chat/message/body":function(d){return $('[component="chat/message"][data-mid="'+d+'"] [component="chat/message/body"]')},"chat/recent/room":function(d){return $('[component="chat/recent/room"][data-roomid="'+d+'"]')}},h.get=function(){const d=Array.prototype.slice.call(arguments,1);return h.core[arguments[0]]&&d.length?h.core[arguments[0]].apply(this,d):$('[component="'+arguments[0]+'"]')},h}.call(y,s,y,v),A!==void 0&&(v.exports=A)},27145:(v,y,s)=>{v=s.nmd(v);var A,h;A=[s(59006),s(32230),s(85233)],h=function(d,p,E){const a={};a.init=function(){const n=this;d.render("modules/taskbar",{}).then(function(o){n.taskbar=$(o),n.tasklist=n.taskbar.find("ul"),$(document.body).append(n.taskbar),n.taskbar.on("click","li",async function(){const t=$(this),e=t.attr("data-module"),u=t.attr("data-uuid"),r=await app.require(e);return t.hasClass("active")?r.minimize(u):(f(),r.load(u),a.toggleNew(u,!1),a.tasklist.removeClass("active"),t.addClass("active")),!1})}),$(window).on("action:app.loggedOut",function(){a.closeAll()})},a.close=async function(n,o){const t=a.tasklist.find('[data-module="'+v+'"][data-uuid="'+o+'"]');let e="close";if(n==="chat"&&(e="closeByUUID"),t.length){const u=await app.require(n);u&&typeof u[e]=="function"&&u[e](o)}},a.closeAll=function(n){let o="[data-uuid]";n&&(o='[data-module="'+n+'"]'+o),a.tasklist.find(o).each(function(t,e){a.close(n||e.getAttribute("data-module"),e.getAttribute("data-uuid"))})},a.discard=function(n,o){a.tasklist.find('[data-module="'+n+'"][data-uuid="'+o+'"]').remove(),l()},a.push=function(n,o,t,e){e=e||function(){};const u=a.tasklist.find('li[data-uuid="'+o+'"]'),r={module:n,uuid:o,options:t,element:u};E.fire("filter:taskbar.push",r),!u.length&&r.module?m(r,e):e(u)},a.get=function(n){return $('[data-module="'+n+'"]').map(function(t,e){return $(e).data()})},a.minimize=function(n,o){a.tasklist.find('[data-module="'+n+'"][data-uuid="'+o+'"]').toggleClass("active",!1)},a.toggleNew=function(n,o,t){a.tasklist.find('[data-uuid="'+n+'"]').toggleClass("new",o),t||E.fire("action:taskbar.toggleNew",n)},a.updateActive=function(n){const o=a.tasklist.find("li");o.removeClass("active"),o.filter('[data-uuid="'+n+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+n+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},a.isActive=function(n){return a.tasklist.find('li[data-uuid="'+n+'"]').hasClass("active")};function l(){a.tasklist.find("li").length>0?a.taskbar.attr("data-active","1"):a.taskbar.removeAttr("data-active")}function f(){a.tasklist.find(".active").removeClass("active")}function m(n,o){p.translate(n.options.title,function(t){const e=$("<div></div>").text(t||"NodeBB Task").html(),u=$("<li></li>").addClass(n.options.className).html('<a href="#"'+(n.options.image?` style="background-image: url('`+n.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(n.options.icon?'<i class="fa '+n.options.icon+'"></i> ':"")+'<span aria-label="'+e+'" component="taskbar/title">'+e+"</span></a>").attr({title:e,"data-module":n.module,"data-uuid":n.uuid}).addClass(n.options.state!==void 0?n.options.state:"active");(!n.options.state||n.options.state==="active")&&f(),a.tasklist.append(u),l(),n.element=u,u.data(n),E.fire("action:taskbar.pushed",n),o(u)})}const i=function(n,o,t){switch(o){case"title":n.find('[component="taskbar/title"]').text(t);break;case"icon":n.find("i").attr("class","fa fa-"+t);break;case"image":n.find("a").css("background-image",t?'url("'+t.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":n.find("a").css("background-color",t);break}};return a.update=function(n,o,t){const e=a.tasklist.find('[data-module="'+n+'"][data-uuid="'+o+'"]');if(!e.length)return;const u=e.data();Object.keys(t).forEach(function(r){u[r]=t[r],i(e,r,t[r])}),e.data(u)},a}.apply(y,A),h!==void 0&&(v.exports=h)}}]);
