"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8709,1237,8704],{4695:(E,T,f)=>{var m;m=function(){const p={},w={ignoring:1,notwatching:2,watching:3};p.initUnreadTopics=function(){const i=app.user.unreadData;function o(e){if(e&&e.posts&&e.posts.length&&i){const d=e.posts[0];if(parseInt(d.uid,10)===parseInt(app.user.uid,10)||!d.topic.isFollowing&&d.categoryWatchState!==w.watching)return;const t=d.topic.tid;(!i[""][t]||!i.new[t]||!i.watched[t]||!i.unreplied[t])&&n(t),i[""][t]||(a(""),i[""][t]=!0),d.isMain&&parseInt(d.uid,10)!==parseInt(app.user.uid,10)&&!i.new[t]&&(a("new"),i.new[t]=!0),parseInt(d.topic.postcount,10)<=1&&!i.unreplied[t]&&(a("unreplied"),i.unreplied[t]=!0),d.topic.isFollowing&&!i.watched[t]&&(a("watched"),i.watched[t]=!0)}}function a(e){const d="/unread"+(e?"?filter="+e:""),t=1+parseInt($('a[href="'+config.relative_path+d+'"].navigation-link i').attr("data-content"),10);u(d,t)}function n(e){$('[data-tid="'+e+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach(function(e){delete i[e][ajaxify.data.tid]})}),socket.removeListener("event:new_post",o),socket.on("event:new_post",o),socket.removeListener("event:unread.updateCount",v),socket.on("event:unread.updateCount",v)};function v(i){u("/unread",i.unreadTopicCount),u("/unread?filter=new",i.unreadNewTopicCount),u("/unread?filter=watched",i.unreadWatchedTopicCount),u("/unread?filter=unreplied",i.unreadUnrepliedTopicCount)}function u(i,o){utils.isNumber(o)&&($('a[href="'+config.relative_path+i+'"].navigation-link i').toggleClass("unread-count",o>0).attr("data-content",o>99?"99+":o),$('#mobile-menu [data-unread-url="'+i+'"]').attr("data-content",o>99?"99+":o))}return p.updateUnreadTopicCount=u,p}.call(T,f,T,E),m!==void 0&&(E.exports=m)},73713:(E,T,f)=>{var m,p;m=[f(4695),f(69941),f(7237),f(14745),f(50548),f(7927)],p=function(w,v,u,i,o,a){const n={};n.init=function(){app.enterRoom("unread_topics"),e(),i.init("unread"),w.updateUnreadTopicCount("/"+ajaxify.data.selectedFilter.url,ajaxify.data.topicCount)};function e(){function l(){socket.emit("topics.markAllRead",function(h){if(h)return a.error(h);a.success("[[unread:topics_marked_as_read.success]]"),$('[component="category"]').empty(),$('[component="pagination"]').addClass("hidden"),$("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden")})}function s(){const h=v.getSelectedTids();h.length&&socket.emit("topics.markAsRead",h,function(S){if(S)return a.error(S);d(h)})}function y(h){function S(L){const R=[];return u.get("category/topic","cid",L).each(function(){R.push($(this).attr("data-tid"))}),R}const D=S(h);socket.emit("topics.markCategoryTopicsRead",h,function(L){if(L)return a.error(L);d(D)})}const F=o.init($('[component="category-selector"]'),{onSelect:function(h){F.selectCategory(0),h.cid==="all"?l():h.cid==="selected"?s():parseInt(h.cid,10)>0&&y(h.cid)},selectCategoryLabel:ajaxify.data.selectCategoryLabel||"[[unread:mark_as_read]]",localCategories:[{cid:"selected",name:"[[unread:selected]]",icon:""},{cid:"all",name:"[[unread:all]]",icon:""}]})}function d(l){t(l),a.success("[[unread:topics_marked_as_read.success]]"),$('[component="category"]').children().length||($("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden"))}function t(l){for(let s=0;s<l.length;s+=1)u.get("category/topic","tid",l[s]).remove()}return n}.apply(T,m),p!==void 0&&(E.exports=p)},39941:(E,T,f)=>{var m,p;m=[f(22905),f(74344),f(85233)],p=function(w,v,u){const i={};i.init=function(a,n){if(!a||!a.length)return;n=n||{},n.states=n.states||["watching","notwatching","ignoring"],n.template="partials/category-filter",u.fire("action:category.filter.options",{el:a,options:n}),w.init(a,n);let e=[],d=[];Array.isArray(n.selectedCids)?e=n.selectedCids.map(t=>parseInt(t,10)):Array.isArray(ajaxify.data.selectedCids)&&(e=ajaxify.data.selectedCids.map(t=>parseInt(t,10))),d=e.slice(),a.on("hidden.bs.dropdown",function(){let t=d.length!==e.length;if(d.forEach(function(l,s){l!==e[s]&&(t=!0)}),t&&o(a,e),n.onHidden){n.onHidden({changed:t,selectedCids:e.slice()});return}if(t){let l=window.location.pathname;const s=utils.params();e.length&&(s.cid=e,l+="?"+decodeURIComponent($.param(s))),ajaxify.go(l)}}),a.on("click",'[component="category/list"] [data-cid]',function(){const t=a.find('[component="category/list"]'),l=$(this),s=l.find("a").attr("href");if(s&&s!=="#"&&s.length)return;const y=parseInt(l.attr("data-cid"),10),F=l.find('[component="category/select/icon"]');return e.includes(y)?e.splice(e.indexOf(y),1):e.push(y),e.sort(function(h,S){return h-S}),n.selectedCids=e,F.toggleClass("invisible"),t.find('li[data-all="all"] i').toggleClass("invisible",!!e.length),n.onSelect&&n.onSelect({cid:y,selectedCids:e.slice()}),!1})};function o(a,n){n.length>1?e({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):n.length===1?v.get(`/categories/${n[0]}`,{}).then(e):e();function e(d){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:d},function(t){a.find("button").replaceWith($("<div/>").html(t).find("button"))})}}return i}.apply(T,m),p!==void 0&&(E.exports=p)},22905:(E,T,f)=>{var m,p;m=[f(7927)],p=function(w){const v={};return v.init=function(u,i){let o=null;i=i||{},i.privilege=i.privilege||"topics:read",i.states=i.states||["watching","notwatching","ignoring"];let a=[];Array.isArray(i.localCategories)&&(a=i.localCategories.map(l=>({...l}))),i.selectedCids=i.selectedCids||ajaxify.data.selectedCids||[];const n=u.find('[component="category-selector-search"]');if(!n.length)return;const e=n.parent('[component="category/dropdown"]').length>0||n.parent('[component="category-selector"]').length>0;u.on("show.bs.dropdown",function(){e&&(u.find(".dropdown-toggle").addClass("hidden"),n.removeClass("hidden"));function l(){const s=n.find("input").val();s.length>1||!s&&!o?d(s,function(y){o=o||y,t(y)}):!s&&o&&(o.forEach(function(y){y.selected=i.selectedCids.includes(y.cid)}),t(o))}n.on("click",function(s){s.preventDefault(),s.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(l,300)),l()}),u.on("shown.bs.dropdown",function(){n.find("input").focus()}),u.on("hide.bs.dropdown",function(){e&&(u.find(".dropdown-toggle").removeClass("hidden"),n.addClass("hidden")),n.off("click"),n.find("input").off("keyup")});function d(l,s){socket.emit("categories.categorySearch",{search:l,query:utils.params(),parentCid:i.parentCid||0,selectedCids:i.selectedCids,privilege:i.privilege,states:i.states,showLinks:i.showLinks},function(y,F){if(y)return w.error(y);s(a.concat(F))})}function t(l){app.parseAndTranslate(i.template,{categoryItems:l.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(s){u.find('[component="category/list"]').replaceWith(s.find('[component="category/list"]')),u.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!l.length)})}},v}.apply(T,m),p!==void 0&&(E.exports=p)},50548:(E,T,f)=>{var m,p;m=[f(22905),f(31369),f(85233)],p=function(w,v,u){const i={};return i.init=function(o,a){if(!o||!o.length)return;a=a||{};const n=a.onSelect||function(){};a.states=a.states||["watching","notwatching","ignoring"],a.template="partials/category-selector",u.fire("action:category.selector.options",{el:o,options:a}),w.init(o,a);const e={el:o,selectedCategory:null};o.on("click","[data-cid]",function(){const t=$(this);if(t.hasClass("disabled"))return!1;e.selectCategory(t.attr("data-cid")),n(e.selectedCategory)});const d=e.el.find('[component="category-selector-selected"]').html();return e.selectCategory=function(t){const l=e.el.find('[data-cid="'+t+'"]');e.selectedCategory={cid:t,name:l.attr("data-name")},l.length?e.el.find('[component="category-selector-selected"]').html(l.find('[component="category-markup"]').html()):e.el.find('[component="category-selector-selected"]').html(d)},e.getSelectedCategory=function(){return e.selectedCategory},e.getSelectedCid=function(){return e.selectedCategory?e.selectedCategory.cid:0},e},i.modal=function(o){o=o||{},o.onSelect=o.onSelect||function(){},o.onSubmit=o.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:o.message},function(a){const n=v.dialog({title:o.title||"[[modules:composer.select_category]]",message:a,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:d}}}),e=i.init(n.find('[component="category-selector"]'),o);function d(t){return t.preventDefault(),e.selectedCategory&&(o.onSubmit(e.selectedCategory),n.modal("hide")),!1}o.openOnLoad&&n.on("shown.bs.modal",function(){n.find(".dropdown-toggle").dropdown("toggle")}),n.find("form").on("submit",d)})},i}.apply(T,m),p!==void 0&&(E.exports=p)},14745:(E,T,f)=>{var m,p;m=[f(25142),f(66044),f(69941),f(39941),f(29412),f(85233)],p=function(w,v,u,i,o,a){const n={};let e="",d=0,t=0,l,s;const y=[];$(window).on("action:ajaxify.start",function(){n.removeListeners(),o.removeListeners()}),n.init=function(r,c){s=F(),e=r,l=c||R,o.init(),n.watchForNewPosts();const g=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?g.push("notwatching","ignoring"):r!=="unread"&&g.push("notwatching"),i.init($('[component="category/dropdown"]'),{states:g}),config.usePagination||w.init(n.loadMoreTopics),v.init(function(C,x){l(C,1,function(A,I){N(e,A.topics,ajaxify.data.showSelect,1,function(){x(),I()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){n.loadMoreTopics(1)}),a.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function F(){return $('[component="category"]').filter(function(r,c){return!$(c).parents("[widget-area],[data-widget-area]").length})}n.watchForNewPosts=function(){$("#new-topics-alert").on("click",function(){$(this).addClass("hide")}),t=0,d=0,n.removeListeners(),socket.on("event:new_topic",h),socket.on("event:new_post",S)},n.removeListeners=function(){socket.removeListener("event:new_topic",h),socket.removeListener("event:new_post",S)};function h(r){const c=ajaxify.data,g=c.selectedCids&&c.selectedCids.length&&c.selectedCids.indexOf(parseInt(r.cid,10))===-1,C=c.selectedFilter&&c.selectedFilter.filter==="watched",x=c.template.category&&parseInt(c.cid,10)!==parseInt(r.cid,10),A=!!(g||C||x||y.includes(r.tid));a.fire("filter:topicList.onNewTopic",{topic:r,preventAlert:A}).then(I=>{I.preventAlert||(r.scheduled&&r.tid&&y.push(r.tid),d+=1,D())})}function S(r){const c=r.posts[0];if(!c||!c.topic||c.topic.isFollowing)return;const g=ajaxify.data,C=parseInt(c.topic.mainPid,10)===parseInt(c.pid,10),x=g.selectedCids&&g.selectedCids.length&&g.selectedCids.indexOf(parseInt(c.topic.cid,10))===-1,A=g.selectedFilter&&g.selectedFilter.filter==="new",I=g.selectedFilter&&g.selectedFilter.filter==="watched"&&!c.topic.isFollowing,P=g.template.category&&parseInt(g.cid,10)!==parseInt(c.topic.cid,10),k=!!(C||x||A||I||P);a.fire("filter:topicList.onNewPost",{post:c,preventAlert:k}).then(b=>{b.preventAlert||(t+=1,D())})}function D(){let r="";d===0?t===1?r="[[recent:there-is-a-new-post]]":t>1&&(r="[[recent:there-are-new-posts, "+t+"]]"):d===1?t===0?r="[[recent:there-is-a-new-topic]]":t===1?r="[[recent:there-is-a-new-topic-and-a-new-post]]":t>1&&(r="[[recent:there-is-a-new-topic-and-new-posts, "+t+"]]"):d>1&&(t===0?r="[[recent:there-are-new-topics, "+d+"]]":t===1?r="[[recent:there-are-new-topics-and-a-new-post, "+d+"]]":t>1&&(r="[[recent:there-are-new-topics-and-new-posts, "+d+", "+t+"]]")),r+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(r).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}n.loadMoreTopics=function(r){if(!s.length||!s.children().length)return;const c=s.find('[component="category/topic"]'),g=r>0?c.last():c.first(),C=(parseInt(g.attr("data-index"),10)||0)+(r>0?1:0);!utils.isNumber(C)||C===0&&s.find('[component="category/topic"][data-index="0"]').length||l(C,r,function(x,A){N(e,x.topics,ajaxify.data.showSelect,r,A)})};function L(r,c){return Math.floor(r/config.topicsPerPage)+(c>0?1:0)}function R(r,c,g){g=g||function(){};const C=utils.params();C.page=L(r,c),w.loadMoreXhr(C,g)}function _(r){return r.filter(function(c){return!s.find('[component="category/topic"][data-tid="'+c.tid+'"]').length})}function N(r,c,g,C,x){if(!c||!c.length||(c=_(c),!c.length))return $("#load-more-btn").hide(),x();let A,I;const P=s.find('[component="category/topic"]');C>0&&c.length?A=P.last():C<0&&c.length&&(I=P.first());const k={topics:c,showSelect:g,template:{name:r}};k.template[r]=!0,a.fire("action:topics.loading",{topics:c,after:A,before:I}),app.parseAndTranslate(r,"topics",k,function(b){if(s.removeClass("hidden"),$("#category-no-topics").remove(),A&&A.length)b.insertAfter(A);else if(I&&I.length){const U=$(document).height(),j=$(window).scrollTop();b.insertBefore(I),$(window).scrollTop(j+($(document).height()-U))}else s.append(b);u.getSelectedTids().length||w.removeExtra(s.find('[component="category/topic"]'),C,Math.max(60,config.topicsPerPage*3)),b.find(".timeago").timeago(),app.createUserTooltips(b),utils.makeNumbersHumanReadable(b.find(".human-readable-number")),a.fire("action:topics.loaded",{topics:c,template:r}),x()})}return n}.apply(T,m),p!==void 0&&(E.exports=p)}}]);
