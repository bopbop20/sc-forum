"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4610,7214,6503,6027,2344,549,3014,8786,71,8818,831,7927],{78989:(B,S,r)=>{var v,x;v=[r(31369)],x=function(p){const y={};return y.init=function(){$("body").on("click",'[component="pagination/select-page"]',function(){return p.prompt("[[global:enter_page_number]]",function(A){y.loadPage(A)}),!1})},y.loadPage=function(A,P){if(P=P||function(){},A=parseInt(A,10),!utils.isNumber(A)||A<1||A>ajaxify.data.pagination.pageCount)return;const o=utils.params();o.page=A;const s=window.location.pathname+"?"+$.param(o);ajaxify.go(s,P)},y.nextPage=function(A){y.loadPage(ajaxify.data.pagination.currentPage+1,A)},y.previousPage=function(A){y.loadPage(ajaxify.data.pagination.currentPage-1,A)},y}.apply(S,v),x!==void 0&&(B.exports=x)},54939:(B,S,r)=>{var v,x;v=[r(78942),r(42840),r(7237),r(32230),r(13578),r(74344),r(31369),r(7927),r(85233)],x=function(p,y,A,P,o,s,g,R,n){const f={};let m=!1;f.init=function(i){m=!1,M(),k(i),p.addShareHandlers(ajaxify.data.titleRaw),o.addVoteHandler(),f.updatePostCount(ajaxify.data.postcount)};function M(){$('[component="topic"]').on("show.bs.dropdown",".moderator-tools",function(){const i=$(this),a=i.find(".dropdown-menu");if(a.html())return;const d=i.parents("[data-pid]"),c=d.attr("data-pid"),u=parseInt(d.attr("data-index"),10);socket.emit("posts.loadPostTools",{pid:c,cid:ajaxify.data.cid},async(h,t)=>{if(h)return R.error(h);t.posts.display_move_tools=t.posts.display_move_tools&&u!==0;const e=await app.parseAndTranslate("partials/topic/post-menu-list",t),l=r(42152);a.html(e),a.get(0).classList.toggle("hidden",!1),new l("[data-clipboard-text]"),n.fire("action:post.tools.load",{element:a})})})}f.toggle=function(i,a){const d=A.get("post","pid",i);d.find('[component="post/quote"], [component="post/bookmark"], [component="post/reply"], [component="post/flag"], [component="user/chat"]').toggleClass("hidden",a),d.find('[component="post/delete"]').toggleClass("hidden",a).parent().attr("hidden",a?"":null),d.find('[component="post/restore"]').toggleClass("hidden",!a).parent().attr("hidden",a?null:""),d.find('[component="post/purge"]').toggleClass("hidden",!a).parent().attr("hidden",a?null:""),f.removeMenu(d)},f.removeMenu=function(i){i.find('[component="post/tools"] .dropdown-menu').html("")},f.updatePostCount=function(i){const a=A.get("topic/post-count");a.html(i).attr("title",i),utils.makeNumbersHumanReadable(a),y.setCount(i)};function k(i){const a=A.get("topic");X(),a.on("click",'[component="post/quote"]',function(){E($(this),i)}),a.on("click",'[component="post/reply"]',function(){C($(this),i)}),$(".topic").on("click",'[component="topic/reply"]',function(c){c.preventDefault(),C($(this),i)}),$(".topic").on("click",'[component="topic/reply-as-topic"]',function(){P.translate("[[topic:link_back, "+ajaxify.data.titleRaw+", "+config.relative_path+"/topic/"+ajaxify.data.slug+"]]",function(c){n.fire("action:composer.topic.new",{cid:ajaxify.data.cid,body:c})})}),a.on("click",'[component="post/bookmark"]',function(){return F($(this),D($(this),"data-pid"))}),a.on("click",'[component="post/upvote"]',function(){return o.toggleVote($(this),".upvoted",1)}),a.on("click",'[component="post/downvote"]',function(){return o.toggleVote($(this),".downvoted",-1)}),a.on("click",'[component="post/vote-count"]',function(){o.showVotes(D($(this),"data-pid"))}),a.on("click",'[component="post/flag"]',function(){const c=D($(this),"data-pid");r.e(1803).then(function(){var u=[r(41803)];(function(h){h.showFlagModal({type:"post",id:c})}).apply(null,u)}).catch(r.oe)}),a.on("click",'[component="post/flagUser"]',function(){const c=D($(this),"data-uid");r.e(1803).then(function(){var u=[r(41803)];(function(h){h.showFlagModal({type:"user",id:c})}).apply(null,u)}).catch(r.oe)}),a.on("click",'[component="post/flagResolve"]',function(){const c=$(this).attr("data-flagId");r.e(1803).then(function(){var u=[r(41803)];(function(h){h.resolve(c)}).apply(null,u)}).catch(r.oe)}),a.on("click",'[component="post/edit"]',function(){const c=$(this),u=parseInt(D(c,"data-timestamp"),10),h=parseInt(ajaxify.data.postEditDuration,10);d(h,u,"post-edit-duration-expired")&&n.fire("action:composer.post.edit",{pid:D(c,"data-pid")})}),config.enablePostHistory&&ajaxify.data.privileges["posts:history"]&&a.on("click",'[component="post/view-history"], [component="post/edit-indicator"]',function(){const c=$(this);r.e(4654).then(function(){var u=[r(34654)];(function(h){h.open(D(c,"data-pid"))}).apply(null,u)}).catch(r.oe)}),a.on("click",'[component="post/delete"]',function(){const c=$(this),u=parseInt(D(c,"data-timestamp"),10),h=parseInt(ajaxify.data.postDeleteDuration,10);d(h,u,"post-delete-duration-expired")&&Q($(this))});function d(c,u,h){if(!ajaxify.data.privileges.isAdminOrMod&&c&&Date.now()-u>c*1e3){const t=Math.floor(c/86400),e=Math.floor(c%86400/3600),l=Math.floor(c%86400%3600/60),w=c%86400%3600%60;let I="[[error:"+h+", "+c+"]]";return t?e?I="[[error:"+h+"-days-hours, "+t+", "+e+"]]":I="[[error:"+h+"-days, "+t+"]]":e?l?I="[[error:"+h+"-hours-minutes, "+e+", "+l+"]]":I="[[error:"+h+"-hours, "+e+"]]":l&&(w?I="[[error:"+h+"-minutes-seconds, "+l+", "+w+"]]":I="[[error:"+h+"-minutes, "+l+"]]"),R.error(I),!1}return!0}a.on("click",'[component="post/restore"]',function(){Q($(this))}),a.on("click",'[component="post/purge"]',function(){Z($(this))}),a.on("click",'[component="post/move"]',function(){const c=$(this);r.e(3094).then(function(){var u=[r(53094)];(function(h){h.init(c.parents("[data-pid]"))}).apply(null,u)}).catch(r.oe)}),a.on("click",'[component="post/change-owner"]',function(){const c=$(this);r.e(6111).then(function(){var u=[r(6111)];(function(h){h.init(c.parents("[data-pid]"))}).apply(null,u)}).catch(r.oe)}),a.on("click",'[component="post/ban-ip"]',function(){const c=$(this).attr("data-ip");socket.emit("blacklist.addRule",c,function(u){if(u)return R.error(u);R.success("[[admin/manage/blacklist:ban-ip]]")})}),a.on("click",'[component="post/chat"]',function(){L($(this))})}async function C(i,a){const d=await Y();J(async function(){let c=await j(i);(D(i,"data-uid")==="0"||!D(i,"data-userslug"))&&(c="");const u=i.is('[component="post/reply"]')?D(i,"data-pid"):null,h=!u||!d.pid||u===d.pid;d.text&&h?(c=c||d.username,n.fire("action:composer.addQuote",{tid:a,pid:u,topicName:ajaxify.data.titleRaw,username:c,text:d.text,selectedPid:d.pid})):n.fire("action:composer.post.new",{tid:a,pid:u,topicName:ajaxify.data.titleRaw,text:c?c+" ":$('[component="topic/quickreply/text"]').val()||""})})}async function E(i,a){const d=await Y();J(async function(){const c=await j(i),u=D(i,"data-pid");function h(t){n.fire("action:composer.addQuote",{tid:a,pid:u,username:c,topicName:ajaxify.data.titleRaw,text:t})}if(d.text&&u&&u===d.pid)return h(d.text);socket.emit("posts.getRawPost",u,function(t,e){if(t)return R.error(t);h(e)})})}async function Y(){let i="",a,d="";const c=window.getSelection?window.getSelection():document.selection.createRange(),u=$('[component="post"] [component="post/content"]');let h;if(u.each(function(t,e){c&&c.containsNode&&e&&c.containsNode(e,!0)&&(h=e)}),h){const t=document.createRange();t.selectNodeContents(h);const e=c.getRangeAt(0).cloneRange();e.compareBoundaryPoints(Range.START_TO_START,t)<0&&e.setStart(t.startContainer,t.startOffset),e.compareBoundaryPoints(Range.END_TO_END,t)>0&&e.setEnd(t.endContainer,t.endOffset),t.detach(),i=e.toString(),a=$(h).parents('[component="post"]').attr("data-pid"),d=await j($(h)),e.detach()}return{text:i,pid:a,username:d}}function F(i,a){const d=i.attr("data-bookmarked")==="false"?"put":"del";return s[d](`/posts/${a}/bookmark`,void 0,function(c){if(c)return R.error(c);const u=d==="put"?"bookmark":"unbookmark";n.fire(`action:post.${u}`,{pid:a})}),!1}function D(i,a){return i.parents("[data-pid]").attr(a)}function j(i){return new Promise(a=>{let d="";if(i.attr("component")==="topic/reply"){a(d);return}const c=i.parents("[data-pid]");if(c.length){Promise.all([r.e(2772),r.e(999)]).then(function(){var u=[r(22568)];(function(h){d=h(c.attr("data-username"),!0),d||(c.attr("data-uid")!=="0"?d="[[global:former_user]]":d="[[global:guest]]"),d&&d!=="[[global:former_user]]"&&d!=="[[global:guest]]"&&(d="@"+d),a(d)}).apply(null,u)}).catch(r.oe);return}a(d)})}function Q(i){const a=D(i,"data-pid"),c=A.get("post","pid",a).hasClass("deleted")?"restore":"delete";H(c,a)}function Z(i){H("purge",D(i,"data-pid"))}async function H(i,a){({action:i}=await n.fire(`static:post.${i}`,{action:i,pid:a})),i&&g.confirm("[[topic:post_"+i+"_confirm]]",function(d){if(!d)return;const c=i==="purge"?"":"/state";s[i==="restore"?"put":"del"](`/posts/${a}${c}`).catch(R.error)})}function L(i){const a=i.parents("[data-pid]");return r.e(4337).then(function(){var d=[r(93216)];(function(c){c.newChat(a.attr("data-uid"))}).apply(null,d)}).catch(r.oe),i.parents(".btn-group").find(".dropdown-toggle").click(),!1}function J(i){const a=Math.min(Date.now()-864e5*ajaxify.data.topicStaleDays,864e13);if(m||ajaxify.data.lastposttime>=a)return i();g.dialog({title:"[[topic:stale.title]]",message:"[[topic:stale.warning]]",buttons:{reply:{label:"[[topic:stale.reply_anyway]]",className:"btn-link",callback:function(){m=!0,i()}},create:{label:"[[topic:stale.create]]",className:"btn-primary",callback:function(){P.translate("[[topic:link_back, "+ajaxify.data.title+", "+config.relative_path+"/topic/"+ajaxify.data.slug+"]]",function(c){n.fire("action:composer.topic.new",{cid:ajaxify.data.cid,body:c,fromStaleTopic:!0})})}}}}).modal()}const z=utils.debounce(G,100);function X(){ajaxify.data.privileges["topics:reply"]&&(n.onPage("action:posts.loaded",_),$(document).off("selectionchange",z).on("selectionchange",z))}function G(){window.getSelection().toString()===""?$('[component="selection/tooltip"]').addClass("hidden"):_()}async function _(){let i=$('[component="selection/tooltip"]');if(i.addClass("hidden"),i.attr("data-ajaxify")==="1"){i.remove();return}const a=window.getSelection();if(a.focusNode&&a.type==="Range"&&ajaxify.data.template.topic){const d=$(a.focusNode),c=$(a.anchorNode),u=c.parents("[data-pid]").attr("data-pid"),h=d.parents("[data-pid]").attr("data-pid");if(u!==h||!d.parents('[component="post/content"]').length||!c.parents('[component="post/content"]').length)return;const t=d.parents("[data-pid]"),e=a.getRangeAt(0);if(!t.length||e.collapsed)return;const l=e.getClientRects(),w=l[l.length-1];i.length||(i=await app.parseAndTranslate("partials/topic/selection-tooltip",ajaxify.data),i.addClass("hidden").appendTo("body")),i.off("click").on("click",'[component="selection/tooltip/quote"]',function(){i.addClass("hidden"),E(t.find('[component="post/quote"]'),ajaxify.data.tid)}),i.removeClass("hidden"),$(window).one("action:ajaxify.start",function(){i.attr("data-ajaxify",1).addClass("hidden"),$(document).off("selectionchange",z)});const I=i.outerWidth(!0);i.css({top:w.bottom+$(window).scrollTop(),left:I>w.width?w.left:w.left+w.width-I})}}return f}.apply(S,v),x!==void 0&&(B.exports=x)},13578:(B,S,r)=>{var v,x;v=[r(7237),r(32230),r(74344),r(85233),r(31369),r(7927)],x=function(p,y,A,P,o,s){const g={};g.addVoteHandler=function(){p.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',R)};function R(f){f.stopPropagation();const m=$(this),M=m.parent();M.find(".tooltip").css("display","none");const k=M.parents("[data-pid]").attr("data-pid");return socket.emit("posts.getUpvoters",[k],function(C,E){if(C)return s.error(C);E.length&&n(m,E[0])}),!1}function n(f,m){function M(C){f.attr("title",C).tooltip("fixTitle").tooltip("show"),f.parent().find(".tooltip").css("display","")}let k=m.usernames.filter(C=>C!=="[[global:former_user]]");k.length&&(k.length+m.otherCount>6?(k=k.join(", ").replace(/,/g,"|"),y.translate("[[topic:users_and_others, "+k+", "+m.otherCount+"]]",function(C){C=C.replace(/\|/g,","),M(C)})):(k=k.join(", "),M(k)))}return g.toggleVote=function(f,m,M){const k=f.closest("[data-pid]"),E=k.find(m).length?"del":"put",Y=k.attr("data-pid");return A[E](`/posts/${Y}/vote`,{delta:M},function(F){if(F){if(!app.user.uid){ajaxify.go("login");return}return s.error(F)}P.fire("action:post.toggleVote",{pid:Y,delta:M,unvote:E==="del"})}),!1},g.showVotes=function(f){socket.emit("posts.getVoters",{pid:f,cid:ajaxify.data.cid},function(m,M){if(m)return m.message==="[[error:no-privileges]]"?void 0:s.error(m);app.parseAndTranslate("partials/modals/votes_modal",M,function(k){const C=o.dialog({title:"[[global:voters]]",message:k,className:"vote-modal",show:!0});C.on("click",function(){C.modal("hide")})})})},g}.apply(S,v),x!==void 0&&(B.exports=x)},7927:(B,S,r)=>{var v,x;v=[r(32230),r(7237),r(85233)],x=function(p,y,A){const P={};P.alert=function(n){n.alert_id="alert_button_"+(n.alert_id?n.alert_id:new Date().getTime()),n.title=n.title&&n.title.trim()||"",n.message=n.message?n.message.trim():"",n.type=n.type||"info";const f=$("#"+n.alert_id);f.length?s(f,n):o(n)},P.success=function(n,f){P.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:n,type:"success",timeout:f||5e3})},P.error=function(n,f){if(n=n&&n.message||n,n==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}P.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:n,type:"danger",timeout:f||1e4})},P.remove=function(n){$("#alert_button_"+n).remove()};function o(n){app.parseAndTranslate("alert",n,function(f){let m=$("#"+n.alert_id);if(m.length)return s(m,n);m=f,m.fadeIn(200),y.get("toaster/tray").prepend(m),typeof n.closefn=="function"&&m.find("button").on("click",function(){return n.closefn(),g(m),!1}),n.timeout&&R(m,n),typeof n.clickfn=="function"&&m.addClass("pointer").on("click",function(M){$(M.target).is(".close")||n.clickfn(m,n),g(m)}),A.fire("action:alert.new",{alert:m,params:n})})}function s(n,f){n.find("strong").translateHtml(f.title),n.find("p").translateHtml(f.message),n.attr("class","alert alert-dismissable alert-"+f.type+" clearfix"),clearTimeout(parseInt(n.attr("timeoutId"),10)),f.timeout&&R(n,f),A.fire("action:alert.update",{alert:n,params:f}),n.off("click").removeClass("pointer"),typeof f.clickfn=="function"&&n.addClass("pointer").on("click",function(m){$(m.target).is(".close")||f.clickfn(),g(n)})}function g(n){n.fadeOut(500,function(){$(this).remove()})}function R(n,f){const m=f.timeout,M=setTimeout(function(){g(n),typeof f.timeoutfn=="function"&&f.timeoutfn(n,f)},m);n.attr("timeoutId",M),n.css("transition-property","none"),n.removeClass("animate"),setTimeout(function(){n.css("transition-property",""),n.css("transition","width "+(m+450)+"ms linear, background-color "+(m+450)+"ms ease-in"),n.addClass("animate"),A.fire("action:alert.animate",{alert:n,params:f})},50),n.on("mouseenter",function(){$(this).css("transition-duration",0)})}return P}.apply(S,v),x!==void 0&&(B.exports=x)},74344:(B,S,r)=>{var v,x;v=[r(85233)],x=(p=>{const y={},A=config.relative_path+"/api/v3";function P(o,s){o.url=o.url.startsWith("/api")?config.relative_path+o.url:A+o.url;async function g(R){({options:o}=await p.fire("filter:api.options",{options:o})),$.ajax(o).done(n=>{R(null,n&&n.hasOwnProperty("status")&&n.hasOwnProperty("response")?n.response:n||{})}).fail(n=>{let f;n.responseJSON&&(f=n.responseJSON.status&&n.responseJSON.status.message?n.responseJSON.status.message:n.responseJSON.error),R(new Error(f||n.statusText))})}if(typeof s=="function"){g(s);return}return new Promise((R,n)=>{g(function(f,m){f?n(f):R(m)})})}return y.get=(o,s,g)=>P({url:o+(s&&Object.keys(s).length?"?"+$.param(s):"")},g),y.head=(o,s,g)=>P({url:o+(s&&Object.keys(s).length?"?"+$.param(s):""),method:"head"},g),y.post=(o,s,g)=>P({url:o,method:"post",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},g),y.patch=(o,s,g)=>P({url:o,method:"patch",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},g),y.put=(o,s,g)=>P({url:o,method:"put",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},g),y.del=(o,s,g)=>P({url:o,method:"delete",data:JSON.stringify(s),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},g),y.delete=y.del,y}).apply(S,v),x!==void 0&&(B.exports=x)},7237:(B,S,r)=>{var v;v=function(){const x={};return x.core={"topic/teaser":function(p){return p?$('[component="category/topic"][data-tid="'+p+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(p,y){return $('[component="topic"][data-'+p+'="'+y+'"]')},post:function(p,y){return $('[component="post"][data-'+p+'="'+y+'"]')},"post/content":function(p){return $('[component="post"][data-pid="'+p+'"] [component="post/content"]')},"post/header":function(p){return $('[component="post"][data-pid="'+p+'"] [component="post/header"]')},"post/anchor":function(p){return $('[component="post"][data-index="'+p+'"] [component="post/anchor"]')},"post/vote-count":function(p){return $('[component="post"][data-pid="'+p+'"] [component="post/vote-count"]')},"post/bookmark-count":function(p){return $('[component="post"][data-pid="'+p+'"] [component="post/bookmark-count"]')},"user/postcount":function(p){return $('[component="user/postcount"][data-uid="'+p+'"]')},"user/reputation":function(p){return $('[component="user/reputation"][data-uid="'+p+'"]')},"category/topic":function(p,y){return $('[component="category/topic"][data-'+p+'="'+y+'"]')},"categories/category":function(p,y){return $('[component="categories/category"][data-'+p+'="'+y+'"]')},"chat/message":function(p){return $('[component="chat/message"][data-mid="'+p+'"]')},"chat/message/body":function(p){return $('[component="chat/message"][data-mid="'+p+'"] [component="chat/message/body"]')},"chat/recent/room":function(p){return $('[component="chat/recent/room"][data-roomid="'+p+'"]')}},x.get=function(){const p=Array.prototype.slice.call(arguments,1);return x.core[arguments[0]]&&p.length?x.core[arguments[0]].apply(this,p):$('[component="'+arguments[0]+'"]')},x}.call(S,r,S,B),v!==void 0&&(B.exports=v)},42840:(B,S,r)=>{var v,x;v=[r(78989),r(7237),r(85233),r(7927)],x=function(p,y,A,P){const o={};let s=0,g=0,R,n,f,m,M,k=!1,C=!0;o.scrollActive=!1;let E=$(".pagination-block"),Y=E.find(".pagination-text"),F=E.find("meter"),D=E.find(".progress-bar"),j,Q,Z,H,L;$(window).on("action:ajaxify.start",function(){$(window).off("keydown",c)}),o.init=function(t,e,l,w,I){s=0,o.selector=t,o.callback=I,o.toTop=l||function(){},o.toBottom=w||function(){},E=$(".pagination-block"),Y=E.find(".pagination-text"),F=E.find("meter"),D=E.find(".progress-bar"),Z=$(".scroller-thumb-icon"),H=Z.height(),L=H/2,j=$(".scroller-thumb"),Q=j.find(".thumb-text"),$(window).off("scroll",o.delayedUpdate).on("scroll",o.delayedUpdate),E.find(".dropdown-menu").off("click").on("click",function(N){N.stopPropagation()}),E.off("shown.bs.dropdown",".wrapper").on("shown.bs.dropdown",".wrapper",function(){setTimeout(async function(){utils.findBootstrapEnvironment()==="lg"&&$(".pagination-block input").focus(),await socket.emit("topics.getPostCountInTopic",ajaxify.data.tid)>0&&E.find("#myNextPostBtn").removeAttr("disabled")},100)}),E.find(".pageup").off("click").on("click",o.scrollUp),E.find(".pagedown").off("click").on("click",o.scrollDown),E.find(".pagetop").off("click").on("click",o.toTop),E.find(".pagebottom").off("click").on("click",o.toBottom),E.find("#myNextPostBtn").off("click").on("click",z),E.find("input").on("keydown",function(N){if(N.which===13){const T=$(this);if(!utils.isNumber(T.val())){T.val("");return}const b=parseInt(T.val(),10),U=u(b);T.val(""),$(".pagination-block .dropdown-toggle").trigger("click"),ajaxify.go(U)}}),ajaxify.data.template.topic&&_(),d(),o.setCount(e),o.update(0)};let J=0;async function z(){async function t(e){return await socket.emit("topics.getMyNextPostIndex",{tid:ajaxify.data.tid,index:Math.max(1,e),sort:config.topicPostSort})}if(ajaxify.data.template.topic){let e=await t(s);J===e&&(e=await t(e)),e&&s!==e+1?(J=e,$(window).one("action:ajaxify.end",function(){E.find(".dropdown-menu").is(":hidden")&&E.find(".dropdown-toggle").dropdown("toggle")}),o.scrollToIndex(e,!0,0)):(P.alert({message:"[[topic:no-more-next-post]]",type:"info"}),J=1)}}function X(t){const e=j.parent(),l=e.offset();return t<l.top?t=l.top:t>l.top+e.height()-H&&(t=l.top+e.height()-H),t}function G(t){if(!j.length||j.is(":hidden"))return;const e=j.parent(),l=e.offset();let w=(t-1)/ajaxify.data.postcount;t===g&&(w=1);const N={top:X(l.top+(e.height()-H)*w),left:j.offset().left};j.offset(N),Q.text(t+"/"+ajaxify.data.postcount),a(t)}function _(){if(!j.length)return;const t=j.parent();t.on("click",function(T){if($(T.target).hasClass("scroller-container")){const b=e(T.pageY);return o.scrollToIndex(b-1,!0,0),!1}});function e(T){const b=X(T-L),U=t.offset(),V=(b-U.top)/(t.height()-H);return s=Math.max(1,Math.ceil(ajaxify.data.postcount*V)),s>ajaxify.data.postcount?ajaxify.data.count:s}let l=!1;A.on("action:ajaxify.end",function(){M=null}),$(".pagination-block .dropdown-menu").parent().on("shown.bs.dropdown",function(){G(s)}),j.on("mousedown",function(){l=!0,$(window).on("mousemove",I),C=!0});function w(){$(window).off("mousemove",I),l&&(o.scrollToIndex(s-1,!0,0),E.find('[data-toggle="dropdown"]').trigger("click")),i(),l=!1,C=!1}function I(T){const b=X(T.pageY-L);j.offset({top:b,left:j.offset().left});const U=e(T.pageY);return o.updateTextAndProgressBar(),Q.text(U+"/"+ajaxify.data.postcount),C&&N(),C=!1,T.stopPropagation(),!1}function N(){i(),n=setInterval(function(){a(s)},250)}$(window).off("mousemove",I),$(window).off("mouseup",w).on("mouseup",w),j.on("touchstart",function(T){k=!0,f=Math.min($(window).width(),Math.max(0,T.touches[0].clientX)),m=Math.min($(window).height(),Math.max(0,T.touches[0].clientY)),C=!0}),j.on("touchmove",function(T){const b=$(window).width(),U=$(window).height(),V=Math.abs(f-Math.min(b,Math.max(0,T.touches[0].clientX))),W=Math.abs(m-Math.min(U,Math.max(0,T.touches[0].clientY)));if(f=Math.min(b,Math.max(0,T.touches[0].clientX)),m=Math.min(U,Math.max(0,T.touches[0].clientY)),W>=V&&C&&(k=!0,N()),k&&T.cancelable){T.preventDefault(),T.stopPropagation();const K=X(m+$(window).scrollTop()-L);j.offset({top:K,left:j.offset().left});const O=e(m+$(window).scrollTop());o.updateTextAndProgressBar(),Q.text(O+"/"+ajaxify.data.postcount),C&&a(O)}C=!1}),j.on("touchend",function(){i(),k&&(o.scrollToIndex(s-1,!0,0),k=!1,E.find('[data-toggle="dropdown"]').trigger("click"))})}function i(){n&&(clearInterval(n),n=0)}function a(t,e){e=e||function(){},!(M===t||E.find(".post-content").is(":hidden"))&&(M=t,socket.emit("posts.getPostSummaryByIndex",{tid:ajaxify.data.tid,index:t-1},function(l,w){if(l)return P.error(l);app.parseAndTranslate("partials/topic/navigation-post",{post:w},function(I){E.find(".post-content").html(I).find(".timeago").timeago()}),e()}))}function d(){config.usePagination||$(window).off("keydown",c).on("keydown",c)}function c(t){if(t.target.nodeName==="BODY"){if(t.shiftKey||t.ctrlKey||t.altKey)return;if(t.which===36&&o.toTop)return o.toTop(),!1;if(t.which===35&&o.toBottom)return o.toBottom(),!1}}function u(t){const l=window.location.pathname.replace(config.relative_path,"").split("/");return l[1]+"/"+l[2]+"/"+l[3]+(t?"/"+t:"")}o.getCount=()=>g,o.setCount=function(t){t=parseInt(t,10),t!==g&&(g=t,o.updateTextAndProgressBar())},o.show=function(){h(!0)},o.disable=function(){g=0,s=1,o.callback=null,o.selector=null,$(window).off("scroll",o.delayedUpdate),h(!1)};function h(t){const e=ajaxify.removeRelativePath(window.location.pathname.slice(1));t&&!e.startsWith("topic")&&!e.startsWith("category")||E.toggleClass("ready",t)}return o.delayedUpdate=function(){R||(R=setTimeout(function(){o.update(),R=void 0},100))},o.update=function(t){t=typeof t=="number"?t:void 0;let e=s;const l=$(o.selector);l.length&&(e=parseInt(l.first().attr("data-index"),10)+1);const w=$(window).scrollTop(),I=$(window).height(),N=$(document).height(),T=w+I/2;let b=Number.MAX_VALUE;l.each(function(){const W=$(this),K=parseInt(W.attr("data-index"),10);if(K>=0){const O=Math.abs(T-(W.offset().top+W.outerHeight(!0)/2));if(O>b)return!1;O<b&&(e=K+1,b=O)}});const U=w===0&&parseInt(l.first().attr("data-index"),10)===0,V=w+I>N-100&&parseInt(l.last().attr("data-index"),10)===g-1;if(U?e=1:V&&(e=g),t===void 0&&ajaxify.data.template.topic)if(U)t=0;else{const W=y.get("post/anchor",s-1);W.length&&(t=W.get(0).getBoundingClientRect().top)}typeof o.callback=="function"&&o.callback(e,g,t),e!==s&&(s=e,o.updateTextAndProgressBar(),G(s)),h(!!g)},o.getIndex=()=>s,o.setIndex=t=>{s=t+1,o.updateTextAndProgressBar(),G(s)},o.updateTextAndProgressBar=function(){if(!utils.isNumber(s))return;s=s>g?g:s,Y.translateHtml("[[global:pagination.out_of, "+s+", "+g+"]]");const t=(s-1)/(g-1||1);F.val(t),D.width(t*100+"%")},o.scrollUp=function(){const t=$(window);if(config.usePagination&&t.scrollTop()<=0)return p.previousPage(function(){$("body,html").scrollTop($(document).height()-t.height())});$("body,html").animate({scrollTop:t.scrollTop()-t.height()})},o.scrollDown=function(){const t=$(window);if(config.usePagination&&t.scrollTop()>=$(document).height()-t.height())return p.nextPage();$("body,html").animate({scrollTop:t.scrollTop()+t.height()})},o.scrollTop=function(t){$(o.selector+'[data-index="'+t+'"]').length?o.scrollToIndex(t,!0):ajaxify.go(u())},o.scrollBottom=function(t){parseInt(t,10)<0||($(o.selector+'[data-index="'+t+'"]').length?o.scrollToIndex(t,!0):(t=parseInt(t,10)+1,ajaxify.go(u(t))))},o.scrollToIndex=function(t,e,l){const w=!!y.get("topic").length,I=!!y.get("category").length;if(!utils.isNumber(t)||!w&&!I)return;if(l=l!==void 0?l:400,o.scrollActive=!0,w&&y.get("post/anchor",t).length)return o.scrollToPostIndex(t,e,l);if(I&&$('[component="category/topic"][data-index="'+t+'"]').length)return o.scrollToTopicIndex(t,e,l);if(!config.usePagination){o.scrollActive=!1,t=parseInt(t,10)+1,ajaxify.go(u(t));return}const N=w?o.scrollToPostIndex:o.scrollToTopicIndex,T=1+Math.floor(t/config.postsPerPage);parseInt(T,10)!==ajaxify.data.pagination.currentPage?p.loadPage(T,function(){N(t,e,l)}):N(t,e,l)},o.scrollToPostIndex=function(t,e,l){const w=y.get("post","index",t);o.scrollToElement(w,e,l,t)},o.scrollToTopicIndex=function(t,e,l){const w=$('[component="category/topic"][data-index="'+t+'"]');o.scrollToElement(w,e,l,t)},o.scrollToElement=async(t,e,l,w=null)=>{if(!t.length){o.scrollActive=!1;return}await A.fire("filter:navigator.scroll",{scrollTo:t,highlight:e,duration:l,newIndex:w});const I=t.outerHeight(!0),N=y.get("navbar").outerHeight(!0)||0,T=$(".topic-header").outerHeight(!0)||0,b=$(window).height();$(window).off("scroll",o.delayedUpdate),l=l!==void 0?l:400,o.scrollActive=!0;let U=!1;function V(){function K(){setTimeout(()=>{$(window).on("scroll",o.delayedUpdate),A.fire("action:navigator.scrolled",{scrollTo:t,highlight:e,duration:l,newIndex:w})},50)}function O(){if(U){K();return}U=!0,o.scrollActive=!1,W();const tt=t.get(0).getBoundingClientRect();w?o.setIndex(w):o.update(tt.top)}let q=0;if(I<b-N-T?q=t.offset().top-b/2+I/2:q=t.offset().top-N-T,l===0){$(window).scrollTop(q),O(),K();return}$("html, body").animate({scrollTop:q+"px"},l,O)}function W(){e&&($('[component="post"],[component="category/topic"]').removeClass("highlight"),t.addClass("highlight"),setTimeout(function(){t.removeClass("highlight")},1e4))}V()},o}.apply(S,v),x!==void 0&&(B.exports=x)},78942:(B,S,r)=>{var v,x;v=[r(85233)],x=function(p){const y={};y.addShareHandlers=function(o){const s=window.location.protocol+"//"+window.location.host;function g(R,n,f,m){return window.open(R+encodeURIComponent(s+config.relative_path+n),"_blank","width="+f+",height="+m+",scrollbars=no,status=no"),p.fire("action:share.open",{url:R,urlToPost:n}),!1}$("#content").off("shown.bs.dropdown",".share-dropdown").on("shown.bs.dropdown",".share-dropdown",function(){const R=$(this).find(".post-link");R.val(s+P($(this))),setTimeout(function(){R.putCursorAtEnd().select()},50)}),A(".post-link",function(R){return R.preventDefault(),!1}),A('[component="share/twitter"]',function(){return g("https://twitter.com/intent/tweet?text="+encodeURIComponent(o)+"&url=",P($(this)),550,420)}),A('[component="share/facebook"]',function(){return g("https://www.facebook.com/sharer/sharer.php?u=",P($(this)),626,436)}),p.fire("action:share.addHandlers",{openShare:g})};function A(o,s){$("#content").off("click",o).on("click",o,s)}function P(o){const s=parseInt(o.parents("[data-pid]").attr("data-pid"),10);return"/post"+(s?"/"+s:"")}return y}.apply(S,v),x!==void 0&&(B.exports=x)}}]);
