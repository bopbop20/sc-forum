"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8596,3014,3034,4337,1837],{18596:(E,y,c)=>{var A,g;A=[c(7237),c(74344),c(7927)],g=function(I,m,v){const u={};u.init=function(){I.get("chat/search").on("keyup",utils.debounce(l,250))};function l(){const e=I.get("chat/search").val();if(!e)return $('[component="chat/search/list"]').empty();m.get("/api/users",{query:e,searchBy:"username",paginate:!1}).then(d).catch(v.error)}function d(e){const s=$('[component="chat/search/list"]');if(s.empty(),e.users=e.users.filter(function(t){return parseInt(t.uid,10)!==parseInt(app.user.uid,10)}),!e.users.length)return s.translateHtml("<li><div><span>[[users:no-users-found]]</span></div></li>");e.users.forEach(function(t){const n=p(s,t);i(n,t)}),s.parent().toggleClass("open",!0)}function p(e,s){function t(){return(s.picture?'<img src="'+s.picture+'" title="'+s.username+'" />':'<div class="user-icon" style="background-color: '+s["icon:bgColor"]+'">'+s["icon:text"]+"</div>")+'<i class="fa fa-circle status '+s.status+'"></i> '+s.username}const n=$('<li component="chat/search/user"></li>').attr("data-uid",s.uid).appendTo(e);return n.append(t()),n}function i(e,s){e.on("click",function(){socket.emit("modules.chats.hasPrivateChat",s.uid,function(t,n){if(t)return v.error(t);n?Promise.all([c.e(2441),c.e(1006),c.e(4271),c.e(3050)]).then(function(){var r=[c(30524)];(function(a){a.switchChat(n)}).apply(null,r)}).catch(c.oe):c.e(4337).then(function(){var r=[c(93216)];(function(a){a.newChat(s.uid)}).apply(null,r)}).catch(c.oe)})})}return u}.apply(y,A),g!==void 0&&(E.exports=g)},74344:(E,y,c)=>{var A,g;A=[c(85233)],g=(I=>{const m={},v=config.relative_path+"/api/v3";function u(l,d){l.url=l.url.startsWith("/api")?config.relative_path+l.url:v+l.url;async function p(i){({options:l}=await I.fire("filter:api.options",{options:l})),$.ajax(l).done(e=>{i(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})}).fail(e=>{let s;e.responseJSON&&(s=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),i(new Error(s||e.statusText))})}if(typeof d=="function"){p(d);return}return new Promise((i,e)=>{p(function(s,t){s?e(s):i(t)})})}return m.get=(l,d,p)=>u({url:l+(d&&Object.keys(d).length?"?"+$.param(d):"")},p),m.head=(l,d,p)=>u({url:l+(d&&Object.keys(d).length?"?"+$.param(d):""),method:"head"},p),m.post=(l,d,p)=>u({url:l,method:"post",data:JSON.stringify(d||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.patch=(l,d,p)=>u({url:l,method:"patch",data:JSON.stringify(d||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.put=(l,d,p)=>u({url:l,method:"put",data:JSON.stringify(d||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.del=(l,d,p)=>u({url:l,method:"delete",data:JSON.stringify(d),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},p),m.delete=m.del,m}).apply(y,A),g!==void 0&&(E.exports=g)},93216:(E,y,c)=>{var A,g;A=[c(7237),c(27145),c(32230),c(85233),c(31369),c(7927),c(74344)],g=function(I,m,v,u,l,d,p){const i={};let e=!1;i.openChat=function(t,n){if(!app.user.uid)return d.error("[[error:not-logged-in]]");function r(a){i.load(a.attr("data-uuid")),i.center(a),i.focusInput(a)}i.modalExists(t)?r(i.getModal(t)):p.get(`/chats/${t}`,{uid:n||app.user.uid}).then(a=>{a.users=a.users.filter(function(f){return f&&parseInt(f.uid,10)!==parseInt(app.user.uid,10)}),a.uid=n||app.user.uid,a.isSelf=!0,i.createModal(a,r)}).catch(d.error)},i.newChat=function(t,n){function r(){p.post("/chats",{uids:[t]}).then(({roomId:a})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+a):i.openChat(a),n(null,a)}).catch(d.error)}if(n=n||function(){},!app.user.uid)return d.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return d.error("[[error:cant-chat-with-yourself]]");socket.emit("modules.chats.isDnD",t,function(a,f){if(a)return d.error(a);if(!f)return r();l.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(h){h&&r()})})},i.loadChatsDropdown=function(t){socket.emit("modules.chats.getRecentChats",{uid:app.user.uid,after:0},function(n,r){if(n)return d.error(n);const a=r.rooms.filter(function(f){return f.teaser});v.toggleTimeagoShorthand(function(){for(let f=0;f<a.length;f+=1)a[f].teaser.timeago=$.timeago(new Date(parseInt(a[f].teaser.timestamp,10)));v.toggleTimeagoShorthand(),app.parseAndTranslate("partials/chats/dropdown",{rooms:a},function(f){t.find("*").not(".navigation-link").remove(),t.prepend(f),app.createUserTooltips(t,"right"),t.off("click").on("click","[data-roomid]",function(h){if($(h.target).parents(".user-link").length)return;const o=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+o):i.openChat(o)}),$('[component="chats/mark-all-read"]').off("click").on("click",function(){socket.emit("modules.chats.markAllRead",function(h){if(h)return d.error(h)})})})})})},i.onChatMessageReceived=function(t){const n=t.self===1;t.message.self=t.self,e=t.self===0,i.modalExists(t.roomId)?s(t):ajaxify.data.template.chats||p.get(`/chats/${t.roomId}`,{}).then(r=>{r.users=r.users.filter(function(a){return a&&parseInt(a.uid,10)!==parseInt(app.user.uid,10)}),r.silent=!0,r.uid=app.user.uid,r.isSelf=n,i.createModal(r)}).catch(d.error)};function s(t){const n=i.getModal(t.roomId),r=t.message.fromUser.username,a=t.self===1;c.e(6862).then(function(){var f=[c(46862)];(function(h){n.find('[data-mid="'+t.message.messageId+'"]').length||h.appendChatMessage(n.find(".chat-content"),t.message),n.is(":visible")?(m.updateActive(n.attr("data-uuid")),h.isAtBottom(n.find(".chat-content"))&&h.scrollToBottom(n.find(".chat-content"))):ajaxify.data.template.chats||i.toggleNew(n.attr("data-uuid"),!0,!0),!a&&(!n.is(":visible")||!app.isFocused)&&m.push("chat",n.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||r),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,f)}).catch(c.oe)}return i.onUserStatusChange=function(t){const n=i.getModal(t.uid);app.updateUserStatus(n.find('[component="user/status"]'),t.status)},i.onRoomRename=function(t){const n=$("<div></div>").html(t.newName).text(),r=i.getModal(t.roomId);r.find('[component="chat/room/name"]').text(n),m.update("chat",r.attr("data-uuid"),{title:n}),u.fire("action:chat.renamed",Object.assign(t,{modal:r}))},i.getModal=function(t){return $("#chat-modal-"+t)},i.modalExists=function(t){return $("#chat-modal-"+t).length!==0},i.createModal=function(t,n){n=n||function(){},Promise.all([c.e(2441),c.e(1006),c.e(4271),c.e(9789)]).then(function(){var r=[c(75203),c(30524),c(46862)];(function(a,f,h){app.parseAndTranslate("chat",t,function(o){if(i.modalExists(t.roomId))return n(i.getModal(t.roomId));const x=utils.generateUUID();let R=!1;o.attr("id","chat-modal-"+t.roomId),o.attr("data-roomid",t.roomId),o.attr("intervalId",0),o.attr("data-uuid",x),o.css("position","fixed"),o.appendTo($("body")),o.find(".timeago").timeago(),i.center(o),app.loadJQueryUI(function(){o.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),o.find(".modal-content").on("resize",function(C,B){B.originalSize.height!==B.size.height&&o.find(".modal-body").css("height",i.calculateChatListHeight(o))}),o.draggable({start:function(){m.updateActive(x)},stop:function(){i.focusInput(o)},distance:10,handle:".modal-header"})}),a.apply(o.find('[component="chat/messages"]')),o.find("#chat-close-btn").on("click",function(){i.close(o)});function N(){const C=I.get("chat/input").val();$(window).one("action:ajaxify.end",function(){I.get("chat/input").val(C)}),ajaxify.go("user/"+app.user.userslug+"/chats/"+o.attr("data-roomid")),i.close(o)}o.find(".modal-header").on("dblclick",N),o.find('button[data-action="maximize"]').on("click",N),o.find('button[data-action="minimize"]').on("click",function(){const C=o.attr("data-uuid");i.minimize(C)}),o.on("mouseup",function(){m.updateActive(o.attr("data-uuid")),R&&(R=!1)}),o.on("mousemove",function(C){C.which===1&&(R=!0)}),o.on("mousemove keypress click",function(){e&&(socket.emit("modules.chats.markRead",t.roomId),e=!1)}),f.addActionHandlers(o.find('[component="chat/messages"]'),t.roomId),f.addRenameHandler(o.attr("data-roomid"),o.find('[data-action="rename"]'),t.roomName),f.addLeaveHandler(o.attr("data-roomid"),o.find('[data-action="leave"]')),f.addSendHandlers(o.attr("data-roomid"),o.find(".chat-input"),o.find('[data-action="send"]')),f.addMemberHandler(o.attr("data-roomid"),o.find('[data-action="members"]')),f.createAutoComplete(o.find('[component="chat/input"]')),f.addScrollHandler(o.attr("data-roomid"),t.uid,o.find(".chat-content")),f.addScrollBottomHandler(o.find(".chat-content")),f.addCharactersLeftHandler(o),f.addIPHandler(o),f.addUploadHandler({dragDropAreaEl:o.find(".modal-content"),pasteEl:o,uploadFormEl:o.find('[component="chat/upload"]'),inputEl:o.find('[component="chat/input"]')}),h.addSocketListeners(),m.push("chat",o.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){m.toggleNew(o.attr("data-uuid"),!t.isSelf),u.fire("action:chat.loaded",o),typeof n=="function"&&n(o)})})}).apply(null,r)}).catch(c.oe)},i.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},i.close=function(t){const n=t.attr("data-uuid");clearInterval(t.attr("intervalId")),t.attr("intervalId",0),t.remove(),t.data("modal",null),m.discard("chat",n),t.attr("data-mobile")&&i.disableMobileBehaviour(t),u.fire("action:chat.closed",{uuid:n,modal:t})},i.closeByUUID=function(t){const n=$('.chat-modal[data-uuid="'+t+'"]');i.close(n)},i.center=function(t){let n=!1;return t.hasClass("hide")&&(t.removeClass("hide"),n=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),n&&t.addClass("hide"),t},i.load=function(t){c.e(6862).then(function(){var n=[c(46862)];(function(r){const a=$('.chat-modal[data-uuid="'+t+'"]');a.removeClass("hide"),m.updateActive(t),r.scrollToBottom(a.find(".chat-content")),i.focusInput(a),socket.emit("modules.chats.markRead",a.attr("data-roomid"));const f=utils.findBootstrapEnvironment();(f==="xs"||f==="sm")&&i.enableMobileBehaviour(a)}).apply(null,n)}).catch(c.oe)},i.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const n=t.find(".modal-body");n.css("height",i.calculateChatListHeight(t));function r(){n.css("height",i.calculateChatListHeight(t)),c.e(6862).then(function(){var a=[c(46862)];(function(f){f.scrollToBottom(t.find(".chat-content"))}).apply(null,a)}).catch(c.oe)}$(window).on("resize",r),$(window).one("action:ajaxify.start",function(){i.close(t),$(window).off("resize",r)})},i.disableMobileBehaviour=function(){app.toggleNavbar(!0)},i.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},i.minimize=function(t){const n=$('.chat-modal[data-uuid="'+t+'"]');n.addClass("hide"),m.minimize("chat",t),clearInterval(n.attr("intervalId")),n.attr("intervalId",0),u.fire("action:chat.minimized",{uuid:t,modal:n})},i.toggleNew=m.toggleNew,i}.apply(y,A),g!==void 0&&(E.exports=g)},27145:(E,y,c)=>{E=c.nmd(E);var A,g;A=[c(59006),c(32230),c(85233)],g=function(I,m,v){const u={};u.init=function(){const e=this;I.render("modules/taskbar",{}).then(function(s){e.taskbar=$(s),e.tasklist=e.taskbar.find("ul"),$(document.body).append(e.taskbar),e.taskbar.on("click","li",async function(){const t=$(this),n=t.attr("data-module"),r=t.attr("data-uuid"),a=await app.require(n);return t.hasClass("active")?a.minimize(r):(d(),a.load(r),u.toggleNew(r,!1),u.tasklist.removeClass("active"),t.addClass("active")),!1})}),$(window).on("action:app.loggedOut",function(){u.closeAll()})},u.close=async function(e,s){const t=u.tasklist.find('[data-module="'+E+'"][data-uuid="'+s+'"]');let n="close";if(e==="chat"&&(n="closeByUUID"),t.length){const r=await app.require(e);r&&typeof r[n]=="function"&&r[n](s)}},u.closeAll=function(e){let s="[data-uuid]";e&&(s='[data-module="'+e+'"]'+s),u.tasklist.find(s).each(function(t,n){u.close(e||n.getAttribute("data-module"),n.getAttribute("data-uuid"))})},u.discard=function(e,s){u.tasklist.find('[data-module="'+e+'"][data-uuid="'+s+'"]').remove(),l()},u.push=function(e,s,t,n){n=n||function(){};const r=u.tasklist.find('li[data-uuid="'+s+'"]'),a={module:e,uuid:s,options:t,element:r};v.fire("filter:taskbar.push",a),!r.length&&a.module?p(a,n):n(r)},u.get=function(e){return $('[data-module="'+e+'"]').map(function(t,n){return $(n).data()})},u.minimize=function(e,s){u.tasklist.find('[data-module="'+e+'"][data-uuid="'+s+'"]').toggleClass("active",!1)},u.toggleNew=function(e,s,t){u.tasklist.find('[data-uuid="'+e+'"]').toggleClass("new",s),t||v.fire("action:taskbar.toggleNew",e)},u.updateActive=function(e){const s=u.tasklist.find("li");s.removeClass("active"),s.filter('[data-uuid="'+e+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+e+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},u.isActive=function(e){return u.tasklist.find('li[data-uuid="'+e+'"]').hasClass("active")};function l(){u.tasklist.find("li").length>0?u.taskbar.attr("data-active","1"):u.taskbar.removeAttr("data-active")}function d(){u.tasklist.find(".active").removeClass("active")}function p(e,s){m.translate(e.options.title,function(t){const n=$("<div></div>").text(t||"NodeBB Task").html(),r=$("<li></li>").addClass(e.options.className).html('<a href="#"'+(e.options.image?` style="background-image: url('`+e.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(e.options.icon?'<i class="fa '+e.options.icon+'"></i> ':"")+'<span aria-label="'+n+'" component="taskbar/title">'+n+"</span></a>").attr({title:n,"data-module":e.module,"data-uuid":e.uuid}).addClass(e.options.state!==void 0?e.options.state:"active");(!e.options.state||e.options.state==="active")&&d(),u.tasklist.append(r),l(),e.element=r,r.data(e),v.fire("action:taskbar.pushed",e),s(r)})}const i=function(e,s,t){switch(s){case"title":e.find('[component="taskbar/title"]').text(t);break;case"icon":e.find("i").attr("class","fa fa-"+t);break;case"image":e.find("a").css("background-image",t?'url("'+t.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":e.find("a").css("background-color",t);break}};return u.update=function(e,s,t){const n=u.tasklist.find('[data-module="'+e+'"][data-uuid="'+s+'"]');if(!n.length)return;const r=n.data();Object.keys(t).forEach(function(a){r[a]=t[a],i(n,a,t[a])}),n.data(r)},u}.apply(y,A),g!==void 0&&(E.exports=g)}}]);
