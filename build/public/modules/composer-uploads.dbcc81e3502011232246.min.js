(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[7931,7214,6503,6027,3014,6623,9286,4677,2735,71,3034,3684,831,7927],{7927:(y,b,f)=>{"use strict";var v,g;v=[f(32230),f(7237),f(85233)],g=function(l,u,s){const t={};t.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:new Date().getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const n=$("#"+e.alert_id);n.length?a(n,e):i(e)},t.success=function(e,n){t.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:n||5e3})},t.error=function(e,n){if(e=e&&e.message||e,e==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}t.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:n||1e4})},t.remove=function(e){$("#alert_button_"+e).remove()};function i(e){app.parseAndTranslate("alert",e,function(n){let o=$("#"+e.alert_id);if(o.length)return a(o,e);o=n,o.fadeIn(200),u.get("toaster/tray").prepend(o),typeof e.closefn=="function"&&o.find("button").on("click",function(){return e.closefn(),r(o),!1}),e.timeout&&d(o,e),typeof e.clickfn=="function"&&o.addClass("pointer").on("click",function(c){$(c.target).is(".close")||e.clickfn(o,e),r(o)}),s.fire("action:alert.new",{alert:o,params:e})})}function a(e,n){e.find("strong").translateHtml(n.title),e.find("p").translateHtml(n.message),e.attr("class","alert alert-dismissable alert-"+n.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),n.timeout&&d(e,n),s.fire("action:alert.update",{alert:e,params:n}),e.off("click").removeClass("pointer"),typeof n.clickfn=="function"&&e.addClass("pointer").on("click",function(o){$(o.target).is(".close")||n.clickfn(),r(e)})}function r(e){e.fadeOut(500,function(){$(this).remove()})}function d(e,n){const o=n.timeout,c=setTimeout(function(){r(e),typeof n.timeoutfn=="function"&&n.timeoutfn(e,n)},o);e.attr("timeoutId",c),e.css("transition-property","none"),e.removeClass("animate"),setTimeout(function(){e.css("transition-property",""),e.css("transition","width "+(o+450)+"ms linear, background-color "+(o+450)+"ms ease-in"),e.addClass("animate"),s.fire("action:alert.animate",{alert:e,params:n})},50),e.on("mouseenter",function(){$(this).css("transition-duration",0)})}return t}.apply(b,v),g!==void 0&&(y.exports=g)},74344:(y,b,f)=>{"use strict";var v,g;v=[f(85233)],g=(l=>{const u={},s=config.relative_path+"/api/v3";function t(i,a){i.url=i.url.startsWith("/api")?config.relative_path+i.url:s+i.url;async function r(d){({options:i}=await l.fire("filter:api.options",{options:i})),$.ajax(i).done(e=>{d(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})}).fail(e=>{let n;e.responseJSON&&(n=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),d(new Error(n||e.statusText))})}if(typeof a=="function"){r(a);return}return new Promise((d,e)=>{r(function(n,o){n?e(n):d(o)})})}return u.get=(i,a,r)=>t({url:i+(a&&Object.keys(a).length?"?"+$.param(a):"")},r),u.head=(i,a,r)=>t({url:i+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},r),u.post=(i,a,r)=>t({url:i,method:"post",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},r),u.patch=(i,a,r)=>t({url:i,method:"patch",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},r),u.put=(i,a,r)=>t({url:i,method:"put",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},r),u.del=(i,a,r)=>t({url:i,method:"delete",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},r),u.delete=u.del,u}).apply(b,v),g!==void 0&&(y.exports=g)},22905:(y,b,f)=>{"use strict";var v,g;v=[f(7927)],g=function(l){const u={};return u.init=function(s,t){let i=null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","notwatching","ignoring"];let a=[];Array.isArray(t.localCategories)&&(a=t.localCategories.map(o=>({...o}))),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const r=s.find('[component="category-selector-search"]');if(!r.length)return;const d=r.parent('[component="category/dropdown"]').length>0||r.parent('[component="category-selector"]').length>0;s.on("show.bs.dropdown",function(){d&&(s.find(".dropdown-toggle").addClass("hidden"),r.removeClass("hidden"));function o(){const c=r.find("input").val();c.length>1||!c&&!i?e(c,function(m){i=i||m,n(m)}):!c&&i&&(i.forEach(function(m){m.selected=t.selectedCids.includes(m.cid)}),n(i))}r.on("click",function(c){c.preventDefault(),c.stopPropagation()}),r.find("input").val("").on("keyup",utils.debounce(o,300)),o()}),s.on("shown.bs.dropdown",function(){r.find("input").focus()}),s.on("hide.bs.dropdown",function(){d&&(s.find(".dropdown-toggle").removeClass("hidden"),r.addClass("hidden")),r.off("click"),r.find("input").off("keyup")});function e(o,c){socket.emit("categories.categorySearch",{search:o,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(m,_){if(m)return l.error(m);c(a.concat(_))})}function n(o){app.parseAndTranslate(t.template,{categoryItems:o.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(c){s.find('[component="category/list"]').replaceWith(c.find('[component="category/list"]')),s.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!o.length)})}},u}.apply(b,v),g!==void 0&&(y.exports=g)},50548:(y,b,f)=>{"use strict";var v,g;v=[f(22905),f(31369),f(85233)],g=function(l,u,s){const t={};return t.init=function(i,a){if(!i||!i.length)return;a=a||{};const r=a.onSelect||function(){};a.states=a.states||["watching","notwatching","ignoring"],a.template="partials/category-selector",s.fire("action:category.selector.options",{el:i,options:a}),l.init(i,a);const d={el:i,selectedCategory:null};i.on("click","[data-cid]",function(){const n=$(this);if(n.hasClass("disabled"))return!1;d.selectCategory(n.attr("data-cid")),r(d.selectedCategory)});const e=d.el.find('[component="category-selector-selected"]').html();return d.selectCategory=function(n){const o=d.el.find('[data-cid="'+n+'"]');d.selectedCategory={cid:n,name:o.attr("data-name")},o.length?d.el.find('[component="category-selector-selected"]').html(o.find('[component="category-markup"]').html()):d.el.find('[component="category-selector-selected"]').html(e)},d.getSelectedCategory=function(){return d.selectedCategory},d.getSelectedCid=function(){return d.selectedCategory?d.selectedCategory.cid:0},d},t.modal=function(i){i=i||{},i.onSelect=i.onSelect||function(){},i.onSubmit=i.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:i.message},function(a){const r=u.dialog({title:i.title||"[[modules:composer.select_category]]",message:a,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:e}}}),d=t.init(r.find('[component="category-selector"]'),i);function e(n){return n.preventDefault(),d.selectedCategory&&(i.onSubmit(d.selectedCategory),r.modal("hide")),!1}i.openOnLoad&&r.on("shown.bs.modal",function(){r.find(".dropdown-toggle").dropdown("toggle")}),r.find("form").on("submit",e)})},t}.apply(b,v),g!==void 0&&(y.exports=g)},7237:(y,b,f)=>{"use strict";var v;v=function(){const g={};return g.core={"topic/teaser":function(l){return l?$('[component="category/topic"][data-tid="'+l+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(l,u){return $('[component="topic"][data-'+l+'="'+u+'"]')},post:function(l,u){return $('[component="post"][data-'+l+'="'+u+'"]')},"post/content":function(l){return $('[component="post"][data-pid="'+l+'"] [component="post/content"]')},"post/header":function(l){return $('[component="post"][data-pid="'+l+'"] [component="post/header"]')},"post/anchor":function(l){return $('[component="post"][data-index="'+l+'"] [component="post/anchor"]')},"post/vote-count":function(l){return $('[component="post"][data-pid="'+l+'"] [component="post/vote-count"]')},"post/bookmark-count":function(l){return $('[component="post"][data-pid="'+l+'"] [component="post/bookmark-count"]')},"user/postcount":function(l){return $('[component="user/postcount"][data-uid="'+l+'"]')},"user/reputation":function(l){return $('[component="user/reputation"][data-uid="'+l+'"]')},"category/topic":function(l,u){return $('[component="category/topic"][data-'+l+'="'+u+'"]')},"categories/category":function(l,u){return $('[component="categories/category"][data-'+l+'="'+u+'"]')},"chat/message":function(l){return $('[component="chat/message"][data-mid="'+l+'"]')},"chat/message/body":function(l){return $('[component="chat/message"][data-mid="'+l+'"] [component="chat/message/body"]')},"chat/recent/room":function(l){return $('[component="chat/recent/room"][data-roomid="'+l+'"]')}},g.get=function(){const l=Array.prototype.slice.call(arguments,1);return g.core[arguments[0]]&&l.length?g.core[arguments[0]].apply(this,l):$('[component="'+arguments[0]+'"]')},g}.call(b,f,b,y),v!==void 0&&(y.exports=v)},98755:(y,b,f)=>{y.exports=f(77678)},83713:(y,b,f)=>{y.exports=f(51077)},22143:(y,b,f)=>{y.exports=f(77070)},27145:(y,b,f)=>{"use strict";y=f.nmd(y);var v,g;v=[f(59006),f(32230),f(85233)],g=function(l,u,s){const t={};t.init=function(){const e=this;l.render("modules/taskbar",{}).then(function(n){e.taskbar=$(n),e.tasklist=e.taskbar.find("ul"),$(document.body).append(e.taskbar),e.taskbar.on("click","li",async function(){const o=$(this),c=o.attr("data-module"),m=o.attr("data-uuid"),_=await app.require(c);return o.hasClass("active")?_.minimize(m):(a(),_.load(m),t.toggleNew(m,!1),t.tasklist.removeClass("active"),o.addClass("active")),!1})}),$(window).on("action:app.loggedOut",function(){t.closeAll()})},t.close=async function(e,n){const o=t.tasklist.find('[data-module="'+y+'"][data-uuid="'+n+'"]');let c="close";if(e==="chat"&&(c="closeByUUID"),o.length){const m=await app.require(e);m&&typeof m[c]=="function"&&m[c](n)}},t.closeAll=function(e){let n="[data-uuid]";e&&(n='[data-module="'+e+'"]'+n),t.tasklist.find(n).each(function(o,c){t.close(e||c.getAttribute("data-module"),c.getAttribute("data-uuid"))})},t.discard=function(e,n){t.tasklist.find('[data-module="'+e+'"][data-uuid="'+n+'"]').remove(),i()},t.push=function(e,n,o,c){c=c||function(){};const m=t.tasklist.find('li[data-uuid="'+n+'"]'),_={module:e,uuid:n,options:o,element:m};s.fire("filter:taskbar.push",_),!m.length&&_.module?r(_,c):c(m)},t.get=function(e){return $('[data-module="'+e+'"]').map(function(o,c){return $(c).data()})},t.minimize=function(e,n){t.tasklist.find('[data-module="'+e+'"][data-uuid="'+n+'"]').toggleClass("active",!1)},t.toggleNew=function(e,n,o){t.tasklist.find('[data-uuid="'+e+'"]').toggleClass("new",n),o||s.fire("action:taskbar.toggleNew",e)},t.updateActive=function(e){const n=t.tasklist.find("li");n.removeClass("active"),n.filter('[data-uuid="'+e+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+e+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},t.isActive=function(e){return t.tasklist.find('li[data-uuid="'+e+'"]').hasClass("active")};function i(){t.tasklist.find("li").length>0?t.taskbar.attr("data-active","1"):t.taskbar.removeAttr("data-active")}function a(){t.tasklist.find(".active").removeClass("active")}function r(e,n){u.translate(e.options.title,function(o){const c=$("<div></div>").text(o||"NodeBB Task").html(),m=$("<li></li>").addClass(e.options.className).html('<a href="#"'+(e.options.image?` style="background-image: url('`+e.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(e.options.icon?'<i class="fa '+e.options.icon+'"></i> ':"")+'<span aria-label="'+c+'" component="taskbar/title">'+c+"</span></a>").attr({title:c,"data-module":e.module,"data-uuid":e.uuid}).addClass(e.options.state!==void 0?e.options.state:"active");(!e.options.state||e.options.state==="active")&&a(),t.tasklist.append(m),i(),e.element=m,m.data(e),s.fire("action:taskbar.pushed",e),n(m)})}const d=function(e,n,o){switch(n){case"title":e.find('[component="taskbar/title"]').text(o);break;case"icon":e.find("i").attr("class","fa fa-"+o);break;case"image":e.find("a").css("background-image",o?'url("'+o.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":e.find("a").css("background-color",o);break}};return t.update=function(e,n,o){const c=t.tasklist.find('[data-module="'+e+'"][data-uuid="'+n+'"]');if(!c.length)return;const m=c.data();Object.keys(o).forEach(function(_){m[_]=o[_],d(c,_,o[_])}),c.data(m)},t}.apply(b,v),g!==void 0&&(y.exports=g)},33371:(y,b,f)=>{"use strict";var v,g;v=[f(7927)],g=function(l){const u={};return u.init=function(s){const t=s.uploadFormEl;t.length&&(t.attr("action",config.relative_path+s.route),s.dragDropAreaEl&&u.handleDragDrop({container:s.dragDropAreaEl,callback:function(i){u.ajaxSubmit({uploadForm:t,upload:i,callback:s.callback})}}),s.pasteEl&&u.handlePaste({container:s.pasteEl,callback:function(i){u.ajaxSubmit({uploadForm:t,upload:i,callback:s.callback})}}))},u.handleDragDrop=function(s){let t=!1;const i=s.container,a=s.container.find(".imagedrop");i.on("dragenter",function(){t||(a.css("top","0px"),a.css("height",i.height()+"px"),a.css("line-height",i.height()+"px"),a.show(),a.on("dragleave",function(){a.hide(),a.off("dragleave")}))}),a.on("drop",function(e){e.preventDefault();const n=e.originalEvent.dataTransfer.files;if(n.length){let c;if(window.FormData){c=new FormData;for(var o=0;o<n.length;++o)c.append("files[]",n[o],n[o].name)}s.callback({files:n,formData:c})}return a.hide(),!1});function r(d){return d.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){t=!0}).off("dragend").on("dragend, mouseup",function(){t=!1}),a.on("dragover",r),a.on("dragenter",r)},u.handlePaste=function(s){s.container.on("paste",function(i){const a=(i.clipboardData||i.originalEvent.clipboardData||{}).items,r=[],d=[];let e=null;window.FormData&&(e=new FormData),[].forEach.call(a,function(n){const o=n.getAsFile();if(o){const c=utils.generateUUID()+"-"+o.name;e&&e.append("files[]",o,c),r.push(o),d.push(c)}}),r.length&&s.callback({files:r,fileNames:d,formData:e})})},u.ajaxSubmit=function(s){const t=[...s.upload.files];for(let a=0;a<t.length;++a){const r=t[a].type.match(/image./);if(r&&!app.user.privileges["upload:post:image"]||!r&&!app.user.privileges["upload:post:file"])return l.error("[[error:no-privileges]]");if(t[a].size>parseInt(config.maximumFileSize,10)*1024)return s.uploadForm[0].reset(),l.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const i=Date.now();s.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:s.upload.formData,error:function(a){let r=a.responseJSON&&(a.responseJSON.error||a.responseJSON.status&&a.responseJSON.status.message)||"[[error:parse-error]]";a&&a.status===413&&(r=a.statusText||"Request Entity Too Large"),l.error(r),l.remove(i)},uploadProgress:function(a,r,d,e){l.alert({alert_id:i,message:"[[modules:composer.uploading, "+e+"%]]"})},success:function(a){const r=a.response.images;if(r&&r.length)for(var d=0;d<r.length;++d)r[d].filename=t[d].name,r[d].isImage=/image./.test(t[d].type);s.callback(r)},complete:function(){s.uploadForm[0].reset(),setTimeout(l.remove,100,i)}}),!1}),s.uploadForm.submit()},u}.apply(b,v),g!==void 0&&(y.exports=g)},77678:(y,b,f)=>{"use strict";var v,g;v=[f(50548),f(27145),f(74344)],g=function(l,u,s){var t={},i;t.init=function(e,n){var o=e.find(".category-list-container");o.length&&(e.on("action:composer.resize",function(){a(e)}),t.updateTaskbar(e,n),i=l.init(o.find('[component="category-selector"]'),{privilege:"topics:create",states:["watching","notwatching","ignoring"],onSelect:function(c){n.hasOwnProperty("cid")&&d(e,n,c)}}),i&&(n.cid&&n.category?i.selectedCategory={cid:n.cid,name:n.category.name}:ajaxify.data.template.compose&&ajaxify.data.selectedCategory&&(i.selectedCategory={cid:ajaxify.data.cid,name:ajaxify.data.selectedCategory}),e.find(".category-name").translateText(i.selectedCategory?i.selectedCategory.name:"[[modules:composer.select_category]]").on("click",function(){l.modal({privilege:"topics:create",states:["watching","notwatching","ignoring"],openOnLoad:!0,showLinks:!1,onSelect:function(c){e.find(".category-name").text(c.name),i.selectCategory(c.cid),n.hasOwnProperty("cid")&&d(e,n,c)}})}),a(e)))};function a(e){e.find('.category-list-container [component="category-selector"]').toggleClass("dropup",e.outerHeight()<$(window).height()/2)}t.getSelectedCid=function(){var e;return i&&(e=i.getSelectedCategory()),e?e.cid:0},t.updateTaskbar=function(e,n){parseInt(n.cid,10)&&s.get(`/categories/${n.cid}`,{}).then(function(o){r(e,o)})};function r(e,n){if(n){var o=e.attr("data-uuid");u.update("composer",o,{image:n.backgroundImage,"background-color":n.bgColor,icon:n.icon&&n.icon.slice(3)})}}async function d(e,n,o){n.cid=o.cid;const c=await window.fetch(`${config.relative_path}/api/category/${o.cid}`).then(m=>m.json());n.category=c,r(e,c),f.e(3913).then(function(){var m=[f(98166),f(88186)];(function(_,T){_.onChangeCategory(c),T.onChangeCategory(e,n,o.cid,c),$(window).trigger("action:composer.changeCategory",{postContainer:e,postData:n,selectedCategory:o,categoryData:c})}).apply(null,m)}).catch(f.oe)}return t}.apply(b,v),g!==void 0&&(y.exports=g)},51077:(y,b,f)=>{"use strict";var v,g;v=[f(85233)],g=function(l){var u={};return u.render=function(s,t){if(t=t||function(){},!s.find(".preview-container").is(":visible"))return t();var i=s.find("textarea");socket.emit("plugins.composer.renderPreview",i.val(),function(a,r){a||(r=$("<div>"+r+"</div>"),r.find("img:not(.not-responsive)").addClass("img-responsive"),s.find(".preview").html(r),l.fire("action:composer.preview"),t())})},u.matchScroll=function(s){if(s.find(".preview-container").is(":visible")){var t=s.find("textarea"),i=s.find(".preview");if(t.length&&i.length){var a=t[0].scrollHeight-t.height();if(a===0)return;var r=t.scrollTop()/a;i.scrollTop(Math.max(i[0].scrollHeight-i.height(),0)*r)}}},u.handleToggler=function(s){u.env=utils.findBootstrapEnvironment();var t=s.find(".write-container .toggle-preview"),i=s.find(".preview-container .toggle-preview"),a=$(".preview-container"),r=$(".write-container");function d(){n(!1),u.env!=="xs"&&u.env!=="sm"&&localStorage.setItem("composer:previewToggled",!0)}function e(){n(!0),u.env!=="xs"&&u.env!=="sm"&&localStorage.removeItem("composer:previewToggled")}function n(o){u.env==="xs"||u.env==="sm"?(a.toggleClass("hide",!1),r.toggleClass("maximized",!1),t.toggleClass("hide",!0),a.toggleClass("hidden-xs hidden-sm",!o),r.toggleClass("hidden-xs hidden-sm",o),o&&u.render(s)):(a.toggleClass("hide",!o),r.toggleClass("maximized",!o),t.toggleClass("hide",o)),u.matchScroll(s)}u.toggle=n,i.on("click",function(){d(),s.find(".write").focus()}),t.on("click",function(){e(),s.find(".write").focus()}),localStorage.getItem("composer:previewToggled")||u.env==="xs"||u.env==="sm"?d():e()},u}.apply(b,v),g!==void 0&&(y.exports=g)},77070:(y,b,f)=>{"use strict";var v,g;v=[f(83713),f(98755),f(32230),f(7927),f(33371),f(86569)],g=function(l,u,s,t,i){var a={inProgress:{}},r="";a.initialize=function(p){o(p),c(p),d(p),e(p),s.translate("[[modules:composer.uploading, "+0+"%]]",function(h){r=h})};function d(p){var h=$('.composer[data-uuid="'+p+'"]');h.find("#files").on("change",function(E){var k=(E.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);k&&T({files:k,post_uuid:p,route:"/api/post/upload"})})}function e(p){var h=$('.composer[data-uuid="'+p+'"]');h.on("click",".topic-thumb-clear-btn",function(E){h.find("input#topic-thumb-url").val("").trigger("change"),n(h.find("input#topic-thumb-file")),$(this).addClass("hide"),E.preventDefault()}),h.on("paste change keypress","input#topic-thumb-url",function(){var E=$(this);setTimeout(function(){var k=E.val();k?h.find(".topic-thumb-clear-btn").removeClass("hide"):(n(h.find("input#topic-thumb-file")),h.find(".topic-thumb-clear-btn").addClass("hide")),h.find("img.topic-thumb-preview").attr("src",k)},100)})}function n(p){p.wrap("<form />").closest("form").get(0).reset(),p.unwrap()}function o(p){var h=$('.composer[data-uuid="'+p+'"]');i.handleDragDrop({container:h,callback:function(E){T({files:E.files,post_uuid:p,route:"/api/post/upload",formData:E.formData})}})}function c(p){var h=$('.composer[data-uuid="'+p+'"]');i.handlePaste({container:h,callback:function(E){T({files:E.files,fileNames:E.fileNames,post_uuid:p,route:"/api/post/upload",formData:E.formData})}})}function m(p){return p.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function _(p,h,E){return p.slice(0,h)+E+p.slice(h)}function T(p){var h=[...p.files],E=p.post_uuid,k=$('.composer[data-uuid="'+E+'"]'),S=k.find("textarea"),O=S.val(),N=k.find("#fileForm"),M=!1;N.attr("action",config.relative_path+p.route);var R=u.getSelectedCid();!R&&ajaxify.data.cid&&(R=ajaxify.data.cid);var A=0,F=!1;for(A=0;A<h.length;++A)if(F=h[A].type.match(/image./),F&&!app.user.privileges["upload:post:image"]||!F&&!app.user.privileges["upload:post:file"])return t.error("[[error:no-privileges]]");var x=[];for(A=0;A<h.length;++A){if(x.push(A+"_"+Date.now()+"_"+(p.fileNames?p.fileNames[A]:h[A].name)),F=h[A].type.match(/image./),h[A].size>parseInt(config.maximumFileSize,10)*1024)return N[0].reset(),t.error("[[error:file-too-big, "+config.maximumFileSize+"]]");O=_(O,S.getCursorPosition(),(F?"!":"")+"["+x[A]+"]("+r+") ")}N.length&&k.find('[data-action="post"]').prop("disabled",!0),S.val(O),$(window).trigger("action:composer.uploadStart",{post_uuid:E,files:x.map(function(I,w){return{filename:I.replace(/^\d+_\d{13}_/,""),isImage:/image./.test(h[w].type)}}),text:r}),N.off("submit").submit(function(){function I(w,D,C){var B;C&&(B=w.replace(/^\d+_\d{13}_/,""));var U=S.val(),P=new RegExp(m(w)+"]\\([^)]+\\)","g");S.val(U.replace(P,(B||w)+"]("+D+")")),$(window).trigger("action:composer.uploadUpdate",{post_uuid:E,filename:w,text:D})}return a.inProgress[E]=a.inProgress[E]||[],a.inProgress[E].push(1),p.formData&&p.formData.append("cid",R),$(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:p.formData,data:{cid:R},error:function(w){M=!0,k.find('[data-action="post"]').prop("disabled",!1);const D=j(w,E);for(var C=0;C<h.length;++C)I(x[C],D,!0);l.render(k)},uploadProgress:function(w,D,C,B){s.translate("[[modules:composer.uploading, "+B+"%]]",function(U){if(!M)for(var P=0;P<h.length;++P)I(x[P],U)})},success:function(w){const D=w.response.images;if(M=!0,D&&D.length)for(var C=0;C<D.length;++C)D[C].filename=x[C].replace(/^\d+_\d{13}_/,""),D[C].isImage=/image./.test(h[C].type),I(x[C],D[C].url,!0);l.render(k),S.focus(),k.find('[data-action="post"]').prop("disabled",!1),$(window).trigger("action:composer.upload",{post_uuid:E,files:D})},complete:function(){N[0].reset(),a.inProgress[E].pop()}}),!1}),N.submit()}function j(p,h){var E=p.responseJSON&&(p.responseJSON.error||p.responseJSON.status&&p.responseJSON.status.message)||"[[error:parse-error]]";return p&&p.status===413&&(E=p.statusText||"Request Entity Too Large"),t.error(E),$(window).trigger("action:composer.uploadError",{post_uuid:h,message:E}),E}return a}.apply(b,v),g!==void 0&&(y.exports=g)}}]);
