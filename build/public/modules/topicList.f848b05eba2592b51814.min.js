"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8704],{39941:(T,I,u)=>{var A,w;A=[u(22905),u(74344),u(85233)],w=function(E,x,h){const s={};s.init=function(l,e){if(!l||!l.length)return;e=e||{},e.states=e.states||["watching","notwatching","ignoring"],e.template="partials/category-filter",h.fire("action:category.filter.options",{el:l,options:e}),E.init(l,e);let c=[],d=[];Array.isArray(e.selectedCids)?c=e.selectedCids.map(o=>parseInt(o,10)):Array.isArray(ajaxify.data.selectedCids)&&(c=ajaxify.data.selectedCids.map(o=>parseInt(o,10))),d=c.slice(),l.on("hidden.bs.dropdown",function(){let o=d.length!==c.length;if(d.forEach(function(r,i){r!==c[i]&&(o=!0)}),o&&y(l,c),e.onHidden){e.onHidden({changed:o,selectedCids:c.slice()});return}if(o){let r=window.location.pathname;const i=utils.params();c.length&&(i.cid=c,r+="?"+decodeURIComponent($.param(i))),ajaxify.go(r)}}),l.on("click",'[component="category/list"] [data-cid]',function(){const o=l.find('[component="category/list"]'),r=$(this),i=r.find("a").attr("href");if(i&&i!=="#"&&i.length)return;const f=parseInt(r.attr("data-cid"),10),F=r.find('[component="category/select/icon"]');return c.includes(f)?c.splice(c.indexOf(f),1):c.push(f),c.sort(function(L,P){return L-P}),e.selectedCids=c,F.toggleClass("invisible"),o.find('li[data-all="all"] i').toggleClass("invisible",!!c.length),e.onSelect&&e.onSelect({cid:f,selectedCids:c.slice()}),!1})};function y(l,e){e.length>1?c({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):e.length===1?x.get(`/categories/${e[0]}`,{}).then(c):c();function c(d){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:d},function(o){l.find("button").replaceWith($("<div/>").html(o).find("button"))})}}return s}.apply(I,A),w!==void 0&&(T.exports=w)},22905:(T,I,u)=>{var A,w;A=[u(7927)],w=function(E){const x={};return x.init=function(h,s){let y=null;s=s||{},s.privilege=s.privilege||"topics:read",s.states=s.states||["watching","notwatching","ignoring"];let l=[];Array.isArray(s.localCategories)&&(l=s.localCategories.map(r=>({...r}))),s.selectedCids=s.selectedCids||ajaxify.data.selectedCids||[];const e=h.find('[component="category-selector-search"]');if(!e.length)return;const c=e.parent('[component="category/dropdown"]').length>0||e.parent('[component="category-selector"]').length>0;h.on("show.bs.dropdown",function(){c&&(h.find(".dropdown-toggle").addClass("hidden"),e.removeClass("hidden"));function r(){const i=e.find("input").val();i.length>1||!i&&!y?d(i,function(f){y=y||f,o(f)}):!i&&y&&(y.forEach(function(f){f.selected=s.selectedCids.includes(f.cid)}),o(y))}e.on("click",function(i){i.preventDefault(),i.stopPropagation()}),e.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),h.on("shown.bs.dropdown",function(){e.find("input").focus()}),h.on("hide.bs.dropdown",function(){c&&(h.find(".dropdown-toggle").removeClass("hidden"),e.addClass("hidden")),e.off("click"),e.find("input").off("keyup")});function d(r,i){socket.emit("categories.categorySearch",{search:r,query:utils.params(),parentCid:s.parentCid||0,selectedCids:s.selectedCids,privilege:s.privilege,states:s.states,showLinks:s.showLinks},function(f,F){if(f)return E.error(f);i(l.concat(F))})}function o(r){app.parseAndTranslate(s.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(i){h.find('[component="category/list"]').replaceWith(i.find('[component="category/list"]')),h.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length)})}},x}.apply(I,A),w!==void 0&&(T.exports=w)},14745:(T,I,u)=>{var A,w;A=[u(25142),u(66044),u(69941),u(39941),u(29412),u(85233)],w=function(E,x,h,s,y,l){const e={};let c="",d=0,o=0,r,i;const f=[];$(window).on("action:ajaxify.start",function(){e.removeListeners(),y.removeListeners()}),e.init=function(n,t){i=F(),c=n,r=t||S,y.init(),e.watchForNewPosts();const a=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?a.push("notwatching","ignoring"):n!=="unread"&&a.push("notwatching"),s.init($('[component="category/dropdown"]'),{states:a}),config.usePagination||E.init(e.loadMoreTopics),x.init(function(p,m){r(p,1,function(g,C){N(c,g.topics,ajaxify.data.showSelect,1,function(){m(),C()})})}),$("body").height()<=$(window).height()&&i.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){e.loadMoreTopics(1)}),l.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function F(){return $('[component="category"]').filter(function(n,t){return!$(t).parents("[widget-area],[data-widget-area]").length})}e.watchForNewPosts=function(){$("#new-topics-alert").on("click",function(){$(this).addClass("hide")}),o=0,d=0,e.removeListeners(),socket.on("event:new_topic",L),socket.on("event:new_post",P)},e.removeListeners=function(){socket.removeListener("event:new_topic",L),socket.removeListener("event:new_post",P)};function L(n){const t=ajaxify.data,a=t.selectedCids&&t.selectedCids.length&&t.selectedCids.indexOf(parseInt(n.cid,10))===-1,p=t.selectedFilter&&t.selectedFilter.filter==="watched",m=t.template.category&&parseInt(t.cid,10)!==parseInt(n.cid,10),g=!!(a||p||m||f.includes(n.tid));l.fire("filter:topicList.onNewTopic",{topic:n,preventAlert:g}).then(C=>{C.preventAlert||(n.scheduled&&n.tid&&f.push(n.tid),d+=1,j())})}function P(n){const t=n.posts[0];if(!t||!t.topic||t.topic.isFollowing)return;const a=ajaxify.data,p=parseInt(t.topic.mainPid,10)===parseInt(t.pid,10),m=a.selectedCids&&a.selectedCids.length&&a.selectedCids.indexOf(parseInt(t.topic.cid,10))===-1,g=a.selectedFilter&&a.selectedFilter.filter==="new",C=a.selectedFilter&&a.selectedFilter.filter==="watched"&&!t.topic.isFollowing,b=a.template.category&&parseInt(a.cid,10)!==parseInt(t.topic.cid,10),D=!!(p||m||g||C||b);l.fire("filter:topicList.onNewPost",{post:t,preventAlert:D}).then(v=>{v.preventAlert||(o+=1,j())})}function j(){let n="";d===0?o===1?n="[[recent:there-is-a-new-post]]":o>1&&(n="[[recent:there-are-new-posts, "+o+"]]"):d===1?o===0?n="[[recent:there-is-a-new-topic]]":o===1?n="[[recent:there-is-a-new-topic-and-a-new-post]]":o>1&&(n="[[recent:there-is-a-new-topic-and-new-posts, "+o+"]]"):d>1&&(o===0?n="[[recent:there-are-new-topics, "+d+"]]":o===1?n="[[recent:there-are-new-topics-and-a-new-post, "+d+"]]":o>1&&(n="[[recent:there-are-new-topics-and-new-posts, "+d+", "+o+"]]")),n+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(n).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}e.loadMoreTopics=function(n){if(!i.length||!i.children().length)return;const t=i.find('[component="category/topic"]'),a=n>0?t.last():t.first(),p=(parseInt(a.attr("data-index"),10)||0)+(n>0?1:0);!utils.isNumber(p)||p===0&&i.find('[component="category/topic"][data-index="0"]').length||r(p,n,function(m,g){N(c,m.topics,ajaxify.data.showSelect,n,g)})};function M(n,t){return Math.floor(n/config.topicsPerPage)+(t>0?1:0)}function S(n,t,a){a=a||function(){};const p=utils.params();p.page=M(n,t),E.loadMoreXhr(p,a)}function R(n){return n.filter(function(t){return!i.find('[component="category/topic"][data-tid="'+t.tid+'"]').length})}function N(n,t,a,p,m){if(!t||!t.length||(t=R(t),!t.length))return $("#load-more-btn").hide(),m();let g,C;const b=i.find('[component="category/topic"]');p>0&&t.length?g=b.last():p<0&&t.length&&(C=b.first());const D={topics:t,showSelect:a,template:{name:n}};D.template[n]=!0,l.fire("action:topics.loading",{topics:t,after:g,before:C}),app.parseAndTranslate(n,"topics",D,function(v){if(i.removeClass("hidden"),$("#category-no-topics").remove(),g&&g.length)v.insertAfter(g);else if(C&&C.length){const _=$(document).height(),W=$(window).scrollTop();v.insertBefore(C),$(window).scrollTop(W+($(document).height()-_))}else i.append(v);h.getSelectedTids().length||E.removeExtra(i.find('[component="category/topic"]'),p,Math.max(60,config.topicsPerPage*3)),v.find(".timeago").timeago(),app.createUserTooltips(v),utils.makeNumbersHumanReadable(v.find(".human-readable-number")),l.fire("action:topics.loaded",{topics:t,template:n}),m()})}return e}.apply(I,A),w!==void 0&&(T.exports=w)}}]);
